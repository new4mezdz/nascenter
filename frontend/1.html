<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NAS Center ç®¡ç†ç³»ç»Ÿ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    /* æ–°å¢: å¼€å§‹èœå•æ ·å¼ */
.start-menu {
  position: fixed;
  bottom: 60px;
  left: 20px;
  width: 400px;
  background: rgba(30, 30, 30, 0.98);
  backdrop-filter: blur(20px);
  border-radius: 12px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  color: white;
  overflow: hidden;
  z-index: 1500;
  animation: slideUp 0.2s ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.start-menu-header {
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.start-menu-section {
  padding: 12px;
}

.start-menu-section-title {
  padding: 8px 12px;
  font-size: 11px;
  font-weight: 600;
  color: rgba(255,255,255,0.6);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.start-menu-item {
  padding: 12px 16px;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 12px;
  transition: all 0.15s;
}

.start-menu-item:hover {
  background: rgba(255,255,255,0.1);
}

.start-menu-item-disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* æ–°å¢: é¡¶éƒ¨å¯¼èˆªæ æ ·å¼ */
.top-navbar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 45px;
  background: rgba(0,0,0,0.85);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  padding: 0 20px;
  z-index: 999;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.navbar-button {
  padding: 6px 16px;
  background: rgba(255,255,255,0.1);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
  color: white;
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 6px;
  border: 1px solid rgba(255,255,255,0.2);
}

.navbar-button:hover {
  background: rgba(255,255,255,0.2);
}

.navbar-divider {
  width: 1px;
  height: 24px;
  background: rgba(255,255,255,0.2);
  margin: 0 12px;
}

/* è°ƒæ•´æ¡Œé¢åŒºåŸŸä»¥é€‚åº”é¡¶éƒ¨å¯¼èˆªæ  */
.desktop-with-navbar {
  padding-top: 45px;
}
    .desktop {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      position: relative;
      user-select: none;
    }

    .desktop-icon {
      width: 90px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      padding: 8px;
    }

    .desktop-icon:hover {
      transform: translateY(-2px);
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
    }

    .desktop-icon.dragging {
      opacity: 0.5;
      transform: scale(1.1);
    }

    /* ç¼–è¾‘æ¨¡å¼æŠ–åŠ¨åŠ¨ç”» */
    @keyframes wiggle {
      0%, 100% { transform: rotate(-2deg); }
      50% { transform: rotate(2deg); }
    }

    .desktop-icon.wiggle {
      animation: wiggle 0.25s ease-in-out infinite;
    }

    .desktop-icon.wiggle:hover {
      animation-play-state: paused;
      transform: none;
    }

    .icon-grid.edit-mode .desktop-icon {
      cursor: grab;
    }

    .icon-grid.edit-mode .desktop-icon:active {
      cursor: grabbing;
    }

    .window {
      position: absolute;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
      min-width: 400px;
      min-height: 300px;
      display: flex;
      flex-direction: column;
    }

    .window.maximized {
      top: 0 !important;
      left: 0 !important;
      width: 100% !important;
      height: calc(100vh - 50px) !important;
      border-radius: 0;
    }

    .window-header {
      background: linear-gradient(180deg, #f7f7f7 0%, #e8e8e8 100%);
      padding: 12px 16px;
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #ddd;
    }

    .window-controls button {
  width: 46px;
  height: 32px;
  border-radius: 0;
  border: none;
  margin-left: 0;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: background 0.15s;
  font-size: 16px;
  font-weight: normal;
}

.window-controls .minimize {
  background: transparent;
  color: #000;
}
.window-controls .minimize:hover {
  background: #e5e5e5;
}

.window-controls .maximize {
  background: transparent;
  color: #000;
}
.window-controls .maximize:hover {
  background: #e5e5e5;
}

.window-controls .close {
  background: transparent;
  color: #000;
}
.window-controls .close:hover {
  background: #e81123;
  color: white;
}
    .window-content {
      flex: 1;
      overflow: auto;
    }

    .taskbar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 50px;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      padding: 0 20px;
      z-index: 1000;
    }

    .taskbar-item {
      height: 40px;
      padding: 0 16px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      margin-right: 8px;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: all 0.2s;
      color: white;
    }

    .taskbar-item:hover {
      background: rgba(255,255,255,0.2);
    }

    .taskbar-item.active {
      background: rgba(255,255,255,0.3);
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #3b82f6;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    .window {
      animation: fadeIn 0.2s ease-out;
    }

    .icon-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, 90px);
      gap: 20px;
      padding: 20px;
    }

    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }


    /* æ‰‹æœºç«¯é€‚é… */
    /* æ‰‹æœºç«¯é€‚é… */
@media (max-width: 768px) {
  .window {
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: calc(100vh - 50px) !important;
    bottom: 50px !important;
    border-radius: 0;
    min-width: 100%;
    display: flex !important;
    flex-direction: column !important;
  }

  .window.maximized {
    height: calc(100vh - 50px) !important;
    bottom: 50px !important;
  }

  .start-menu {
    width: calc(100% - 40px);
    left: 20px;
    right: 20px;
  }

  .top-navbar {
    padding: 0 12px;
  }

  .navbar-button {
    font-size: 12px;
    padding: 6px 12px;
  }

  .desktop-icon {
    width: 70px;
  }

  .desktop-icon:hover {
    background: transparent !important;
    transform: translateY(-2px);
  }

  .taskbar {
    padding: 0 12px;
  }

  .taskbar-item {
    padding: 0 12px;
    font-size: 13px;
  }

  /* ç»Ÿè®¡å¡ç‰‡å•åˆ—æ˜¾ç¤º */
  .grid.grid-cols-4 {
    grid-template-columns: 1fr !important;
    gap: 16px !important;
  }

  /* æ‰€æœ‰gridåœ¨æ‰‹æœºç«¯éƒ½æ”¹æˆå•åˆ— */
  .grid {
    grid-template-columns: 1fr !important;
    gap: 16px !important;
  }

  /* ä½†ç½‘ç»œå¸¦å®½å†…éƒ¨çš„2åˆ—gridä¿æŒä¸å˜ */
  .grid.grid-cols-2.gap-4 {
    grid-template-columns: 1fr 1fr !important;
  }

  /* è¡¨æ ¼æœ€å°å®½åº¦ï¼Œä¿è¯å¯ä»¥æ¨ªå‘æ»šåŠ¨ */
  table {
    min-width: 800px !important;
  }

  /* çª—å£å†…å®¹åŒºåŸŸå¯ä»¥æ»šåŠ¨ */
  .window-content {
    overflow-y: auto !important;
    overflow-x: hidden !important;
    -webkit-overflow-scrolling: touch !important;
  }

  /* ç³»ç»Ÿç›‘æ§è¯¦æƒ…é¡µé¢å®¹å™¨ - å…³é”®ä¿®å¤ */
  .flex-1.overflow-auto {
    overflow-y: auto !important;
    overflow-x: hidden !important;
    -webkit-overflow-scrolling: touch !important;
  }

  /* è¡¨æ ¼å®¹å™¨æ¨ªå‘æ»šåŠ¨ */
  .bg-white.rounded-lg.shadow.border {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
  }

  /* ç¡®ä¿ç½‘æ ¼å®¹å™¨é«˜åº¦è‡ªé€‚åº” */
  .grid {
    min-height: auto !important;
  }

  /* æ‰‹æœºç«¯æ˜¾ç¤ºæ»šåŠ¨æ¡ */
  .window-content::-webkit-scrollbar {
    width: 6px;
  }

  .window-content::-webkit-scrollbar-track {
    background: #f1f1f1;
  }

  .window-content::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 3px;
  }

  /* è¡¨æ ¼æ¨ªå‘æ»šåŠ¨æ¡ */
  .bg-white.rounded-lg.shadow.border::-webkit-scrollbar {
    height: 6px;
  }

  .bg-white.rounded-lg.shadow.border::-webkit-scrollbar-track {
    background: #f1f1f1;
  }

  .bg-white.rounded-lg.shadow.border::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 3px;
  }

  /* ç»™å†…å®¹åŒºåŸŸåº•éƒ¨æ·»åŠ é¢å¤–padding */
  .flex-1.overflow-auto.p-6 {
    padding-bottom: 100px !important;
  }
}


  </style>
</head>
<body>

  <div id="app">
    <div class="top-navbar" v-if="showNavbar">
    <div class="flex items-center gap-2">
      <button @click="returnToMainCenter" class="navbar-button">
        <span>ğŸ </span>
        <span>è¿”å›ä¸»æ§ä¸­å¿ƒ</span>
      </button>

      <div class="navbar-divider"></div>

      <span class="text-white text-sm flex items-center gap-2">
        <span class="text-green-400">â—</span>
        å½“å‰èŠ‚ç‚¹: <strong>{{ currentNodeName }}</strong>
      </span>
    </div>

    <div class="ml-auto flex items-center gap-3">
      <button @click="openNodeManagement" class="navbar-button">
        <span>ğŸ”„</span>
        <span>åˆ‡æ¢èŠ‚ç‚¹</span>
      </button>

      <button @click="refreshCurrentNode" class="navbar-button">
        <span>ğŸ”ƒ</span>
        <span>åˆ·æ–°</span>
      </button>
    </div>
  </div>
    <div :class="['desktop fixed inset-0', { 'desktop-with-navbar': showNavbar }]"
     :style="desktopBackground ? { backgroundImage: 'url(' + desktopBackground + ')', backgroundSize: 'cover', backgroundPosition: 'center' } : {}"
     @click="closeAllMenus">

     <div class="icon-grid p-8" :class="{ 'edit-mode': iconEditMode }" @click.self="exitIconEditMode">
  <div v-for="icon in desktopIcons"
       :key="icon.id"
       class="desktop-icon"
       :class="{ 'dragging': draggedIcon === icon.id, 'wiggle': iconEditMode }"
       :style="{ order: icon.order }"
       draggable="true"
       @dragstart="onIconDragStart($event, icon)"
       @dragend="onIconDragEnd"
       @dragover.prevent="onIconDragOver($event, icon)"
       @drop="onIconDrop($event, icon)"
       @mousedown="startLongPress(icon)"
       @mouseup="cancelLongPress"
       @mouseleave="cancelLongPress"
       @dblclick.stop="handleIconDblClick(icon)">
    <div class="w-16 h-16 mx-auto mb-2 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-4xl">
      {{ icon.emoji }}
    </div>
    <div class="text-white text-xs font-semibold drop-shadow-lg">{{ icon.label }}</div>
  </div>
</div>

<!-- ç¼–è¾‘æ¨¡å¼æç¤º -->
<div v-if="iconEditMode" class="fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-black/70 text-white px-4 py-2 rounded-full text-sm z-50">
  æ‹–æ‹½å›¾æ ‡è°ƒæ•´ä½ç½®ï¼Œç‚¹å‡»ç©ºç™½å¤„å®Œæˆ
</div>
      <div v-for="window in windows" :key="window.id"
           :class="['window', { maximized: window.maximized }]"
           :style="window.maximized ? {} : {
             top: window.y + 'px',
             left: window.x + 'px',
             width: window.width + 'px',
             height: window.height + 'px',
             zIndex: window.zIndex,
             display: window.minimized ? 'none' : 'flex'
           }"
           @mousedown="focusWindow(window.id)">

        <div class="window-header" @mousedown="startDrag($event, window)">
          <div class="flex items-center gap-2">
            <span class="text-2xl">{{ window.icon }}</span>
            <span class="font-semibold text-sm">{{ window.title }}</span>
          </div>
          <div class="window-controls flex">
              <button class="minimize" @click.stop="minimizeWindow(window.id)">
                <svg width="10" height="1" viewBox="0 0 10 1"><rect fill="currentColor" width="10" height="1"/></svg>
              </button>
              <button class="maximize" @click.stop="toggleMaximize(window.id)">
                <svg width="10" height="10" viewBox="0 0 10 10"><rect fill="none" stroke="currentColor" stroke-width="1" x="0.5" y="0.5" width="9" height="9"/></svg>
              </button>
              <button class="close" @click.stop="closeWindow(window.id)">
                <svg width="10" height="10" viewBox="0 0 10 10"><line stroke="currentColor" stroke-width="1" x1="0" y1="0" x2="10" y2="10"/><line stroke="currentColor" stroke-width="1" x1="10" y1="0" x2="0" y2="10"/></svg>
              </button>
            </div>
        </div>

        <div class="window-content" style="padding: 0; overflow: hidden;">

          <!-- èŠ‚ç‚¹ç®¡ç†çª—å£ -->
          <div v-if="window.type === 'nodes'" class="h-full flex flex-col">
            <div class="px-6 py-4 border-b bg-gradient-to-r from-blue-50 to-purple-50">
              <div class="flex justify-between items-center">
                <div>
                  <h3 class="text-xl font-bold flex items-center gap-2">
                    <span class="text-3xl">ğŸ–¥ï¸</span>
                    èŠ‚ç‚¹ç®¡ç†
                  </h3>
                  <p class="text-sm text-gray-600 mt-1">ç®¡ç†å’Œç›‘æ§æ‰€æœ‰ NAS èŠ‚ç‚¹</p>
                </div>
                <button @click="refreshNodes(window)"
                        class="px-4 py-2 bg-white border rounded-lg hover:bg-gray-50 transition flex items-center gap-2">
                  <span v-if="window.loading" class="loading"></span>
                  <span v-else>ğŸ”„</span>
                  åˆ·æ–°
                </button>
              </div>
            </div>

            <div v-if="window.stats" class="grid grid-cols-4 gap-4 p-6 bg-gray-50">
              <div class="bg-white rounded-lg shadow p-4 border">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-xs text-gray-600 mb-1">æ€»èŠ‚ç‚¹</div>
                    <div class="text-2xl font-bold text-blue-600">{{ window.stats.total }}</div>
                  </div>
                  <div class="text-4xl">ğŸ–¥ï¸</div>
                </div>
              </div>
              <div class="bg-white rounded-lg shadow p-4 border">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-xs text-gray-600 mb-1">åœ¨çº¿</div>
                    <div class="text-2xl font-bold text-green-600">{{ window.stats.online }}</div>
                  </div>
                  <div class="text-4xl">âœ…</div>
                </div>
              </div>
              <div class="bg-white rounded-lg shadow p-4 border">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-xs text-gray-600 mb-1">ç¦»çº¿</div>
                    <div class="text-2xl font-bold text-red-600">{{ window.stats.offline }}</div>
                  </div>
                  <div class="text-4xl">âŒ</div>
                </div>
              </div>
              <div class="bg-white rounded-lg shadow p-4 border">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-xs text-gray-600 mb-1">è­¦å‘Š</div>
                    <div class="text-2xl font-bold text-yellow-600">{{ window.stats.warning }}</div>
                  </div>
                  <div class="text-4xl">âš ï¸</div>
                </div>
              </div>
            </div>

            <div class="p-6 bg-gray-50">
  <div class="bg-white rounded-lg shadow border overflow-x-auto">
                <table class="w-full">
                  <thead class="bg-gray-50 border-b">
                    <tr>
                      <th class="text-left p-4 font-semibold text-gray-700">èŠ‚ç‚¹åç§°</th>
                      <th class="text-left p-4 font-semibold text-gray-700">åœ°å€</th>
                      <th class="text-left p-4 font-semibold text-gray-700">çŠ¶æ€</th>
                      <th class="text-left p-4 font-semibold text-gray-700">CPU</th>
                      <th class="text-left p-4 font-semibold text-gray-700">å†…å­˜</th>
                      <th class="text-left p-4 font-semibold text-gray-700">ç£ç›˜</th>
                      <th class="text-left p-4 font-semibold text-gray-700">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="node in window.nodes" :key="node.id"
                        class="border-b hover:bg-gray-50">
                      <td class="p-4">
                        <div class="font-semibold text-gray-800">{{ node.name }}</div>
                        <div class="text-xs text-gray-500">{{ node.id }}</div>
                      </td>
                      <td class="p-4 text-sm">{{ node.ip }}:{{ node.port }}</td>
                      <td class="p-4">
                        <span class="px-3 py-1 rounded-full text-xs font-semibold"
                              :class="getStatusClass(node.status)">
                          {{ getStatusText(node.status) }}
                        </span>
                      </td>
                      <td class="p-4">
                        <span v-if="node.status !== 'offline'" class="text-sm font-semibold"
                              :class="node.cpu_usage > 80 ? 'text-red-600' : 'text-gray-700'">
                          {{ node.cpu_usage.toFixed(1) }}%
                        </span>
                        <span v-else class="text-sm text-gray-400">-</span>
                      </td>
                      <td class="p-4">
                        <span v-if="node.status !== 'offline'" class="text-sm font-semibold"
                              :class="node.memory_usage > 80 ? 'text-red-600' : 'text-gray-700'">
                          {{ node.memory_usage.toFixed(1) }}%
                        </span>
                        <span v-else class="text-sm text-gray-400">-</span>
                      </td>
                      <td class="p-4">
                        <span v-if="node.status !== 'offline'" class="text-sm font-semibold"
                              :class="node.disk_usage > 80 ? 'text-red-600' : 'text-gray-700'">
                          {{ node.disk_usage.toFixed(1) }}%
                        </span>
                        <span v-else class="text-sm text-gray-400">-</span>
                      </td>
                      <td class="p-4">
                        <div class="flex gap-2">
                           <button @click="renameNode(window, node)"
            class="px-3 py-1 bg-purple-500 hover:bg-purple-600 text-white rounded text-xs">
      âœï¸ æ”¹å
    </button>
                          <button @click="viewNodeDisks(window, node)"
                                  :disabled="node.status === 'offline'"
                                  :class="node.status === 'offline' ? 'opacity-50 cursor-not-allowed bg-gray-400' : 'bg-blue-500 hover:bg-blue-600'"
                                  class="px-3 py-1 text-white rounded text-xs">
                            ğŸ’¾ ç£ç›˜
                          </button>
                          <button @click="accessNode(node)"
                                  :disabled="node.status === 'offline'"
                                  :class="node.status === 'offline' ? 'opacity-50 cursor-not-allowed bg-gray-400' : 'bg-green-500 hover:bg-green-600'"
                                  class="px-3 py-1 text-white rounded text-xs">
                            ğŸ”— è®¿é—®
                          </button>
                          <button @click="deleteNode(window, node)"
            class="px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-xs">
      ğŸ—‘ï¸ åˆ é™¤
    </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- ç£ç›˜ä¿¡æ¯å¼¹çª— -->
            <!-- ç£ç›˜ä¿¡æ¯å¼¹çª— - ç§‘æŠ€é£æ ¼ -->
<div v-if="window.selectedNodeDisks"
     @click="window.selectedNodeDisks = null"
     class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50">
  <div @click.stop class="bg-gray-900 border border-cyan-500/30 rounded-lg shadow-2xl shadow-cyan-500/20 max-w-lg w-full mx-4 overflow-hidden">
    <!-- æ ‡é¢˜æ  -->
    <div class="px-5 py-3 border-b border-cyan-500/30 flex items-center justify-between bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900">
      <div class="flex items-center gap-2">
        <span class="w-2 h-2 bg-cyan-400 rounded-full animate-pulse"></span>
        <h3 class="font-mono font-semibold text-cyan-400">{{ window.selectedNodeDisks.name }}</h3>
      </div>
      <button @click="window.selectedNodeDisks = null"
              class="text-gray-500 hover:text-cyan-400 transition-colors text-lg">âœ•</button>
    </div>

    <!-- å†…å®¹åŒº -->
    <div class="p-4 max-h-[55vh] overflow-y-auto">
      <div v-if="window.selectedNodeDisks.loading" class="flex items-center justify-center py-10">
        <div class="w-8 h-8 border-2 border-cyan-500/30 border-t-cyan-400 rounded-full animate-spin"></div>
        <span class="ml-3 text-cyan-400/70 font-mono text-sm">LOADING...</span>
      </div>
      <div v-else-if="window.selectedNodeDisks.error" class="text-center py-10">
        <div class="text-red-400 font-mono mb-2">âš  ERROR</div>
        <div class="text-gray-500 text-sm">{{ window.selectedNodeDisks.error }}</div>
      </div>
      <div v-else class="space-y-3">
        <div v-for="(disk, index) in window.selectedNodeDisks.disks" :key="index"
             class="border border-gray-700 rounded-lg p-3 bg-gray-800/50 hover:border-cyan-500/50 transition-all group">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-2">
              <span class="text-cyan-400">â–¸</span>
              <span class="font-mono text-gray-200 text-sm">{{ disk.mount }}</span>
            </div>
            <span v-if="disk.ec_scheme"
                  class="px-2 py-0.5 bg-emerald-500/10 text-emerald-400 border border-emerald-500/30 rounded text-xs font-mono">
              {{ disk.ec_scheme }}
            </span>
          </div>
          <!-- è¿›åº¦æ¡ -->
          <div class="relative w-full bg-gray-700/50 rounded h-1.5 mb-2 overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent"></div>
            <div class="h-full rounded transition-all duration-500"
                 :class="disk.usage_percent > 90 ? 'bg-gradient-to-r from-red-500 to-red-400 shadow-red-500/50' :
                         disk.usage_percent > 70 ? 'bg-gradient-to-r from-yellow-500 to-yellow-400 shadow-yellow-500/50' :
                         'bg-gradient-to-r from-cyan-500 to-blue-400 shadow-cyan-500/50'"
                 :style="{ width: disk.usage_percent + '%', boxShadow: '0 0 10px currentColor' }">
            </div>
          </div>
          <!-- æ•°æ® -->
          <div class="flex justify-between font-mono text-xs">
            <span class="text-gray-500">{{ disk.used_gb }}<span class="text-gray-600">/</span>{{ disk.total_gb }} GB</span>
            <span :class="disk.usage_percent > 90 ? 'text-red-400' : disk.usage_percent > 70 ? 'text-yellow-400' : 'text-cyan-400'">
              {{ disk.usage_percent.toFixed(1) }}%
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- åº•éƒ¨è£…é¥° -->
    <div class="px-4 py-2 border-t border-cyan-500/20 bg-gray-900/80 flex items-center justify-between">

      <div class="flex gap-1">
        <span class="w-1.5 h-1.5 bg-cyan-400 rounded-full"></span>
        <span class="w-1.5 h-1.5 bg-cyan-400/60 rounded-full"></span>
        <span class="w-1.5 h-1.5 bg-cyan-400/30 rounded-full"></span>
      </div>
    </div>
  </div>
</div>
          </div>


          <div v-if="window.type === 'user-management'" class="h-full flex flex-col">
            <div class="px-6 py-4 border-b bg-gradient-to-r from-gray-50 to-gray-100">
              <div class="flex justify-between items-center">
                <div>
                  <h3 class="text-xl font-bold flex items-center gap-2">
                    <span class="text-3xl">ğŸ‘¥</span>
                    ç”¨æˆ·ç®¡ç†
                  </h3>
                  <p class="text-sm text-gray-600 mt-1">åˆ›å»ºã€ç¼–è¾‘å’Œç®¡ç†æ‰€æœ‰ç³»ç»Ÿç”¨æˆ·</p>
                </div>
                <button @click="createUser(window)"
                        class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition flex items-center gap-2">
                  <span>+</span>
                  æ·»åŠ æ–°ç”¨æˆ·
                </button>
              </div>
            </div>

            <div v-if="window.loading" class="flex-1 flex items-center justify-center">
              <div class="loading"></div>
              <span class="ml-3 text-gray-600">æ­£åœ¨åŠ è½½ç”¨æˆ·åˆ—è¡¨...</span>
            </div>

            <div v-else class="flex-1 overflow-auto p-6 bg-gray-50">
              <div class="bg-white rounded-lg shadow border">
                <table class="w-full">
                  <thead class="bg-gray-50 border-b">
                    <tr>
                      <th class="text-left p-4 font-semibold text-gray-700">ç”¨æˆ·å</th>
                      <th class="text-left p-4 font-semibold text-gray-700">é‚®ç®±</th>
                      <th class="text-left p-4 font-semibold text-gray-700">è§’è‰²</th>
                      <th class="text-left p-4 font-semibold text-gray-700">çŠ¶æ€</th>
                      <th class="text-left p-4 font-semibold text-gray-700">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="user in window.users" :key="user.id"
                        class="border-b hover:bg-gray-50">

                      <td class="p-4">
                        <div class="font-semibold text-gray-800">{{ user.username }}</div>
                        <div class="text-xs text-gray-500">ID: {{ user.id }}</div>
                      </td>

                      <td class="p-4 text-sm">{{ user.email || 'N/A' }}</td>

                      <td class="p-4">
                        <span v-if="user.role === 'admin'" class="px-3 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-700">
                          ğŸ‘‘ ç®¡ç†å‘˜
                        </span>
                        <span v-else class="px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-700">
                          ğŸ‘¤ æ™®é€šç”¨æˆ·
                        </span>
                      </td>

                      <td class="p-4">
                        <span v-if="user.status === 'active'" class="px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700">
                          âœ“ æ´»è·ƒ
                        </span>
                        <span v-else class="px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700">
                          âœ— å·²ç¦ç”¨
                        </span>
                      </td>

                      <td class="p-4">
                        <div class="flex gap-2">
                          <button @click="updateUser(window, user)"
                                  :disabled="user.username === 'admin'"
                                  :class="user.username === 'admin' ? 'opacity-50 cursor-not-allowed bg-gray-400' : 'bg-green-500 hover:bg-green-600'"
                                  class="px-3 py-1 text-white rounded text-xs">
                            âœï¸ ç¼–è¾‘
                          </button>
                          <button @click="deleteUser(window, user)"
                                  :disabled="user.username === 'admin'"
                                  :class="user.username === 'admin' ? 'opacity-50 cursor-not-allowed bg-gray-400' : 'bg-red-500 hover:bg-red-600'"
                                  class="px-3 py-1 text-white rounded text-xs">
                            ğŸ—‘ï¸ åˆ é™¤
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

         <!-- ç©ºé—´åˆ†é…çª—å£ -->
<div v-if="window.type === 'space-allocation'" class="h-full flex flex-col">
  <div class="px-6 py-4 border-b bg-gradient-to-r from-purple-50 to-pink-50">
    <h3 class="text-xl font-bold flex items-center gap-2">
      <span class="text-3xl">ğŸ“¦</span>
      ç©ºé—´åˆ†é…ç®¡ç†
    </h3>
    <p class="text-sm text-gray-600 mt-1">ç®¡ç†è·¨èŠ‚ç‚¹åˆ†é…ä¸èŠ‚ç‚¹å­˜å‚¨æ± </p>
  </div>

  <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
  <div class="flex gap-2 px-6 pt-4 border-b bg-white">
    <button @click="window.spaceTab = 'cross-node'"
      :class="window.spaceTab === 'cross-node' ? 'border-b-2 border-blue-500 text-blue-600 font-semibold' : 'text-gray-500 hover:text-gray-700'"
      class="px-4 py-2 -mb-px">
      ğŸŒ è·¨èŠ‚ç‚¹å­˜å‚¨æ± 
    </button>
    <button @click="window.spaceTab = 'node-pool'"
      :class="window.spaceTab === 'node-pool' ? 'border-b-2 border-blue-500 text-blue-600 font-semibold' : 'text-gray-500 hover:text-gray-700'"
      class="px-4 py-2 -mb-px">
      ğŸ’¾ èŠ‚ç‚¹å­˜å‚¨æ± 
    </button>
  </div>

  <div class="flex-1 overflow-auto p-6 bg-gray-50">

    <!-- ========== è·¨èŠ‚ç‚¹åˆ†é… ========== -->
    <div v-if="window.spaceTab === 'cross-node'" class="flex gap-6 h-full">

      <!-- å·¦ä¾§ï¼šè·¨èŠ‚ç‚¹æ± åˆ—è¡¨ -->
      <div class="w-80 bg-white rounded-lg shadow border p-4 flex-shrink-0 flex flex-col">
        <div class="flex justify-between items-center mb-4">
          <h4 class="font-bold text-lg">ğŸŒ è·¨èŠ‚ç‚¹å­˜å‚¨æ± </h4>
          <button @click="openCreatePoolDialog(window)"
                  class="px-3 py-1.5 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">
            + æ–°å»º
          </button>
        </div>

        <div v-if="window.crossPoolsLoading" class="flex-1 flex items-center justify-center">
          <div class="loading"></div>
        </div>

        <div v-else class="flex-1 overflow-auto space-y-2">
          <div v-for="pool in (window.crossPools || [])" :key="pool.id"
               @click="selectCrossPool(window, pool)"
               :class="window.selectedCrossPool?.id === pool.id ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:bg-gray-50'"
               class="p-3 border-2 rounded-lg cursor-pointer transition-all">
            <div class="flex items-center justify-between">
              <div class="flex-1 min-w-0">
                <div class="font-semibold truncate">{{ pool.display_name || pool.name }}</div>
                <div class="text-xs text-gray-500 mt-1">
                  ç­–ç•¥: {{ getStrategyName(pool.strategy) }} Â· {{ (pool.disks || []).length }} ä¸ªç£ç›˜
                </div>
              </div>
              <span class="w-2 h-2 rounded-full" :class="pool.status === 'active' ? 'bg-green-500' : 'bg-gray-400'"></span>
            </div>
          </div>

          <div v-if="!window.crossPools || window.crossPools.length === 0" class="text-center text-gray-500 py-8">
            <div class="text-4xl mb-2">ğŸ“¦</div>
            <p class="text-sm">è¿˜æ²¡æœ‰è·¨èŠ‚ç‚¹å­˜å‚¨æ± </p>
            <p class="text-xs mt-1">ç‚¹å‡»"æ–°å»º"åˆ›å»ºä¸€ä¸ª</p>
          </div>
        </div>
      </div>

      <!-- å³ä¾§ï¼šæ± è¯¦æƒ… -->
      <div class="flex-1 min-w-0">
        <div v-if="!window.selectedCrossPool" class="h-full flex items-center justify-center bg-white rounded-lg shadow border">
          <div class="text-center text-gray-400">
            <div class="text-6xl mb-4">ğŸ‘ˆ</div>
            <p>è¯·é€‰æ‹©ä¸€ä¸ªå­˜å‚¨æ± æŸ¥çœ‹è¯¦æƒ…</p>
            <p class="text-sm mt-2">æˆ–ç‚¹å‡»"æ–°å»º"åˆ›å»ºè·¨èŠ‚ç‚¹å­˜å‚¨æ± </p>
          </div>
        </div>

        <div v-else class="space-y-4">
          <!-- æ± ä¿¡æ¯å¡ç‰‡ -->
          <div class="bg-white rounded-lg shadow border p-6">
            <div class="flex items-center justify-between mb-4">
              <div>
                <h4 class="text-xl font-bold">{{ window.selectedCrossPool.display_name || window.selectedCrossPool.name }}</h4>
                <p class="text-sm text-gray-500 mt-1">{{ window.selectedCrossPool.name }}</p>
              </div>
              <div class="flex gap-2">
                <button @click="openEditPoolDialog(window, window.selectedCrossPool)"
                        class="px-3 py-1.5 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">
                  âœï¸ ç¼–è¾‘
                </button>
                <button @click="deleteCrossPool(window, window.selectedCrossPool)"
                        class="px-3 py-1.5 bg-red-500 text-white rounded text-sm hover:bg-red-600">
                  ğŸ—‘ï¸ åˆ é™¤
                </button>
              </div>
            </div>

            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="grid grid-cols-4 gap-4">
              <div class="bg-blue-50 p-4 rounded-lg text-center">
                <div class="text-2xl font-bold text-blue-600">{{ (window.selectedCrossPool.disks || []).length }}</div>
                <div class="text-xs text-gray-600">ç£ç›˜æ•°é‡</div>
              </div>
              <div class="bg-green-50 p-4 rounded-lg text-center">
                <div class="text-2xl font-bold text-green-600">{{ window.selectedCrossPool.stats?.file_count || 0 }}</div>
                <div class="text-xs text-gray-600">æ–‡ä»¶æ•°é‡</div>
              </div>
              <div class="bg-purple-50 p-4 rounded-lg text-center">
                <div class="text-2xl font-bold text-purple-600">{{ ((window.selectedCrossPool.stats?.total_size || 0) / 1073741824).toFixed(2) }}</div>
                <div class="text-xs text-gray-600">æ€»å¤§å° (GB)</div>
              </div>
              <div class="bg-orange-50 p-4 rounded-lg text-center">
                <div class="text-2xl font-bold text-orange-600">{{ getStrategyName(window.selectedCrossPool.strategy) }}</div>
                <div class="text-xs text-gray-600">åˆ†é…ç­–ç•¥</div>
              </div>
            </div>
          </div>

          <!-- ç£ç›˜åˆ—è¡¨ -->
          <div class="bg-white rounded-lg shadow border p-6">
            <h5 class="font-bold text-lg mb-4">ğŸ’¾ æˆå‘˜ç£ç›˜</h5>
            <div class="space-y-3">
              <div v-for="(disk, idx) in (window.selectedCrossPool.disks || [])" :key="idx"
                   class="flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50">
                <div class="flex items-center gap-3">
                  <span class="text-2xl">ğŸ–¥ï¸</span>
                  <div>
                    <div class="font-semibold">{{ disk.nodeName }}</div>
                    <div class="text-xs text-gray-500">{{ disk.nodeIp }} Â· {{ disk.disk }}</div>
                  </div>
                </div>
                <div class="text-right">
                  <div class="text-sm font-semibold text-green-600">{{ disk.free || '?' }} GB å¯ç”¨</div>
                  <div class="text-xs text-gray-500">å…± {{ disk.total || '?' }} GB</div>
                </div>
              </div>

              <div v-if="!window.selectedCrossPool.disks || window.selectedCrossPool.disks.length === 0"
                   class="text-center text-gray-500 py-4">
                æš‚æ— ç£ç›˜
              </div>
            </div>
          </div>

          <!-- ç­–ç•¥è¯´æ˜ -->
          <div class="bg-blue-50 rounded-lg border border-blue-200 p-4">
            <div class="flex items-start gap-3">
              <span class="text-2xl">ğŸ’¡</span>
              <div class="text-sm text-blue-800">
                <strong>å½“å‰ç­–ç•¥: {{ getStrategyName(window.selectedCrossPool.strategy) }}</strong>
                <p class="mt-1" v-if="window.selectedCrossPool.strategy === 'space_first'">æ–‡ä»¶å°†ä¼˜å…ˆå­˜å‚¨åˆ°å‰©ä½™ç©ºé—´æœ€å¤§çš„ç£ç›˜</p>
                <p class="mt-1" v-else-if="window.selectedCrossPool.strategy === 'round_robin'">æ–‡ä»¶å°†æŒ‰é¡ºåºè½®æµå­˜å‚¨åˆ°å„ä¸ªç£ç›˜</p>
                <p class="mt-1" v-else-if="window.selectedCrossPool.strategy === 'node_spread'">æ–‡ä»¶å°†ä¼˜å…ˆåˆ†æ•£åˆ°ä¸åŒèŠ‚ç‚¹ï¼Œæœ€å¤§ç¨‹åº¦æé«˜å®¹é”™æ€§</p>
                <p class="mt-1" v-else-if="window.selectedCrossPool.strategy === 'fill'">å¡«æ»¡ä¸€ä¸ªç£ç›˜åå†ä½¿ç”¨ä¸‹ä¸€ä¸ªç£ç›˜</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- åˆ›å»º/ç¼–è¾‘è·¨èŠ‚ç‚¹æ± å¯¹è¯æ¡† -->
      <div v-if="window.showCreatePoolDialog"
           class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[2000]"
           @click.self="window.showCreatePoolDialog = false">
        <div class="bg-white rounded-lg shadow-xl w-[900px] max-h-[85vh] flex flex-col">
          <div class="flex justify-between items-center p-6 border-b">
            <h3 class="text-xl font-bold">{{ window.poolEditMode ? 'âœï¸ ç¼–è¾‘è·¨èŠ‚ç‚¹æ± ' : 'â• åˆ›å»ºè·¨èŠ‚ç‚¹æ± ' }}</h3>
            <button @click="window.showCreatePoolDialog = false" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
          </div>

          <div class="flex-1 overflow-auto p-6">
            <!-- åŸºæœ¬ä¿¡æ¯ -->
            <div class="grid grid-cols-2 gap-4 mb-6">
              <div>
                <label class="block text-sm font-semibold mb-2">æ± åç§° (è‹±æ–‡)</label>
                <input v-model="window.poolForm.name" type="text" :disabled="window.poolEditMode"
                       placeholder="å¦‚: main-pool"
                       :class="window.poolEditMode ? 'bg-gray-100' : ''"
                       class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
              <div>
                <label class="block text-sm font-semibold mb-2">æ˜¾ç¤ºåç§°</label>
                <input v-model="window.poolForm.display_name" type="text"
                       placeholder="å¦‚: ä¸»å­˜å‚¨æ± "
                       class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
            </div>

            <!-- åˆ†é…ç­–ç•¥ -->
            <div class="mb-6">
              <label class="block text-sm font-semibold mb-2">åˆ†é…ç­–ç•¥</label>
              <div class="grid grid-cols-4 gap-3">
                <div @click="window.poolForm.strategy = 'space_first'"
                     :class="window.poolForm.strategy === 'space_first' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'"
                     class="border-2 rounded-lg p-3 cursor-pointer hover:bg-gray-50 text-center">
                  <div class="text-2xl mb-1">ğŸ’¾</div>
                  <div class="text-sm font-semibold">ç©ºé—´ä¼˜å…ˆ</div>
                  <div class="text-xs text-gray-500">é€‰å‰©ä½™ç©ºé—´æœ€å¤§</div>
                </div>
                <div @click="window.poolForm.strategy = 'round_robin'"
                     :class="window.poolForm.strategy === 'round_robin' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'"
                     class="border-2 rounded-lg p-3 cursor-pointer hover:bg-gray-50 text-center">
                  <div class="text-2xl mb-1">ğŸ”„</div>
                  <div class="text-sm font-semibold">è½®è¯¢</div>
                  <div class="text-xs text-gray-500">æŒ‰é¡ºåºè½®æµ</div>
                </div>
                <div @click="window.poolForm.strategy = 'node_spread'"
                     :class="window.poolForm.strategy === 'node_spread' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'"
                     class="border-2 rounded-lg p-3 cursor-pointer hover:bg-gray-50 text-center">
                  <div class="text-2xl mb-1">ğŸŒ</div>
                  <div class="text-sm font-semibold">èŠ‚ç‚¹ä¼˜å…ˆ</div>
                  <div class="text-xs text-gray-500">å…ˆè·¨èŠ‚ç‚¹å†è·¨ç›˜</div>
                </div>
                <div @click="window.poolForm.strategy = 'fill'"
                     :class="window.poolForm.strategy === 'fill' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'"
                     class="border-2 rounded-lg p-3 cursor-pointer hover:bg-gray-50 text-center">
                  <div class="text-2xl mb-1">ğŸ“¥</div>
                  <div class="text-sm font-semibold">å¡«å……</div>
                  <div class="text-xs text-gray-500">å¡«æ»¡å†æ¢ä¸‹ä¸€ä¸ª</div>
                </div>
              </div>
            </div>

            <!-- é€‰æ‹©ç£ç›˜ -->
            <div class="mb-4">
              <label class="block text-sm font-semibold mb-2">é€‰æ‹©ç£ç›˜</label>
              <div class="flex gap-4 h-64">
                <!-- èŠ‚ç‚¹åˆ—è¡¨ -->
                <div class="w-56 border rounded-lg overflow-hidden flex flex-col">
                  <div class="bg-gray-100 px-3 py-2 text-sm font-semibold border-b">é€‰æ‹©èŠ‚ç‚¹</div>
                  <div class="flex-1 overflow-auto">
                    <div v-for="node in (window.allNodes || [])" :key="node.id"
                         @click="selectNodeForDiskSelection(window, node)"
                         :class="window.selectedNodeForDisk?.id === node.id ? 'bg-blue-50 border-l-4 border-l-blue-500' : 'hover:bg-gray-50'"
                         class="px-3 py-2 cursor-pointer border-b">
                      <div class="font-semibold text-sm truncate">{{ node.name }}</div>
                      <div class="text-xs text-gray-500">{{ node.ip }}</div>
                    </div>
                  </div>
                </div>

                <!-- ç£ç›˜åˆ—è¡¨ -->
                <div class="flex-1 border rounded-lg overflow-hidden flex flex-col">
                  <div class="bg-gray-100 px-3 py-2 text-sm font-semibold border-b">é€‰æ‹©ç£ç›˜</div>
                  <div class="flex-1 overflow-auto p-2">
                    <div v-if="!window.selectedNodeForDisk"
                         class="h-full flex items-center justify-center text-gray-400 text-sm">
                      è¯·å…ˆé€‰æ‹©èŠ‚ç‚¹
                    </div>
                    <div v-else-if="window.nodeDisksLoading"
                         class="h-full flex items-center justify-center">
                      <div class="loading"></div>
                    </div>
                    <div v-else class="space-y-2">
                      <label v-for="disk in (window.nodeDisks || [])" :key="disk.mount"
                             class="flex items-center gap-3 p-2 border rounded cursor-pointer hover:bg-gray-50"
                             :class="isDiskSelected(window, window.selectedNodeForDisk?.id, disk.mount) ? 'border-blue-500 bg-blue-50' : ''">
                        <input type="checkbox"
                               :checked="isDiskSelected(window, window.selectedNodeForDisk?.id, disk.mount)"
                               @change="toggleDiskSelection(window, window.selectedNodeForDisk, disk)"
                               class="w-4 h-4 accent-blue-500">
                        <span class="text-lg">ğŸ’¾</span>
                        <div class="flex-1">
                          <div class="font-semibold text-sm">{{ disk.mount }}</div>
                          <div class="text-xs text-gray-500">{{ disk.free_gb || disk.free }} GB å¯ç”¨ / {{ disk.total_gb || disk.total }} GB</div>
                        </div>
                      </label>
                      <div v-if="window.nodeDisks?.length === 0"
                           class="text-center text-gray-400 py-4 text-sm">
                        è¯¥èŠ‚ç‚¹æš‚æ— å¯ç”¨ç£ç›˜
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- å·²é€‰ç£ç›˜ -->
            <div>
              <label class="block text-sm font-semibold mb-2">å·²é€‰ç£ç›˜ ({{ window.poolForm.disks?.length || 0 }})</label>
              <div class="border rounded-lg p-3 max-h-40 overflow-auto">
                <div v-if="!window.poolForm.disks || window.poolForm.disks.length === 0" class="text-center text-gray-400 py-4 text-sm">
                  å°šæœªé€‰æ‹©ä»»ä½•ç£ç›˜
                </div>
                <div class="flex flex-wrap gap-2">
                  <div v-for="(disk, idx) in (window.poolForm.disks || [])" :key="idx"
                       class="flex items-center gap-2 px-3 py-1.5 bg-blue-100 text-blue-800 rounded-full text-sm">
                    <span>ğŸ–¥ï¸ {{ disk.nodeName }} : {{ disk.disk }}</span>
                    <button @click="removeDiskFromSelection(window, idx)"
                            class="text-blue-600 hover:text-red-600 font-bold">Ã—</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="flex justify-end gap-3 p-6 border-t">
            <button @click="window.showCreatePoolDialog = false" class="px-4 py-2 border rounded-lg hover:bg-gray-100">å–æ¶ˆ</button>
            <button @click="saveCrossPool(window)"
                    :disabled="!window.poolForm.name || !window.poolForm.disks?.length"
                    :class="!window.poolForm.name || !window.poolForm.disks?.length ? 'bg-gray-300 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600'"
                    class="px-4 py-2 text-white rounded-lg">
              {{ window.poolEditMode ? 'ä¿å­˜ä¿®æ”¹' : 'åˆ›å»º' }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== èŠ‚ç‚¹å­˜å‚¨æ±  ========== -->
    <div v-else-if="window.spaceTab === 'node-pool'" class="flex gap-6 h-full">
      <!-- å·¦ä¾§ï¼šèŠ‚ç‚¹åˆ—è¡¨ -->
      <div class="w-72 bg-white rounded-lg shadow border p-4 flex-shrink-0">
        <h4 class="font-bold text-lg mb-4">é€‰æ‹©èŠ‚ç‚¹</h4>
        <div class="space-y-2 max-h-[500px] overflow-auto">
          <div v-for="node in (window.allNodes || [])" :key="node.id"
            @click="selectNodeForPool(window, node)"
            :class="window.selectedPoolNode?.id === node.id ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:bg-gray-50'"
            class="p-3 border-2 rounded-lg cursor-pointer transition-all">
            <div class="flex items-center gap-2">
              <span class="text-xl">ğŸ–¥ï¸</span>
              <div class="flex-1 min-w-0">
                <div class="font-semibold truncate">{{ node.name }}</div>
                <div class="text-xs text-gray-500 truncate">{{ node.ip || node.address || 'æœªçŸ¥åœ°å€' }}</div>
              </div>
              <span :class="node.online ? 'bg-green-500' : 'bg-gray-400'" class="w-2 h-2 rounded-full"></span>
            </div>
          </div>
          <div v-if="!window.allNodes || window.allNodes.length === 0" class="text-center text-gray-500 py-8">
            æš‚æ— å¯ç”¨èŠ‚ç‚¹
          </div>
        </div>
      </div>

      <!-- å³ä¾§ï¼šå­˜å‚¨æ± è¯¦æƒ… -->
      <div class="flex-1 min-w-0">
        <div v-if="!window.selectedPoolNode" class="h-full flex items-center justify-center bg-white rounded-lg shadow border">
          <div class="text-center text-gray-400">
            <div class="text-6xl mb-4">ğŸ‘ˆ</div>
            <p>è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹æŸ¥çœ‹å…¶å­˜å‚¨æ± </p>
          </div>
        </div>

        <div v-else-if="window.poolLoading" class="h-full flex items-center justify-center bg-white rounded-lg shadow border">
          <div class="loading"></div>
          <span class="ml-2">åŠ è½½ä¸­...</span>
        </div>

        <div v-else-if="window.poolStatus?.error" class="h-full flex items-center justify-center bg-white rounded-lg shadow border">
  <div class="text-center text-gray-500">
    <div class="text-6xl mb-4">âš ï¸</div>
    <p>{{ window.poolStatus.error }}</p>
    <div class="mt-4 flex gap-3 justify-center">
      <button @click="refreshNodePool(window)" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">ğŸ”„ é‡è¯•</button>
      <button @click="createNodePool(window)" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">â• åˆ›å»ºå­˜å‚¨æ± </button>
    </div>
  </div>
</div>

        <div v-else class="space-y-6">
          <!-- å­˜å‚¨æ± æ€»è§ˆ -->
          <div class="bg-white rounded-lg shadow border p-6">
            <div class="flex items-center justify-between mb-4">
              <h4 class="font-bold text-lg">ğŸ’¿ {{ window.selectedPoolNode.name }} - å­˜å‚¨æ± </h4>
              <div class="flex gap-2">
                <button @click="openAddDiskDialog(window)" class="px-3 py-1.5 bg-green-500 text-white rounded hover:bg-green-600 text-sm">â• æ·»åŠ ç£ç›˜</button>
                <button @click="rebalancePool(window, true)" class="px-3 py-1.5 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm">âš–ï¸ é‡å¹³è¡¡</button>
                <button @click="refreshNodePool(window)" class="px-3 py-1.5 bg-gray-200 rounded hover:bg-gray-300 text-sm">ğŸ”„</button>
              </div>
            </div>

            <!-- ç£ç›˜åˆ—è¡¨ -->
            <div v-if="window.poolStatus?.disks?.length" class="space-y-3">
              <div v-for="disk in window.poolStatus.disks" :key="disk.path" class="border rounded-lg p-4">
                <div class="flex items-center justify-between mb-2">
                  <div class="flex items-center gap-2">
                    <span class="text-xl">ğŸ’¾</span>
                    <div>
                      <div class="font-semibold">{{ disk.path }}</div>
                      <div class="text-xs text-gray-500">{{ disk.fstype || 'æœªçŸ¥æ–‡ä»¶ç³»ç»Ÿ' }}</div>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <span :class="disk.healthy !== false ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'" class="px-2 py-1 rounded text-xs">
                      {{ disk.healthy !== false ? 'å¥åº·' : 'å¼‚å¸¸' }}
                    </span>
                    <button @click="removeDiskFromPool(window, disk.path)" class="text-red-500 hover:text-red-700 text-sm">ç§»é™¤</button>
                  </div>
                </div>
                <div class="flex justify-between text-sm mb-1">
                  <span>å·²ç”¨: {{ ((disk.used || 0) / 1073741824).toFixed(1) }} GB / {{ ((disk.total || 0) / 1073741824).toFixed(1) }} GB</span>
                  <span>{{ disk.total ? Math.round((disk.used / disk.total) * 100) : 0 }}%</span>
                </div>
                <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                  <div :class="(disk.used/disk.total*100) > 80 ? 'bg-red-500' : (disk.used/disk.total*100) > 60 ? 'bg-yellow-500' : 'bg-green-500'"
                    :style="{width: (disk.total ? (disk.used/disk.total*100) : 0) + '%'}" class="h-full"></div>
                </div>
              </div>
            </div>
            <div v-else class="text-center text-gray-500 py-6">
              <p>è¯¥èŠ‚ç‚¹æš‚æ— å­˜å‚¨æ± ç£ç›˜</p>
              <button @click="createNodePool(window)" class="mt-3 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
                â• åˆ›å»ºå­˜å‚¨æ± 
              </button>
            </div>
          </div>

          <!-- é€»è¾‘å·ç®¡ç† -->
          <div class="bg-white rounded-lg shadow border p-6">
            <div class="flex items-center justify-between mb-4">
              <h4 class="font-bold text-lg">ğŸ“‚ é€»è¾‘å·</h4>
              <button @click="openCreateVolumeDialog(window)" class="px-3 py-1.5 bg-purple-500 text-white rounded hover:bg-purple-600 text-sm">â• æ–°å»º</button>
            </div>

            <div v-if="window.poolVolumes?.length" class="grid grid-cols-2 gap-4">
              <div v-for="vol in window.poolVolumes" :key="vol.name" class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-2xl">{{ vol.icon || 'ğŸ“' }}</span>
                  <div class="flex-1 min-w-0">
                    <div class="font-semibold truncate">{{ vol.display_name || vol.name }}</div>
                    <div class="text-xs text-gray-500">{{ vol.name }} Â· {{ vol.strategy || 'largest_free' }}</div>
                  </div>
                </div>
                <div class="text-sm text-gray-600 mb-3">
                  æ–‡ä»¶æ•°: {{ vol.file_count || 0 }} Â· å¤§å°: {{ ((vol.total_size || 0) / 1073741824).toFixed(2) }} GB
                </div>
                <div class="flex gap-2">
                  <button @click="openEditVolumeDialog(window, vol)" class="px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200">ç¼–è¾‘</button>
                  <button @click="deleteVolume(window, vol.name)" class="px-2 py-1 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200">åˆ é™¤</button>
                </div>
              </div>
            </div>
            <div v-else class="text-center text-gray-500 py-6">æš‚æ— é€»è¾‘å·</div>
          </div>
        </div>
      </div>

      <!-- æ·»åŠ ç£ç›˜å¯¹è¯æ¡† -->
      <div v-if="window.showAddDiskDialog" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-96 p-6">
          <h3 class="text-lg font-bold mb-4">æ·»åŠ ç£ç›˜åˆ°å­˜å‚¨æ± </h3>
          <div class="space-y-2 max-h-60 overflow-auto mb-4">
            <div v-for="disk in window.availableDisks" :key="disk.drive"
                 @click="window.selectedNewDisk = disk.drive"
                 :class="window.selectedNewDisk === disk.drive ? 'border-blue-500 bg-blue-50' : 'border-gray-200'"
                 class="p-3 border-2 rounded cursor-pointer hover:bg-gray-50">
              <div class="font-semibold">{{ disk.drive }}</div>
              <div class="text-xs text-gray-500">å¯ç”¨: {{ (disk.free / 1073741824).toFixed(1) }} GB / {{ (disk.total / 1073741824).toFixed(1) }} GB</div>
            </div>
            <div v-if="!window.availableDisks?.length" class="text-center text-gray-500 py-4">æ— å¯ç”¨ç£ç›˜</div>
          </div>
          <div class="flex justify-end gap-2">
            <button @click="window.showAddDiskDialog = false" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">å–æ¶ˆ</button>
            <button @click="addDiskToPool(window)" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">æ·»åŠ </button>
          </div>
        </div>
      </div>

      <!-- åˆ›å»ºå­˜å‚¨æ± å¯¹è¯æ¡† -->
<div v-if="window.showCreatePoolDialog" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-xl w-[450px] p-6">
    <h3 class="text-lg font-bold mb-4">â• åˆ›å»ºå­˜å‚¨æ± </h3>
    <p class="text-sm text-gray-500 mb-4">é€‰æ‹©è¦åŠ å…¥å­˜å‚¨æ± çš„ç£ç›˜ï¼ˆå¯å¤šé€‰ï¼Œå·²æ’é™¤ç³»ç»Ÿç›˜ï¼‰</p>
    <div class="space-y-2 max-h-72 overflow-auto mb-4">
      <div v-for="disk in window.createPoolDisks" :key="disk.drive"
           @click="toggleCreatePoolDisk(window, disk.drive)"
           :class="window.createPoolSelected.includes(disk.drive) ? 'border-green-500 bg-green-50' : 'border-gray-200 hover:bg-gray-50'"
           class="p-3 border-2 rounded-lg cursor-pointer transition-all">
        <div class="flex items-center gap-3">
          <span class="text-xl">{{ window.createPoolSelected.includes(disk.drive) ? 'â˜‘ï¸' : 'â¬œ' }}</span>
          <div class="flex-1">
            <div class="font-semibold">{{ disk.drive }}</div>
            <div class="text-xs text-gray-500">
              å¯ç”¨: {{ (disk.free / 1073741824).toFixed(1) }} GB / å…± {{ (disk.total / 1073741824).toFixed(1) }} GB
            </div>
          </div>
        </div>
      </div>
      <div v-if="!window.createPoolDisks?.length" class="text-center text-gray-500 py-8">
        <div class="text-3xl mb-2">ğŸ˜•</div>
        <p>æ— å¯ç”¨ç£ç›˜</p>
      </div>
    </div>
    <div v-if="window.createPoolSelected?.length" class="text-sm text-green-600 mb-4">
      å·²é€‰æ‹© {{ window.createPoolSelected.length }} ä¸ªç£ç›˜
    </div>
    <div class="flex justify-end gap-2">
      <button @click="window.showCreatePoolDialog = false" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">å–æ¶ˆ</button>
      <button @click="confirmCreateNodePool(window)"
              :disabled="!window.createPoolSelected?.length"
              :class="window.createPoolSelected?.length ? 'bg-green-500 hover:bg-green-600' : 'bg-gray-300 cursor-not-allowed'"
              class="px-4 py-2 text-white rounded-lg">
        åˆ›å»ºå­˜å‚¨æ± 
      </button>
    </div>
  </div>
</div>

      <!-- é€»è¾‘å·å¯¹è¯æ¡† -->
      <div v-if="window.showVolumeDialog" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-96 p-6">
          <h3 class="text-lg font-bold mb-4">{{ window.volumeEditMode ? 'ç¼–è¾‘' : 'æ–°å»º' }}é€»è¾‘å·</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium mb-1">å·å (è‹±æ–‡)</label>
              <input v-model="window.volumeForm.name" :disabled="window.volumeEditMode" class="w-full border rounded px-3 py-2" placeholder="å¦‚: movies">
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">æ˜¾ç¤ºåç§°</label>
              <input v-model="window.volumeForm.display_name" class="w-full border rounded px-3 py-2" placeholder="å¦‚: ç”µå½±åº“">
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">å›¾æ ‡</label>
              <div class="flex flex-wrap gap-2">
                <button v-for="icon in ['ğŸ“', 'ğŸ“‚', 'ğŸ—‚ï¸', 'ğŸ“¦', 'ğŸ¬', 'ğŸµ', 'ğŸ“·', 'ğŸ®', 'ğŸ’¾', 'ğŸ“š', 'ğŸ“€', 'ğŸ’¿', 'ğŸ–¥ï¸', 'â˜ï¸', 'ğŸ“', 'ğŸ”’']"
                        type="button"
                        :key="icon"
                        @click="window.volumeForm.icon = icon"
                        :class="window.volumeForm.icon === icon ? 'bg-blue-500 text-white' : 'bg-gray-100 hover:bg-gray-200'"
                        class="w-10 h-10 rounded-lg text-xl flex items-center justify-center transition">
                  {{ icon }}
                </button>
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">å­˜å‚¨ç­–ç•¥</label>
              <select v-model="window.volumeForm.strategy" class="w-full border rounded px-3 py-2">
                <option value="largest_free">æœ€å¤§å¯ç”¨ç©ºé—´ä¼˜å…ˆ</option>
                <option value="round_robin">è½®è¯¢åˆ†é…</option>
                <option value="random">éšæœºåˆ†é…</option>
              </select>
            </div>
          </div>
          <div class="flex justify-end gap-2 mt-6">
            <button @click="window.showVolumeDialog = false" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">å–æ¶ˆ</button>
            <button @click="saveVolume(window)" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">ä¿å­˜</button>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>



          <!-- æ–‡ä»¶ç®¡ç†çª—å£ -->
<div v-else-if="window.type === 'file-manager'" class="h-full flex flex-col bg-gray-50">
  <!-- æ ‡é¢˜æ  -->
  <div class="px-6 py-4 border-b bg-gradient-to-r from-yellow-50 to-orange-50">
    <h3 class="text-xl font-bold flex items-center gap-2">
      <span class="text-3xl">ğŸ“</span>
      æ–‡ä»¶ç®¡ç†
    </h3>
    <p class="text-sm text-gray-600 mt-1">æµè§ˆå’Œç®¡ç†å„èŠ‚ç‚¹çš„æ–‡ä»¶</p>
  </div>

  <!-- å·¥å…·æ  -->
  <div class="px-6 py-3 bg-white border-b flex items-center gap-4">
    <div class="flex-1 flex items-center gap-2">
      <span class="text-sm text-gray-500">ğŸ“</span>
      <span class="text-sm font-medium">
        {{ window.selectedFmNode?.name || 'æœªé€‰æ‹©' }}
      </span>
      <span v-if="window.selectedFmDisk" class="text-gray-400">/</span>
      <span v-if="window.selectedFmDisk" class="text-sm font-medium">{{ window.selectedFmDisk }}</span>
      <span v-if="window.currentPath" class="text-gray-400">/</span>
      <span v-if="window.currentPath" class="text-sm text-gray-600">{{ window.currentPath }}</span>
    </div>
    <button @click="refreshFileList(window)" class="px-3 py-1.5 text-sm bg-gray-100 rounded hover:bg-gray-200">
      ğŸ”„ åˆ·æ–°
    </button>
    <label class="px-3 py-1.5 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 cursor-pointer">
      ğŸ“¤ ä¸Šä¼ 
      <input type="file" multiple class="hidden" @change="handleFmUpload($event, window)">
    </label>
    <button @click="createFolder(window)" class="px-3 py-1.5 text-sm bg-green-500 text-white rounded hover:bg-green-600">
      ğŸ“ æ–°å»ºæ–‡ä»¶å¤¹
    </button>
  </div>

 <!-- ä¸‰æ å¸ƒå±€ -->
  <div class="flex-1 flex overflow-hidden">
    <!-- å·¦æ ï¼šèŠ‚ç‚¹åˆ—è¡¨ -->
    <div class="w-48 border-r bg-white flex flex-col">
      <!-- è·¨èŠ‚ç‚¹å­˜å‚¨ -->
      <div v-if="window.crossEcVolume" class="border-b">
        <div class="px-3 py-2 bg-gradient-to-r from-green-50 to-teal-50 text-sm font-semibold text-green-700">
          ğŸŒ è·¨èŠ‚ç‚¹å­˜å‚¨
        </div>
        <div @click="selectCrossEcVolume(window)"
             :class="window.selectedVolumeType === 'cross-ec' ? 'bg-green-50 border-l-4 border-green-500' : 'hover:bg-gray-50 border-l-4 border-transparent'"
             class="px-3 py-2 cursor-pointer transition-all">
          <div class="flex items-center gap-2">
            <span class="text-lg">ğŸ›¡ï¸</span>
            <span class="text-sm font-medium">ECçº åˆ ç å·</span>
          </div>
          <div class="text-xs text-gray-500 ml-6">K={{ window.crossEcVolume.k }}, M={{ window.crossEcVolume.m }}</div>
        </div>
      </div>

      <div class="px-3 py-2 bg-gray-50 border-b text-sm font-semibold text-gray-600">
        ğŸ“¡ èŠ‚ç‚¹
      </div>
      <div class="flex-1 overflow-auto">
        <div v-for="node in window.fmNodes" :key="node.id"
             @click="selectFmNode(window, node)"
             :class="window.selectedFmNode?.id === node.id && window.selectedVolumeType !== 'cross-ec' ? 'bg-blue-50 border-l-4 border-blue-500' : 'hover:bg-gray-50 border-l-4 border-transparent'"
             class="px-3 py-2 cursor-pointer transition-all">
          <div class="flex items-center gap-2">
            <span :class="node.status === 'online' ? 'text-green-500' : 'text-gray-400'">â—</span>
            <span class="text-sm font-medium truncate">{{ node.name }}</span>
          </div>
          <div class="text-xs text-gray-500 ml-4 truncate">{{ node.ip }}</div>
        </div>
        <div v-if="!window.fmNodes?.length" class="px-3 py-8 text-center text-gray-400 text-sm">
          æš‚æ— èŠ‚ç‚¹
        </div>
      </div>
    </div>

    <!-- ä¸­æ ï¼šå­˜å‚¨å·åˆ—è¡¨ -->
    <div class="w-52 border-r bg-white flex flex-col">
      <div class="px-3 py-2 bg-gray-50 border-b text-sm font-semibold text-gray-600">
        ğŸ’¾ å­˜å‚¨å·
      </div>
      <div class="flex-1 overflow-auto">
        <div v-if="window.fmDisksLoading" class="flex items-center justify-center py-8">
          <div class="loading"></div>
        </div>
        <template v-else>
          <!-- å•èŠ‚ç‚¹ECå· -->
          <div v-if="window.fmEcVolume"
               @click="selectFmVolume(window, 'ec', window.fmEcVolume)"
               :class="window.selectedVolumeType === 'single-ec' ? 'bg-green-50 border-l-4 border-green-500' : 'hover:bg-gray-50 border-l-4 border-transparent'"
               class="px-3 py-2 cursor-pointer transition-all border-b">
            <div class="flex items-center gap-2">
              <span class="text-lg">ğŸ›¡ï¸</span>
              <span class="text-sm font-semibold text-green-700">ECçº åˆ ç å·</span>
            </div>
            <div class="text-xs text-gray-500 ml-6">K={{ window.fmEcVolume.k }}, M={{ window.fmEcVolume.m }}</div>
          </div>

          <!-- å­˜å‚¨æ± é€»è¾‘å· -->
          <div v-for="vol in window.fmPoolVolumes || []" :key="vol.name"
               @click="selectFmVolume(window, 'pool', vol)"
               :class="window.selectedVolumeType === 'pool' && window.selectedPoolVolume?.name === vol.name ? 'bg-purple-50 border-l-4 border-purple-500' : 'hover:bg-gray-50 border-l-4 border-transparent'"
               class="px-3 py-2 cursor-pointer transition-all border-b">
            <div class="flex items-center gap-2">
              <span class="text-lg">{{ vol.icon || 'ğŸ“¦' }}</span>
              <span class="text-sm font-semibold text-purple-700">{{ vol.display_name || vol.name }}</span>
            </div>
            <div class="text-xs text-gray-500 ml-6">é€»è¾‘å·</div>
          </div>

          <!-- æ™®é€šç£ç›˜ -->
          <div v-if="window.fmDisks?.length" class="px-3 py-1 bg-gray-100 text-xs text-gray-500">
            æ™®é€šç£ç›˜
          </div>
          <div v-for="disk in window.fmDisks" :key="disk.mount"
               @click="selectFmDisk(window, disk.mount)"
               :class="window.selectedVolumeType === 'disk' && window.selectedFmDisk === disk.mount ? 'bg-blue-50 border-l-4 border-blue-500' : 'hover:bg-gray-50 border-l-4 border-transparent'"
               class="px-3 py-2 cursor-pointer transition-all">
            <div class="flex items-center gap-2">
              <span class="text-lg">ğŸ’¾</span>
              <span class="text-sm font-mono font-semibold">{{ disk.mount }}</span>
            </div>
            <div class="ml-6 mt-1">
              <div class="text-xs text-gray-500">
                {{ disk.free_gb || 0 }} GB / {{ disk.total_gb || 0 }} GB
              </div>
              <div class="mt-1 h-1.5 bg-gray-200 rounded-full overflow-hidden">
                <div class="h-full bg-blue-500" :style="{width: (disk.usage_percent || 0) + '%'}"></div>
              </div>
            </div>
          </div>

          <div v-if="window.selectedFmNode && !window.fmDisks?.length && !window.fmEcVolume && !window.fmPoolVolumes?.length"
               class="px-3 py-8 text-center text-gray-400 text-sm">
            æš‚æ— å­˜å‚¨å·
          </div>
          <div v-if="!window.selectedFmNode && window.selectedVolumeType !== 'cross-ec'"
               class="px-3 py-8 text-center text-gray-400 text-sm">
            â† è¯·å…ˆé€‰æ‹©èŠ‚ç‚¹
          </div>
        </template>
      </div>
    </div>

    <!-- å³æ ï¼šæ–‡ä»¶åˆ—è¡¨ -->
    <div class="flex-1 bg-white flex flex-col min-w-0">
      <div class="px-3 py-2 bg-gray-50 border-b text-sm font-semibold text-gray-600 flex items-center justify-between">
        <span>ğŸ“„ æ–‡ä»¶</span>
        <span v-if="window.fmFiles?.length" class="font-normal text-gray-400">
          {{ window.fmFiles.length }} é¡¹
        </span>
      </div>

      <div class="flex-1 overflow-auto">
        <div v-if="window.fmFilesLoading" class="flex items-center justify-center py-12">
          <div class="loading"></div>
        </div>

        <template v-else-if="window.selectedFmDisk">
          <!-- è¿”å›ä¸Šçº§ -->
          <div v-if="window.currentPath"
               @click="goUpFolder(window)"
               class="px-4 py-2 flex items-center gap-3 hover:bg-gray-50 cursor-pointer border-b">
            <span class="text-xl">â¬†ï¸</span>
            <span class="text-sm text-gray-600">..</span>
          </div>

          <!-- æ–‡ä»¶åˆ—è¡¨ -->
          <div v-for="file in window.fmFiles" :key="file.name"
               @click="toggleFileSelect(window, file)"
               @dblclick="openFileOrFolder(window, file)"
               :class="window.selectedFiles?.includes(file.name) ? 'bg-blue-50' : 'hover:bg-gray-50'"
               class="px-4 py-2 flex items-center gap-3 cursor-pointer border-b border-gray-100">
            <input type="checkbox"
                   :checked="window.selectedFiles?.includes(file.name)"
                   @click.stop
                   @change="toggleFileSelect(window, file)"
                   class="w-4 h-4">
            <span class="text-xl">{{ file.is_dir ? 'ğŸ“' : getFileIcon(file.name) }}</span>
            <div class="flex-1 min-w-0">
              <div class="text-sm font-medium truncate">{{ file.name }}</div>
              <div class="text-xs text-gray-500">
                {{ file.is_dir ? 'æ–‡ä»¶å¤¹' : formatBytes(file.size) }}
                <span class="ml-2">{{ formatDate(file.mtime) }}</span>
              </div>
            </div>
            <div class="flex gap-1">
              <button v-if="!file.is_dir" @click.stop="downloadFile(window, file)"
                      class="p-1 text-blue-500 hover:bg-blue-100 rounded" title="ä¸‹è½½">
                â¬‡ï¸
              </button>
              <button @click.stop="deleteFile(window, file)"
                      class="p-1 text-red-500 hover:bg-red-100 rounded" title="åˆ é™¤">
                ğŸ—‘ï¸
              </button>
            </div>
          </div>

          <div v-if="!window.fmFiles?.length" class="px-4 py-12 text-center text-gray-400">
            <div class="text-4xl mb-2">ğŸ“­</div>
            <div class="text-sm">æ–‡ä»¶å¤¹ä¸ºç©º</div>
          </div>
        </template>

        <div v-else class="px-4 py-12 text-center text-gray-400">
          <div class="text-4xl mb-2">ğŸ‘ˆ</div>
          <div class="text-sm">è¯·é€‰æ‹©èŠ‚ç‚¹å’Œç£ç›˜</div>
        </div>
      </div>

      <!-- åº•éƒ¨æ“ä½œæ  -->
      <div v-if="window.selectedFiles?.length > 0"
           class="px-4 py-3 bg-gray-50 border-t flex items-center justify-between">
        <span class="text-sm text-gray-600">å·²é€‰æ‹© {{ window.selectedFiles.length }} é¡¹</span>
        <div class="flex gap-2">
         <button @click.stop="previewSelected(window)"
        class="px-3 py-1.5 text-sm bg-green-500 text-white rounded hover:bg-green-600"
        title="é¢„è§ˆ">
  ğŸ‘ï¸ é¢„è§ˆ
</button>
          <button @click="downloadSelected(window)" class="px-3 py-1.5 text-sm bg-blue-500 text-white rounded hover:bg-blue-600">
            â¬‡ï¸ ä¸‹è½½
          </button>
          <button @click="deleteSelected(window)" class="px-3 py-1.5 text-sm bg-red-500 text-white rounded hover:bg-red-600">
            ğŸ—‘ï¸ åˆ é™¤
          </button>
          <button @click="window.selectedFiles = []" class="px-3 py-1.5 text-sm bg-gray-200 rounded hover:bg-gray-300">
            å–æ¶ˆé€‰æ‹©
          </button>
        </div>
      </div>
    </div>
  </div>
</div>


          <!-- é¢„è§ˆå¼¹çª— -->
<div v-if="window.showPreview && window.previewFile"
     class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50"
     @click.self="closePreview(window)">
  <div class="bg-white rounded-lg max-w-4xl max-h-[90vh] w-full mx-4 flex flex-col overflow-hidden">
    <!-- é¢„è§ˆå¤´éƒ¨ -->
    <div class="px-4 py-3 border-b flex items-center justify-between bg-gray-50">
      <span class="font-medium truncate">{{ window.previewFile.name }}</span>
      <div class="flex gap-2">
        <button @click="downloadFile(window, {name: window.previewFile.name})"
                class="px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600">
          ä¸‹è½½
        </button>
        <button @click="closePreview(window)"
                class="px-3 py-1 text-sm bg-gray-200 rounded hover:bg-gray-300">
          å…³é—­
        </button>
      </div>
    </div>

    <!-- é¢„è§ˆå†…å®¹ -->
    <div class="flex-1 overflow-auto p-4 flex items-center justify-center bg-gray-100">
      <!-- å›¾ç‰‡ -->
      <img v-if="['jpg','jpeg','png','gif','webp','bmp','svg'].includes(window.previewFile.ext)"
           :src="window.previewFile.url"
           class="max-w-full max-h-full object-contain">

      <!-- PDF -->
      <iframe v-else-if="window.previewFile.ext === 'pdf'"
              :src="window.previewFile.url"
              class="w-full h-full min-h-[600px]"></iframe>

      <!-- è§†é¢‘ -->
      <video v-else-if="['mp4','webm'].includes(window.previewFile.ext)"
             :src="window.previewFile.url"
             controls
             class="max-w-full max-h-full">
      </video>

      <!-- éŸ³é¢‘ -->
      <audio v-else-if="['mp3','wav'].includes(window.previewFile.ext)"
             :src="window.previewFile.url"
             controls>
      </audio>

      <!-- æ–‡æœ¬ç±» -->
      <iframe v-else-if="['txt','json','md','html','css','js'].includes(window.previewFile.ext)"
              :src="window.previewFile.url"
              class="w-full h-full min-h-[600px] bg-white"></iframe>

      <!-- ä¸æ”¯æŒçš„æ ¼å¼ -->
      <div v-else class="text-gray-500">
        æ­¤æ–‡ä»¶æ ¼å¼æš‚ä¸æ”¯æŒé¢„è§ˆ
      </div>
    </div>
  </div>
</div>

          <!-- æƒé™è®¾ç½®çª—å£ -->
          <div v-if="window.type === 'permissions'" class="h-full flex flex-col">
            <div v-if="window.loading" class="absolute inset-0 bg-white/50 flex items-center justify-center z-10" style="top: 0; left: 0; right: 0; bottom: 0;">
              <div class="loading"></div> <span class="ml-2">æ­£åœ¨åŠ è½½æ•°æ®...</span>
            </div>
            <div class="px-6 py-4 border-b bg-gradient-to-r from-orange-50 to-red-50">
              <h3 class="text-xl font-bold flex items-center gap-2">
                <span class="text-3xl">ğŸ”’</span>
                æƒé™ç®¡ç†
              </h3>
              <p class="text-sm text-gray-600 mt-1">é…ç½®ç”¨æˆ·å’ŒèŠ‚ç‚¹çš„è®¿é—®æƒé™</p>
            </div>

            <div class="flex-1 overflow-auto p-6 bg-gray-50">

               <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
  <div class="flex gap-2 mb-6 border-b">
    <button @click="window.permissionTab = 'users'"
            :class="window.permissionTab === 'users' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'"
            class="px-4 py-2 font-semibold">
      ğŸ‘¥ ç”¨æˆ·æƒé™
    </button>
    <button @click="window.permissionTab = 'groups'"
            :class="window.permissionTab === 'groups' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'"
            class="px-4 py-2 font-semibold">
      ğŸ“ èŠ‚ç‚¹åˆ†ç»„
    </button>
    <button @click="window.permissionTab = 'nodes'"
            :class="window.permissionTab === 'nodes' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'"
            class="px-4 py-2 font-semibold">
      ğŸ–¥ï¸ èŠ‚ç‚¹æ§åˆ¶
    </button>
  </div>

<div v-if="window.permissionTab === 'users'">
              <!-- ç”¨æˆ·æƒé™ç®¡ç† -->
              <div class="bg-white rounded-lg shadow border p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                  <h4 class="font-bold text-lg">ç”¨æˆ·è®¿é—®æƒé™</h4>
                  <button @click="createUser(window)"
        class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
  + æ·»åŠ ç”¨æˆ·
</button>
                </div>

                <table class="w-full">
                  <thead class="bg-gray-50 border-b">
                    <tr>
                      <th class="text-left p-3 font-semibold text-gray-700">ç”¨æˆ·å</th>
                      <th class="text-left p-3 font-semibold text-gray-700">è§’è‰²</th>
                      <th class="text-left p-3 font-semibold text-gray-700">æ–‡ä»¶æƒé™</th>
                      <th class="text-left p-3 font-semibold text-gray-700">èŠ‚ç‚¹æƒé™</th>
                      <th class="text-left p-3 font-semibold text-gray-700">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody v-if="!window.loading">
  <tr v-if="!window.users || window.users.length === 0">
    <td colspan="5" class="p-8 text-center text-gray-500">
      <div class="text-4xl mb-2">ğŸ‘¥</div>
      <div class="text-sm">æš‚æ— ç”¨æˆ·</div>
    </td>
  </tr>
  <tr v-for="user in window.users || []" :key="user.id" class="border-b hover:bg-gray-50">

    <td class="p-3">
      <div class="flex items-center gap-2">
        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-xs">
          {{ user.username[0].toUpperCase() }}
        </div>
        <span class="font-semibold">{{ user.username }}</span>
      </div>
    </td>

    <td class="p-3">
      <select v-model="user.role" @change="updateUserPermissions(user)"
              :disabled="user.username === 'admin'"
              class="px-3 py-1 border rounded text-xs"
              :class="{ 'cursor-not-allowed bg-gray-100': user.username === 'admin' }">
        <option value="admin">ğŸ‘‘ ç®¡ç†å‘˜</option>
        <option value="user">ğŸ‘¤ æ™®é€šç”¨æˆ·</option>
        <option value="guest">ğŸ‘ï¸ è®¿å®¢</option>
      </select>
    </td>

    <td class="p-3">
      <select v-model="user.file_permission" @change="updateUserPermissions(user)"
              :disabled="user.username === 'admin'"
              class="px-3 py-1 border rounded text-xs"
              :class="{ 'cursor-not-allowed bg-gray-100': user.username === 'admin' }">
        <option value="readonly">ğŸ‘ï¸ åªè¯»</option>
        <option value="readwrite">âœï¸ è¯»å†™</option>
        <option value="fullcontrol">ğŸ”“ å®Œå…¨æ§åˆ¶</option>
      </select>
    </td>

    <td class="p-3">
      <select v-model="user.node_access.type" @change="updateUserNodeAccess(user)"
              :disabled="user.username === 'admin'"
              class="px-3 py-1 border rounded text-xs"
              :class="{ 'cursor-not-allowed bg-gray-100': user.username === 'admin' }">
        <option value="all">âœ“ æ‰€æœ‰èŠ‚ç‚¹</option>
        <option value="groups">æŒ‰åˆ†ç»„</option>
        <option value="custom">è‡ªå®šä¹‰</option>
      </select>
    </td>

    <td class="p-3">
      <div v-if="user.username === 'admin'" class="flex gap-2">
        <button class="px-3 py-1 bg-gray-300 text-gray-500 rounded text-xs cursor-not-allowed">
          ç³»ç»Ÿç®¡ç†å‘˜
        </button>
      </div>
      <div v-else class="flex gap-2">
        <button @click="openUserAccessDetail(user)" class="px-3 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600">
          ç¼–è¾‘
        </button>
        <button @click="deleteUser(window, user)" class="px-3 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600">
          åˆ é™¤
        </button>
      </div>
    </td>
  </tr>
</tbody>
                </table>
              </div>

              <!-- æƒé™ç±»å‹è¯´æ˜ -->
              <div class="bg-white rounded-lg shadow border p-6 mb-6">
                <h4 class="font-bold text-lg mb-4">æƒé™è¯´æ˜</h4>
                <div class="grid grid-cols-3 gap-4">
                  <div class="border rounded-lg p-4">
                    <div class="text-3xl mb-2">ğŸ‘ï¸</div>
                    <div class="font-semibold mb-1">åªè¯»æƒé™</div>
                    <div class="text-xs text-gray-600">
                     â€¢ æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨<br>
                      â€¢ ä¸‹è½½æ–‡ä»¶<br>
                      â€¢ ğŸš« ä¸èƒ½ä¸Šä¼ /ä¿®æ”¹/åˆ é™¤æ–‡ä»¶<br>
                      â€¢ ğŸš« ä¸èƒ½è¿›è¡Œç³»ç»Ÿé…ç½®
                    </div>
                  </div>

                  <div class="border rounded-lg p-4">
                    <div class="text-3xl mb-2">âœï¸</div>
                    <div class="font-semibold mb-1">è¯»å†™æƒé™</div>
                    <div class="text-xs text-gray-600">
                      â€¢ æ‰€æœ‰åªè¯»æƒé™<br>
                      â€¢ ä¸Šä¼ æ–‡ä»¶<br>
                      â€¢ åˆ›å»ºæ–‡ä»¶å¤¹<br>
                      â€¢ é‡å‘½åæ–‡ä»¶<br>
                      â€¢ åˆ é™¤è‡ªå·±çš„æ–‡ä»¶
                    </div>
                  </div>

                  <div class="border rounded-lg p-4">
                    <div class="text-3xl mb-2">ğŸ”“</div>
                    <div class="font-semibold mb-1">å®Œå…¨æ§åˆ¶</div>
                    <div class="text-xs text-gray-600">
                      â€¢ æ‰€æœ‰è¯»å†™æƒé™<br>
                      â€¢ åˆ é™¤ä»»ä½•æ–‡ä»¶<br>
                      â€¢ ä¿®æ”¹æƒé™<br>
                      â€¢ ç³»ç»Ÿé…ç½®<br>
                      â€¢ ç”¨æˆ·ç®¡ç†
                    </div>
                  </div>
                  <!-- åŠ å¯†åŠŸèƒ½è¯´æ˜ -->
<div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 p-6 mt-4">
  <div class="flex items-start gap-3">
    <div class="text-3xl">ğŸ”</div>
    <div class="flex-1">
      <div class="font-semibold text-lg mb-2">æ–‡ä»¶åŠ å¯†</div>
      <div class="text-sm text-gray-700">
        â€¢ <span class="font-medium">æƒé™è¦æ±‚:</span> è¯»å†™æƒé™åŠä»¥ä¸Šç”¨æˆ·<br>
        â€¢ <span class="font-medium">ä¸»è¦ä½œç”¨:</span> å¯¹æ•æ„Ÿæ–‡ä»¶è¿›è¡Œç«¯åˆ°ç«¯åŠ å¯†å­˜å‚¨,ç¡®ä¿æ•°æ®å®‰å…¨<br>
        â€¢ <span class="font-medium">åŠŸèƒ½:</span> åŠ å¯†ä¸Šä¼ ã€è§£å¯†ä¸‹è½½ã€å¯†é’¥ç®¡ç†
      </div>
    </div>
  </div>
</div>
                </div>
              </div>
              </div>

              <!-- èŠ‚ç‚¹åˆ†ç»„æ ‡ç­¾é¡µ -->
  <div v-if="window.permissionTab === 'groups'">
    <div class="bg-white rounded-lg shadow border p-6">
      <div class="flex justify-between items-center mb-4">
        <h4 class="font-bold text-lg">èŠ‚ç‚¹åˆ†ç»„ç®¡ç†</h4>
        <button @click="openCreateGroupDialog(window)"
                class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
          + åˆ›å»ºåˆ†ç»„
        </button>
      </div>

      <!-- åˆ†ç»„åˆ—è¡¨ -->
      <div class="space-y-3">
        <div v-if="window.groups && window.groups.length === 0" class="text-center py-8 text-gray-500">
          <div class="text-4xl mb-2">ğŸ“¦</div>
          <div class="text-sm">è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•åˆ†ç»„</div>
          <div class="text-xs mt-1">ç‚¹å‡»ä¸Šæ–¹"åˆ›å»ºåˆ†ç»„"æŒ‰é’®å¼€å§‹</div>
        </div>
        <div v-for="group in window.groups || []" :key="group.id"
             class="border rounded-lg p-4 hover:bg-gray-50">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <span class="text-3xl">{{ group.icon }}</span>
              <div>
                <div class="font-semibold">{{ group.name }}</div>
                <div class="text-xs text-gray-600">{{ group.description }}</div>
                <div class="text-xs text-gray-500 mt-1">
                  åŒ…å« {{ (group.nodes || []).length }} ä¸ªèŠ‚ç‚¹
                </div>
              </div>
            </div>
            <div class="flex gap-2">
              <button @click="openEditGroupDialog(window, group)"
                      class="px-3 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600">
                ç¼–è¾‘
              </button>
              <button @click="deleteNodeGroup(window, group)"
                      class="px-3 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600">
                åˆ é™¤
              </button>
            </div>
          </div>

          <!-- èŠ‚ç‚¹åˆ—è¡¨ -->
          <div v-if="group.nodes && group.nodes.length > 0" class="mt-3 pt-3 border-t">
            <div class="flex flex-wrap gap-2">
              <span v-for="nodeId in group.nodes" :key="nodeId"
                    class="px-2 py-1 bg-gray-100 rounded text-xs">
                ğŸ–¥ï¸ {{ getNodeName(nodeId) }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

              <!-- èŠ‚ç‚¹è®¿é—®æ§åˆ¶æ ‡ç­¾é¡µ -->
  <div v-if="window.permissionTab === 'nodes'">
              <div class="bg-white rounded-lg shadow border p-6">
  <h4 class="font-bold text-lg mb-4">èŠ‚ç‚¹è®¿é—®æ§åˆ¶</h4>
  <div class="space-y-3">

    <div v-if="window.nodes && window.nodes.length === 0" class="text-center py-8 text-gray-500">
      <div class="text-4xl mb-2">ğŸ–¥ï¸</div>
      <div class="text-sm">æš‚æ— èŠ‚ç‚¹</div>
    </div>

    <div v-for="node in window.nodes || []" :key="node.id"
         class="flex items-center justify-between p-4 border rounded-lg">
      <div class="flex items-center gap-3">
        <div class="text-3xl">ğŸ–¥ï¸</div>
        <div>
          <div class="font-semibold">{{ node.name }}</div>
          <div class="text-xs text-gray-600">{{ node.ip }}:{{ node.port }}</div>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <span class="text-xs text-gray-600">è®¿é—®ç­–ç•¥:</span>
        <select :value="node.access_policy || 'all_users'"
        @change="updateNodePolicy(node.id, $event.target.value)"
                class="px-3 py-1 border rounded text-sm">
          <option value="all_users">æ‰€æœ‰ç”¨æˆ·</option>
          <option value="admin_only">ä»…ç®¡ç†å‘˜</option>
          <option value="whitelist">ç™½åå•ç”¨æˆ·</option>
          <option value="disabled">ç¦æ­¢è®¿é—®</option>
        </select>
      </div>
    </div>



</div>
              </div>

  <!-- ç™½åå•ç®¡ç†åŒºåŸŸ -->

  <div class="bg-white rounded-lg shadow border p-6 mt-6">
    <h4 class="font-bold text-lg mb-4">ğŸ“‹ ç™½åå•ç”¨æˆ·ç®¡ç†</h4>
    <p class="text-sm text-gray-600 mb-4">å°†ç”¨æˆ·åŠ å…¥ç™½åå•åï¼Œæ‰€æœ‰è®¾ç½®ä¸º"ç™½åå•ç”¨æˆ·"ç­–ç•¥çš„èŠ‚ç‚¹éƒ½å…è®¸è¿™äº›ç”¨æˆ·è®¿é—®</p>

    <div class="flex gap-6">
      <!-- æ·»åŠ ç”¨æˆ· -->
      <div class="flex-1">
        <div class="text-sm font-semibold mb-2">æ·»åŠ ç”¨æˆ·åˆ°ç™½åå•</div>
        <select @change="addToWhitelist($event.target.value); $event.target.value=''"
                class="w-full px-3 py-2 border rounded">
          <option value="">é€‰æ‹©ç”¨æˆ·...</option>
          <option v-for="user in allUsersForWhitelist.filter(u => !whitelistUsers.find(w => w.user_id === u.id))"
                  :key="user.id" :value="user.id">
            {{ user.username }}
          </option>
        </select>
      </div>

      <!-- ç™½åå•åˆ—è¡¨ -->
      <div class="flex-1">
        <div class="text-sm font-semibold mb-2">å½“å‰ç™½åå•ç”¨æˆ· ({{ whitelistUsers.length }}äºº)</div>
        <div class="border rounded max-h-40 overflow-y-auto">
          <div v-if="whitelistUsers.length === 0" class="p-3 text-gray-500 text-sm text-center">
            æš‚æ— ç™½åå•ç”¨æˆ·
          </div>
          <div v-for="user in whitelistUsers" :key="user.id"
               class="flex justify-between items-center p-2 border-b last:border-b-0 hover:bg-gray-50">
            <span class="text-sm">ğŸ‘¤ {{ user.username }}</span>
            <button @click="removeFromWhitelist(user.user_id)"
                    class="text-red-500 text-xs hover:text-red-700">ç§»é™¤</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>
</div>

              <!-- æç¤ºä¿¡æ¯ -->
              <div class="mt-6 bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
                <div class="flex items-start gap-3">
                  <span class="text-2xl">âš ï¸</span>
                  <div class="text-sm text-yellow-800">
                    <p class="font-semibold mb-1">æƒé™ç®¡ç†æ³¨æ„äº‹é¡¹:</p>
                    <ul class="list-disc list-inside space-y-1">
                      <li>ä¿®æ”¹æƒé™åç«‹å³ç”Ÿæ•ˆ,è¯·è°¨æ…æ“ä½œ</li>
                      <li>å»ºè®®å®šæœŸå®¡æŸ¥ç”¨æˆ·æƒé™,ç¡®ä¿å®‰å…¨</li>
                      <li>è‡³å°‘ä¿ç•™ä¸€ä¸ªç®¡ç†å‘˜è´¦å·</li>
                      <li>è®¿å®¢è´¦å·å»ºè®®ä»…æˆäºˆåªè¯»æƒé™</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>


        <!-- ğŸ” åŠ å¯†ç®¡ç†çª—å£ -->
<div v-if="window.type === 'encryption'" class="h-full flex flex-col">

  <!-- é¡¶éƒ¨æ ‡é¢˜ -->
  <div class="px-6 py-4 border-b bg-gradient-to-r from-indigo-50 to-purple-50 flex justify-between items-center">
    <div>
      <h3 class="text-xl font-bold flex items-center gap-2">
        <span class="text-3xl">ğŸ”</span>
        åŠ å¯†ç®¡ç†ä¸­å¿ƒ
      </h3>
      <p class="text-sm text-gray-600 mt-1">ç®¡ç†èŠ‚ç‚¹åŠ å¯†ä¸ç£ç›˜åŠ å¯†çŠ¶æ€</p>
    </div>
    <div v-if="window.encryptionView === 'detail'">
      <button @click="returnToEncryptionOverview(window)"
              class="px-4 py-2 bg-white border rounded-lg hover:bg-gray-50 transition">
        â† è¿”å›èŠ‚ç‚¹åˆ—è¡¨
      </button>
    </div>
  </div>

<!-- åŠ å¯†é¡µé¢å†…å®¹ - ä¸€çº§èŠ‚ç‚¹åˆ—è¡¨ -->
  <div v-if="window.encryptionView === 'overview'" class="flex-1 p-6 bg-gray-50 overflow-auto">

    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <div class="grid grid-cols-4 gap-4 mb-6">
      <div class="bg-white rounded-xl p-4 border shadow-sm">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center text-2xl">ğŸ–¥ï¸</div>
          <div>
            <div class="text-2xl font-bold text-gray-800">{{ window.nodes.length }}</div>
            <div class="text-xs text-gray-500">æ€»èŠ‚ç‚¹æ•°</div>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-xl p-4 border shadow-sm">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center text-2xl">âœ…</div>
          <div>
           <div class="text-2xl font-bold text-green-600">{{ window.nodes.filter(n => n.status === 'online').length }}</div>
            <div class="text-xs text-gray-500">åœ¨çº¿èŠ‚ç‚¹</div>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-xl p-4 border shadow-sm">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center text-2xl">ğŸ”</div>
          <div>
            <div class="text-2xl font-bold text-purple-600">{{ window.encryptedNodeCount || 0 }}</div>
            <div class="text-xs text-gray-500">å·²åŠ å¯†èŠ‚ç‚¹</div>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-xl p-4 border shadow-sm">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center text-2xl">ğŸ”’</div>
          <div>
            <div class="text-2xl font-bold text-yellow-600">{{ window.lockedDiskCount || 0 }}</div>
            <div class="text-xs text-gray-500">å·²é”å®šç£ç›˜</div>
          </div>
        </div>
      </div>
    </div>

    <!-- èŠ‚ç‚¹åˆ—è¡¨æ ‡é¢˜ -->
    <div class="flex items-center justify-between mb-4">
      <h4 class="text-lg font-semibold text-gray-700">é€‰æ‹©èŠ‚ç‚¹è¿›è¡Œç£ç›˜åŠ å¯†ç®¡ç†</h4>
      <button @click="loadEncryptionNodes(window)"
              class="px-3 py-1.5 text-sm bg-white border rounded-lg hover:bg-gray-50 flex items-center gap-1">
        ğŸ”„ åˆ·æ–°
      </button>
    </div>

    <div v-if="window.loading" class="text-center text-gray-500 py-12">
      <div class="text-4xl mb-2">â³</div>
      åŠ è½½èŠ‚ç‚¹ä¸­...
    </div>

    <div v-else-if="window.nodes.length === 0" class="text-center py-12">
      <div class="text-6xl mb-4">ğŸ“­</div>
      <p class="text-gray-500">æš‚æ— å¯ç”¨èŠ‚ç‚¹</p>
      <p class="text-sm text-gray-400 mt-1">è¯·å…ˆåœ¨èŠ‚ç‚¹ç®¡ç†ä¸­æ·»åŠ èŠ‚ç‚¹</p>
    </div>

    <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div v-for="node in window.nodes" :key="node.id"
           @click="openEncryptionDetail(window, node)"
           class="bg-white rounded-xl border overflow-hidden hover:shadow-lg hover:border-blue-400 cursor-pointer transition-all group">

        <!-- èŠ‚ç‚¹å¤´éƒ¨ -->
        <div class="px-5 py-4 border-b bg-gradient-to-r from-slate-50 to-gray-50 group-hover:from-blue-50 group-hover:to-indigo-50 transition-all">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-white rounded-lg shadow-sm flex items-center justify-center text-xl border">
                ğŸ–¥ï¸
              </div>
              <div>
                <h4 class="font-bold text-gray-800">{{ node.name }}</h4>
                <p class="text-xs text-gray-500 font-mono">{{ node.ip }}:{{ node.port }}</p>
              </div>
            </div>
            <span class="text-gray-400 group-hover:text-blue-500 transition-colors">â†’</span>
          </div>
        </div>

        <!-- èŠ‚ç‚¹çŠ¶æ€ -->
        <div class="px-5 py-4">
  <div class="flex items-center justify-between mb-3">
    <span class="text-sm text-gray-600">è¿æ¥çŠ¶æ€</span>
    <span v-if="node.status === 'online'" class="flex items-center gap-1 text-sm text-green-600 font-medium">
      <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> åœ¨çº¿
    </span>
    <span v-else class="flex items-center gap-1 text-sm text-red-500 font-medium">
      <span class="w-2 h-2 bg-red-500 rounded-full"></span> ç¦»çº¿
    </span>
  </div>
          <div class="flex items-center justify-between mb-3">
            <span class="text-sm text-gray-600">åŠ å¯†ç£ç›˜</span>
            <span class="text-sm font-medium" :class="node.encryptedDisks > 0 ? 'text-purple-600' : 'text-gray-400'">
              {{ node.encryptedDisks || 0 }} ä¸ª
            </span>
          </div>

          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-600">é”å®šçŠ¶æ€</span>
            <span v-if="node.lockedDisks > 0" class="text-sm text-yellow-600 font-medium">
              ğŸ”’ {{ node.lockedDisks }} ä¸ªå·²é”å®š
            </span>
            <span v-else class="text-sm text-gray-400">æ— é”å®š</span>
          </div>
        </div>

        <!-- åº•éƒ¨æ“ä½œæç¤º -->
        <div class="px-5 py-3 bg-gray-50 border-t text-center">
          <span class="text-xs text-gray-500 group-hover:text-blue-600 transition-colors">
            ç‚¹å‡»ç®¡ç†ç£ç›˜åŠ å¯† â†’
          </span>
        </div>
      </div>
    </div>
  </div>
  <!-- ç¬¬äºŒçº§ç£ç›˜åŠ å¯†é¡µ -->
<!-- ç¬¬äºŒçº§ç£ç›˜åŠ å¯†é¡µ -->
<div v-else-if="window.encryptionView === 'detail'" class="flex flex-1 overflow-hidden">
  <div class="flex-1 bg-gray-50 p-6 overflow-y-auto">
    <h4 class="text-lg font-semibold text-gray-700 mb-4">
      {{ window.selectedNodeName }} çš„ç£ç›˜åŠ å¯†ç®¡ç†
    </h4>

    <div v-if="window.loading" class="text-center py-8 text-gray-500">åŠ è½½ç£ç›˜ä¸­...</div>

    <div v-else>
      <!-- æ‰¹é‡æ“ä½œæ  -->
      <div class="mb-4 p-4 bg-white rounded-lg border flex items-center justify-between">
        <div class="flex items-center gap-4">
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox"
                   :checked="isAllEncryptableSelected(window)"
                   @change="toggleSelectAllEncryptable(window)"
                   class="w-4 h-4 rounded">
            <span class="text-sm text-gray-700">å…¨é€‰å¯åŠ å¯†ç£ç›˜</span>
          </label>
          <span class="text-sm text-gray-500">
            å·²é€‰æ‹© {{ getSelectedDisksCount(window) }} ä¸ªç£ç›˜
          </span>
        </div>
        <button v-if="getSelectedDisksCount(window) > 0"
                @click="batchEncryptDisks(window)"
                class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 flex items-center gap-2">
          ğŸ” æ‰¹é‡å¯ç”¨åŠ å¯†
        </button>
      </div>

      <!-- æç¤ºä¿¡æ¯ -->
      <div class="mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-sm text-yellow-800">
        âš ï¸ ç³»ç»Ÿç›˜ (C:) å’Œæ•°æ®ç›˜ (D:) å·²è‡ªåŠ¨æ’é™¤ï¼Œä¸å¯è¿›è¡ŒåŠ å¯†æ“ä½œ
      </div>

      <table class="w-full text-sm border border-gray-200 bg-white rounded-lg overflow-hidden">
        <thead class="bg-gray-100 text-gray-700">
          <tr>
            <th class="border px-2 py-2 w-10 text-center">é€‰æ‹©</th>
            <th class="border px-2 py-2 text-left">æŒ‚è½½ç‚¹</th>
            <th class="border px-2 py-2 text-left">å®¹é‡(GB)</th>
            <th class="border px-2 py-2 text-left">çŠ¶æ€</th>
            <th class="border px-2 py-2 text-center">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="disk in window.encryptionDisks" :key="disk.mount"
              :class="{'bg-gray-100 opacity-60': isDiskExcluded(disk.mount)}"
              class="hover:bg-gray-50">
            <td class="border px-2 py-2 text-center">
              <input v-if="!isDiskExcluded(disk.mount) && !disk.is_encrypted"
                     type="checkbox"
                     v-model="disk.selected"
                     class="w-4 h-4 rounded cursor-pointer">
              <span v-else-if="isDiskExcluded(disk.mount)" class="text-gray-400">ğŸš«</span>
              <span v-else class="text-gray-400">-</span>
            </td>
            <td class="border px-2 py-2 font-mono">
              {{ disk.mount }}
              <span v-if="isDiskExcluded(disk.mount)" class="ml-2 text-xs text-gray-500">(å·²æ’é™¤)</span>
            </td>
            <td class="border px-2 py-2">{{ disk.capacity_gb }}</td>
            <td class="border px-2 py-2">
              <span v-if="isDiskExcluded(disk.mount)" class="text-gray-400">ç³»ç»Ÿä¿æŠ¤</span>
              <span v-else-if="disk.is_encrypted && disk.is_locked" class="text-yellow-600 font-semibold">ğŸ”’ å·²é”å®š</span>
              <span v-else-if="disk.is_encrypted && !disk.is_locked" class="text-green-600 font-semibold">âœ… å·²åŠ å¯†</span>
              <span v-else class="text-gray-500">æœªåŠ å¯†</span>
            </td>
            <td class="border px-2 py-2 text-center">
              <!-- æ’é™¤çš„ç£ç›˜ä¸æ˜¾ç¤ºæ“ä½œ -->
              <span v-if="isDiskExcluded(disk.mount)" class="text-gray-400 text-xs">ä¸å¯æ“ä½œ</span>

              <!-- æœªåŠ å¯†ï¼šå¯ç”¨åŠ å¯† -->
              <button v-else-if="!disk.is_encrypted"
                      @click="encryptDisk(window, window.selectedNodeId, disk.mount)"
                      class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600">
                ğŸ” å¯ç”¨åŠ å¯†
              </button>

              <!-- å·²åŠ å¯† + å·²é”å®šï¼šè§£é” -->
              <button v-else-if="disk.is_locked"
                      @click="unlockDisk(window, window.selectedNodeId, disk.mount)"
                      class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">
                ğŸ”“ è§£é”
              </button>

              <!-- å·²åŠ å¯† + å·²è§£é”ï¼šæ˜¾ç¤º3ä¸ªæ“ä½œ -->
              <div v-else class="flex justify-center gap-2">
                <button @click="lockDisk(window, window.selectedNodeId, disk.mount)"
                        class="px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600">
                  ğŸ”’ é”å®š
                </button>
                <button @click="decryptDisk(window, window.selectedNodeId, disk.mount)"
                        class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600">
                  ğŸ§¹ æ°¸ä¹…è§£å¯†
                </button>
                <button @click="changePassword(window, window.selectedNodeId, disk.mount)"
                        class="px-3 py-1 bg-purple-500 text-white rounded hover:bg-purple-600">
                  ğŸ”‘ æ”¹å¯†ç 
                </button>
              </div>
            </td>
          </tr>
          <tr v-if="!window.encryptionDisks.length">
            <td colspan="5" class="text-center text-gray-500 py-4">æš‚æ— ç£ç›˜æ•°æ®</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

</div>

<!-- çº åˆ ç é…ç½®çª—å£ -->
<div v-else-if="window.type === 'ec-config'" class="h-full flex flex-col bg-gray-50">
  <!-- æ ‡é¢˜æ  -->
  <div class="px-6 py-4 border-b bg-gradient-to-r from-green-50 to-teal-50">
    <h3 class="text-xl font-bold flex items-center gap-2">
      <span class="text-3xl">ğŸ›¡ï¸</span>
      çº åˆ ç é…ç½®
    </h3>
    <p class="text-sm text-gray-600 mt-1">é…ç½®è·¨èŠ‚ç‚¹æˆ–å•èŠ‚ç‚¹çš„çº åˆ ç ä¿æŠ¤</p>
  </div>

  <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
  <div class="flex gap-2 px-6 pt-4 border-b bg-white">
    <button @click="window.ecTab = 'cross-node'"
      :class="window.ecTab === 'cross-node' ? 'border-b-2 border-green-500 text-green-600 font-semibold' : 'text-gray-500 hover:text-gray-700'"
      class="px-4 py-2 -mb-px">
      ğŸŒ èŠ‚ç‚¹é—´EC
    </button>
    <button @click="window.ecTab = 'single-node'"
      :class="window.ecTab === 'single-node' ? 'border-b-2 border-green-500 text-green-600 font-semibold' : 'text-gray-500 hover:text-gray-700'"
      class="px-4 py-2 -mb-px">
      ğŸ’¾ å•èŠ‚ç‚¹EC
    </button>
    <button @click="window.ecTab = 'status'"
      :class="window.ecTab === 'status' ? 'border-b-2 border-green-500 text-green-600 font-semibold' : 'text-gray-500 hover:text-gray-700'"
      class="px-4 py-2 -mb-px">
      ğŸ“Š çŠ¶æ€ç›‘æ§
    </button>
    <button @click="window.ecTab = 'upload'"
      :class="window.ecTab === 'upload' ? 'border-b-2 border-green-500 text-green-600 font-semibold' : 'text-gray-500 hover:text-gray-700'"
      class="px-4 py-2 -mb-px">
      ğŸ“¤ ä¸Šä¼ æ–‡ä»¶
    </button>
  </div>

  <div class="flex-1 overflow-auto p-6">

    <!-- ========== èŠ‚ç‚¹é—´EC ========== -->
    <div v-if="window.ecTab === 'cross-node'">
      <!-- å·²æœ‰è·¨èŠ‚ç‚¹ECé…ç½® -->
      <div v-if="window.crossEcConfig" class="bg-white rounded-lg shadow border p-6 mb-6">
        <div class="flex justify-between items-start mb-4">
          <div>
            <h4 class="text-xl font-bold flex items-center gap-2">
              <span class="text-green-500">âœ…</span> è·¨èŠ‚ç‚¹ECå·²é…ç½®
            </h4>
            <p class="text-sm text-gray-600 mt-1">æ•°æ®åˆ†ç‰‡å­˜å‚¨åœ¨å¤šä¸ªèŠ‚ç‚¹çš„ç£ç›˜ä¸Š</p>
          </div>
          <button @click="deleteCrossEcConfig(window)" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm">
            åˆ é™¤é…ç½®
          </button>
        </div>

        <div class="grid grid-cols-4 gap-4 mb-6">
          <div class="bg-blue-50 p-4 rounded-lg text-center">
            <div class="text-sm text-gray-600 mb-1">æ•°æ®å— (K)</div>
            <div class="text-3xl font-bold text-blue-600">{{ window.crossEcConfig.k }}</div>
          </div>
          <div class="bg-purple-50 p-4 rounded-lg text-center">
            <div class="text-sm text-gray-600 mb-1">æ ¡éªŒå— (M)</div>
            <div class="text-3xl font-bold text-purple-600">{{ window.crossEcConfig.m }}</div>
          </div>
          <div class="bg-green-50 p-4 rounded-lg text-center">
            <div class="text-sm text-gray-600 mb-1">å‚ä¸èŠ‚ç‚¹</div>
            <div class="text-3xl font-bold text-green-600">{{ window.crossEcConfig.nodes?.length || 0 }}</div>
          </div>
          <div class="bg-orange-50 p-4 rounded-lg text-center">
            <div class="text-sm text-gray-600 mb-1">æ€»ç£ç›˜æ•°</div>
            <div class="text-3xl font-bold text-orange-600">{{ window.crossEcConfig.totalDisks || 0 }}</div>
          </div>
        </div>

        <!-- èŠ‚ç‚¹ç£ç›˜åˆ†å¸ƒ -->
        <div class="border-t pt-4">
          <h5 class="font-semibold mb-3">ç£ç›˜åˆ†å¸ƒ</h5>
          <div class="grid grid-cols-2 gap-4">
            <div v-for="nodeInfo in window.crossEcConfig.nodes" :key="nodeInfo.nodeId"
                 class="bg-gray-50 p-4 rounded-lg border">
              <div class="flex items-center gap-2 mb-2">
                <span class="text-xl">ğŸ–¥ï¸</span>
                <span class="font-semibold">{{ nodeInfo.nodeName }}</span>
                <span class="text-xs text-gray-500">({{ nodeInfo.ip }})</span>
              </div>
              <div class="flex flex-wrap gap-2">
                <span v-for="disk in nodeInfo.disks" :key="disk"
                      class="px-2 py-1 bg-green-100 text-green-700 rounded text-sm font-mono">
                  ğŸ’¾ {{ disk }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- åˆ›å»ºæ–°çš„è·¨èŠ‚ç‚¹ECé…ç½® -->
      <div v-else>
        <div class="bg-white rounded-lg shadow border p-6 mb-6">
          <div class="text-center mb-6">
            <div class="text-5xl mb-3">ğŸŒ</div>
            <h4 class="text-xl font-bold">åˆ›å»ºè·¨èŠ‚ç‚¹çº åˆ ç </h4>
            <p class="text-gray-600 text-sm mt-1">ä»å¤šä¸ªèŠ‚ç‚¹é€‰æ‹©ç£ç›˜ï¼Œå®ç°è·¨ç‰©ç†æœºçš„æ•°æ®ä¿æŠ¤</p>
          </div>

          <!-- Kå’ŒMå€¼è®¾ç½® -->
          <div class="grid grid-cols-2 gap-6 mb-6">
            <div>
              <label class="block text-sm font-semibold mb-2">
                æ•°æ®å—æ•°é‡ (K) <span class="text-xs text-gray-500 font-normal">åŸå§‹æ•°æ®åˆ†æˆå‡ å—</span>
              </label>
              <input v-model.number="window.crossEcForm.k" type="number" min="2" max="16"
                     class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
            </div>
            <div>
              <label class="block text-sm font-semibold mb-2">
                æ ¡éªŒå—æ•°é‡ (M) <span class="text-xs text-gray-500 font-normal">æœ€å¤šå®¹å¿å‡ ä¸ªç£ç›˜æŸå</span>
              </label>
              <input v-model.number="window.crossEcForm.m" type="number" min="1" max="8"
                     class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
            </div>
          </div>

          <div class="bg-blue-50 rounded-lg p-4 mb-6 border border-blue-200">
            <div class="flex items-center gap-2 text-blue-800">
              <span>ğŸ’¡</span>
              <span class="font-semibold">éœ€è¦è‡³å°‘ {{ window.crossEcForm.k + window.crossEcForm.m }} ä¸ªç£ç›˜</span>
              <span class="text-sm">| å·²é€‰æ‹© {{ countSelectedCrossDisks(window) }} ä¸ª</span>
              <span v-if="countSelectedCrossDisks(window) >= window.crossEcForm.k + window.crossEcForm.m" class="text-green-600 ml-auto">âœ“ æ»¡è¶³è¦æ±‚</span>
              <span v-else class="text-red-600 ml-auto">âœ— ç£ç›˜ä¸è¶³</span>
            </div>
          </div>
        </div>

        <!-- èŠ‚ç‚¹ç£ç›˜é€‰æ‹© - å·¦å³å¸ƒå±€ -->
        <div class="flex gap-6">
          <!-- å·¦ä¾§ï¼šèŠ‚ç‚¹åˆ—è¡¨ -->
          <!-- å·¦ä¾§ï¼šèŠ‚ç‚¹åˆ—è¡¨ -->
          <div class="w-72 bg-white rounded-lg shadow border p-4 flex-shrink-0 flex flex-col">
            <h4 class="font-bold text-lg mb-4">é€‰æ‹©èŠ‚ç‚¹</h4>
            <div class="space-y-2 max-h-[300px] overflow-auto flex-shrink-0">
              <div v-for="node in (window.allNodes || [])" :key="node.id"
                @click="selectNodeForCrossEc(window, node)"
                :class="window.selectedCrossEcNode?.id === node.id ? 'border-green-500 bg-green-50' : 'border-gray-200 hover:bg-gray-50'"
                class="p-3 border-2 rounded-lg cursor-pointer transition-all">
                <div class="flex items-center gap-2">
                  <span class="text-xl">ğŸ–¥ï¸</span>
                  <div class="flex-1 min-w-0">
                    <div class="font-semibold truncate">{{ node.name }}</div>
                    <div class="text-xs text-gray-500 truncate">{{ node.ip || node.address }}</div>
                  </div>
                  <span :class="node.online ? 'bg-green-500' : 'bg-gray-400'" class="w-2 h-2 rounded-full"></span>
                </div>
                <!-- æ˜¾ç¤ºè¯¥èŠ‚ç‚¹å·²é€‰ç£ç›˜æ•° -->
                <div v-if="getNodeSelectedDisks(window, node.id).length > 0"
                     class="mt-2 text-xs text-green-600 font-semibold">
                  å·²é€‰ {{ getNodeSelectedDisks(window, node.id).length }} ä¸ªç£ç›˜
                </div>
              </div>
              <div v-if="!window.allNodes || window.allNodes.length === 0" class="text-center text-gray-500 py-8">
                æš‚æ— å¯ç”¨èŠ‚ç‚¹
              </div>
            </div>

            <!-- å·²é€‰ç£ç›˜æ±‡æ€» -->
            <div v-if="Object.keys(window.crossEcForm.selectedDisks || {}).length > 0" class="mt-4 pt-4 border-t flex-1 overflow-auto">
              <h5 class="font-semibold mb-2 text-sm">å·²é€‰ç£ç›˜ ({{ countSelectedCrossDisks(window) }})</h5>
              <div class="space-y-1 text-xs">
                <template v-for="(disks, nodeId) in window.crossEcForm.selectedDisks" :key="nodeId">
                  <div v-for="disk in disks" :key="nodeId + disk"
                       class="px-2 py-1 bg-green-100 text-green-700 rounded flex items-center justify-between">
                    <span class="truncate">{{ getNodeName(window, nodeId) }} <span class="font-mono">{{ disk }}</span></span>
                    <button @click="toggleDiskForCrossEc(window, nodeId, disk)" class="ml-1 text-green-800 hover:text-red-600 flex-shrink-0">&times;</button>
                  </div>
                </template>
              </div>
            </div>
          </div>
          <!-- å³ä¾§ï¼šç£ç›˜é€‰æ‹© -->
          <div class="flex-1 min-w-0">
            <div v-if="!window.selectedCrossEcNode" class="h-full flex items-center justify-center bg-white rounded-lg shadow border min-h-[400px]">
              <div class="text-center text-gray-400">
                <div class="text-6xl mb-4">ğŸ‘ˆ</div>
                <p>è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹æŸ¥çœ‹å…¶ç£ç›˜</p>
              </div>
            </div>

            <div v-else-if="window.crossEcLoading" class="h-full flex items-center justify-center bg-white rounded-lg shadow border min-h-[400px]">
              <div class="loading"></div>
            </div>

            <div v-else class="bg-white rounded-lg shadow border flex flex-col" style="max-height: 500px;">
              <div class="flex items-center justify-between p-4 border-b flex-shrink-0">
                <h4 class="font-bold text-lg flex items-center gap-2">
                  <span class="text-2xl">ğŸ’¿</span>
                  {{ window.selectedCrossEcNode.name }} - é€‰æ‹©ç£ç›˜
                </h4>
                <button @click="toggleAllDisksForNode(window, window.selectedCrossEcNode.id)"
                        class="text-sm text-blue-600 hover:underline">
                  å…¨é€‰/å–æ¶ˆ
                </button>
              </div>

              <!-- ç£ç›˜åˆ—è¡¨ - å¯æ»šåŠ¨ -->
              <div class="flex-1 overflow-auto p-4">
                <div v-if="window.crossEcNodeDisks && window.crossEcNodeDisks.length > 0" class="space-y-3">
                  <label v-for="disk in window.crossEcNodeDisks" :key="disk.mount"
                         class="flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all hover:bg-gray-50"
                         :class="isDiskSelectedForCrossEc(window, window.selectedCrossEcNode.id, disk.mount) ? 'border-green-500 bg-green-50' : 'border-gray-200'">
                    <input type="checkbox"
                           :checked="isDiskSelectedForCrossEc(window, window.selectedCrossEcNode.id, disk.mount)"
                           @change="toggleDiskForCrossEc(window, window.selectedCrossEcNode.id, disk.mount)"
                           class="w-5 h-5 accent-green-500">
                    <div class="flex-1">
                      <div class="flex items-center gap-2">
                        <span class="text-2xl">ğŸ’¾</span>
                        <span class="font-mono font-bold text-lg">{{ disk.mount }}</span>
                        <span v-if="disk.ec_configured" class="px-2 py-0.5 bg-yellow-100 text-yellow-700 rounded text-xs">
                          å·²æœ‰EC
                        </span>
                      </div>
                      <div class="text-sm text-gray-600 mt-1">
                        æ€»å®¹é‡: {{ disk.total_gb }} GB | å¯ç”¨: <span class="text-green-600 font-semibold">{{ disk.free_gb }} GB</span> ({{ disk.usage_percent }}%)
                      </div>
                      <div class="mt-2 h-2 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-blue-500" :style="{width: disk.usage_percent + '%'}"></div>
                      </div>
                    </div>
                  </label>
                </div>

                <div v-else class="text-center text-gray-500 py-12">
                  <div class="text-5xl mb-4">ğŸ’¾</div>
                  <p>è¯¥èŠ‚ç‚¹æš‚æ— å¯ç”¨ç£ç›˜</p>
                </div>
              </div>

              <!-- åˆ›å»ºæŒ‰é’® - å›ºå®šåº•éƒ¨ -->
              <div class="p-4 border-t bg-gray-50 flex-shrink-0">
                <button @click="saveCrossEcConfig(window)"
                        :disabled="countSelectedCrossDisks(window) < window.crossEcForm.k + window.crossEcForm.m"
                        :class="countSelectedCrossDisks(window) < window.crossEcForm.k + window.crossEcForm.m ? 'bg-gray-300 cursor-not-allowed' : 'bg-green-500 hover:bg-green-600'"
                        class="w-full px-8 py-3 text-white rounded-lg font-semibold text-lg whitespace-nowrap">
                  ğŸ›¡ï¸ åˆ›å»ºè·¨èŠ‚ç‚¹EC
                </button>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- ========== å•èŠ‚ç‚¹EC ========== -->
    <div v-else-if="window.ecTab === 'single-node'" class="flex gap-6 h-full">
      <!-- å·¦ä¾§ï¼šèŠ‚ç‚¹åˆ—è¡¨ -->
      <div class="w-72 bg-white rounded-lg shadow border p-4 flex-shrink-0">
        <h4 class="font-bold text-lg mb-4">é€‰æ‹©èŠ‚ç‚¹</h4>
        <div class="space-y-2 max-h-[500px] overflow-auto">
          <div v-for="node in (window.allNodes || [])" :key="node.id"
            @click="selectNodeForSingleEc(window, node)"
            :class="window.selectedSingleEcNode?.id === node.id ? 'border-green-500 bg-green-50' : 'border-gray-200 hover:bg-gray-50'"
            class="p-3 border-2 rounded-lg cursor-pointer transition-all">
            <div class="flex items-center gap-2">
              <span class="text-xl">ğŸ–¥ï¸</span>
              <div class="flex-1 min-w-0">
                <div class="font-semibold truncate">{{ node.name }}</div>
                <div class="text-xs text-gray-500 truncate">{{ node.ip || node.address }}</div>
              </div>
              <span :class="node.online ? 'bg-green-500' : 'bg-gray-400'" class="w-2 h-2 rounded-full"></span>
            </div>
            <!-- ECçŠ¶æ€æ ‡è®° -->
            <div v-if="node.ecConfigured" class="mt-2 text-xs text-green-600 font-semibold flex items-center gap-1">
              <span>ğŸ›¡ï¸</span> ECå·²é…ç½®
            </div>
          </div>
          <div v-if="!window.allNodes || window.allNodes.length === 0" class="text-center text-gray-500 py-8">
            æš‚æ— å¯ç”¨èŠ‚ç‚¹
          </div>
        </div>
      </div>

      <!-- å³ä¾§ï¼šå•èŠ‚ç‚¹ECé…ç½® -->
      <div class="flex-1 min-w-0 overflow-auto">
        <div v-if="!window.selectedSingleEcNode" class="h-full flex items-center justify-center bg-white rounded-lg shadow border">
          <div class="text-center text-gray-400">
            <div class="text-6xl mb-4">ğŸ‘ˆ</div>
            <p>è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹é…ç½®å…¶EC</p>
          </div>
        </div>

        <div v-else-if="window.singleEcLoading" class="h-full flex items-center justify-center bg-white rounded-lg shadow border">
          <div class="loading"></div>
        </div>

        <!-- å·²æœ‰é…ç½® -->
        <div v-else-if="window.singleEcConfig" class="bg-white rounded-lg shadow border p-6">
          <div class="flex justify-between items-start mb-4">
            <div>
              <h4 class="text-xl font-bold flex items-center gap-2">
                <span class="text-green-500">âœ…</span>
                {{ window.selectedSingleEcNode.name }} - ECå·²é…ç½®
              </h4>
              <p class="text-sm text-gray-600 mt-1">èŠ‚ç‚¹å†…ç£ç›˜æ•°æ®ä¿æŠ¤</p>
            </div>
            <button @click="deleteSingleEcConfig(window)" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm">
              åˆ é™¤é…ç½®
            </button>
          </div>

          <div class="grid grid-cols-4 gap-4 mb-6">
            <div class="bg-blue-50 p-4 rounded-lg text-center">
              <div class="text-sm text-gray-600 mb-1">æ•°æ®å— (K)</div>
              <div class="text-3xl font-bold text-blue-600">{{ window.singleEcConfig.k }}</div>
            </div>
            <div class="bg-purple-50 p-4 rounded-lg text-center">
              <div class="text-sm text-gray-600 mb-1">æ ¡éªŒå— (M)</div>
              <div class="text-3xl font-bold text-purple-600">{{ window.singleEcConfig.m }}</div>
            </div>
            <div class="bg-green-50 p-4 rounded-lg text-center">
              <div class="text-sm text-gray-600 mb-1">å®¹é”™èƒ½åŠ›</div>
              <div class="text-3xl font-bold text-green-600">{{ window.singleEcConfig.m }}</div>
            </div>
            <div class="bg-orange-50 p-4 rounded-lg text-center">
              <div class="text-sm text-gray-600 mb-1">å­˜å‚¨å¼€é”€</div>
              <div class="text-3xl font-bold text-orange-600">
                {{ ((window.singleEcConfig.k + window.singleEcConfig.m) / window.singleEcConfig.k * 100 - 100).toFixed(0) }}%
              </div>
            </div>
          </div>

          <!-- ç£ç›˜åˆ—è¡¨ -->
          <div class="border-t pt-4">
            <h5 class="font-semibold mb-3">å·²é…ç½®ç£ç›˜ ({{ window.singleEcConfig.disks?.length || 0 }}ä¸ª)</h5>
            <div class="grid grid-cols-3 gap-3">
              <div v-for="disk in window.singleEcConfig.disks" :key="disk"
                   class="bg-gray-50 p-3 rounded-lg border flex items-center gap-2">
                <span class="text-2xl">ğŸ’¾</span>
                <span class="font-mono">{{ disk }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- åˆ›å»ºæ–°é…ç½® -->
        <div v-else class="bg-white rounded-lg shadow border p-6">
          <div class="text-center mb-6">
            <div class="text-5xl mb-3">ğŸ’¾</div>
            <h4 class="text-xl font-bold">{{ window.selectedSingleEcNode.name }} - é…ç½®ECä¿æŠ¤</h4>
            <p class="text-gray-600 text-sm mt-1">ä¸ºè¯¥èŠ‚ç‚¹å†…çš„å¤šä¸ªç£ç›˜é…ç½®çº åˆ ç </p>
          </div>

          <!-- Kå’ŒMå€¼ -->
          <div class="grid grid-cols-2 gap-6 mb-6">
            <div>
              <label class="block text-sm font-semibold mb-2">æ•°æ®å—æ•°é‡ (K)</label>
              <input v-model.number="window.singleEcForm.k" type="number" min="2" max="16"
                     class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
            </div>
            <div>
              <label class="block text-sm font-semibold mb-2">æ ¡éªŒå—æ•°é‡ (M)</label>
              <input v-model.number="window.singleEcForm.m" type="number" min="1" max="8"
                     class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
            </div>
          </div>

          <!-- ç£ç›˜é€‰æ‹© -->
          <div class="mb-6">
            <label class="block text-sm font-semibold mb-2">
              é€‰æ‹©ç£ç›˜ <span class="text-gray-500 font-normal">(è‡³å°‘éœ€è¦ {{ window.singleEcForm.k + window.singleEcForm.m }} ä¸ª)</span>
            </label>
            <div class="border rounded-lg p-4 max-h-64 overflow-auto space-y-2">
              <label v-for="disk in window.singleEcNodeDisks" :key="disk.mount"
                     class="flex items-center gap-3 p-3 hover:bg-gray-50 rounded cursor-pointer">
                <input type="checkbox" :value="disk.mount" v-model="window.singleEcForm.disks" class="w-4 h-4 accent-green-500">
                <span class="text-xl">ğŸ’¾</span>
                <div class="flex-1">
                  <span class="font-mono font-semibold">{{ disk.mount }}</span>
                  <span class="text-sm text-gray-600 ml-2">
                    (å¯ç”¨: {{ disk.free_gb }} GB)
                  </span>
                </div>
              </label>
              <div v-if="!window.singleEcNodeDisks || window.singleEcNodeDisks.length === 0" class="text-center text-gray-500 py-4">
                æš‚æ— å¯ç”¨ç£ç›˜
              </div>
            </div>
            <div class="text-xs text-gray-600 mt-2">å·²é€‰æ‹© {{ window.singleEcForm.disks?.length || 0 }} ä¸ªç£ç›˜</div>
          </div>

          <!-- æ•ˆæœé¢„è§ˆ -->
          <div class="bg-green-50 rounded-lg p-4 mb-6 border border-green-200">
            <div class="font-semibold text-green-900 mb-2">ğŸ’¡ é…ç½®æ•ˆæœ</div>
            <div class="grid grid-cols-2 gap-4 text-sm text-green-800">
              <div>å®¹é”™èƒ½åŠ›: <strong>æœ€å¤š {{ window.singleEcForm.m }} ä¸ªç£ç›˜æŸå</strong></div>
              <div>å­˜å‚¨å¼€é”€: <strong>{{ ((window.singleEcForm.k + window.singleEcForm.m) / window.singleEcForm.k * 100 - 100).toFixed(1) }}%</strong></div>
            </div>
          </div>

          <button @click="saveSingleEcConfig(window)"
                  :disabled="(window.singleEcForm.disks?.length || 0) < window.singleEcForm.k + window.singleEcForm.m"
                  :class="(window.singleEcForm.disks?.length || 0) < window.singleEcForm.k + window.singleEcForm.m ? 'bg-gray-300 cursor-not-allowed' : 'bg-green-500 hover:bg-green-600'"
                  class="w-full py-3 text-white rounded-lg font-semibold">
            ä¿å­˜é…ç½®
          </button>
        </div>
      </div>
    </div>


    <!-- ========== çŠ¶æ€ç›‘æ§ ========== -->
<div v-else-if="window.ecTab === 'status'">
  <div class="flex justify-between items-center mb-4">
    <h4 class="font-bold text-lg">ECçŠ¶æ€æ€»è§ˆ</h4>
    <button @click="loadEcStatus(window)" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 text-sm">
      ğŸ”„ åˆ·æ–°çŠ¶æ€
    </button>
  </div>

  <div v-if="window.ecStatusLoading" class="text-center py-12">
    <div class="loading"></div>
    <p class="text-gray-500 mt-2">åŠ è½½ä¸­...</p>
  </div>

  <div v-else>
    <!-- è·¨èŠ‚ç‚¹ECçŠ¶æ€ -->
    <div class="bg-white rounded-lg shadow border p-6 mb-6">
      <h5 class="font-semibold text-lg mb-4 flex items-center gap-2">
        <span class="text-2xl">ğŸŒ</span> è·¨èŠ‚ç‚¹ECçŠ¶æ€
      </h5>

      <div v-if="window.ecStatus?.cross_ec" class="space-y-4">
        <div class="grid grid-cols-5 gap-4">
          <div class="bg-green-50 p-4 rounded-lg text-center">
            <div class="text-sm text-gray-600 mb-1">çŠ¶æ€</div>
            <div class="text-xl font-bold text-green-600 flex items-center justify-center gap-1">
              <span class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></span>
              è¿è¡Œä¸­
            </div>
          </div>
          <div class="bg-blue-50 p-4 rounded-lg text-center">
            <div class="text-sm text-gray-600 mb-1">æ•°æ®å— (K)</div>
            <div class="text-2xl font-bold text-blue-600">{{ window.ecStatus.cross_ec.k }}</div>
          </div>
          <div class="bg-purple-50 p-4 rounded-lg text-center">
            <div class="text-sm text-gray-600 mb-1">æ ¡éªŒå— (M)</div>
            <div class="text-2xl font-bold text-purple-600">{{ window.ecStatus.cross_ec.m }}</div>
          </div>
          <div class="bg-orange-50 p-4 rounded-lg text-center">
            <div class="text-sm text-gray-600 mb-1">å‚ä¸èŠ‚ç‚¹</div>
            <div class="text-2xl font-bold text-orange-600">{{ window.ecStatus.cross_ec.nodes?.length || 0 }}</div>
          </div>
          <div class="bg-teal-50 p-4 rounded-lg text-center">
            <div class="text-sm text-gray-600 mb-1">æ€»ç£ç›˜æ•°</div>
            <div class="text-2xl font-bold text-teal-600">{{ window.ecStatus.cross_ec.total_disks }}</div>
          </div>
        </div>

        <!-- èŠ‚ç‚¹å¥åº·çŠ¶æ€ -->
        <div class="border-t pt-4">
          <h6 class="font-semibold mb-3">èŠ‚ç‚¹å¥åº·çŠ¶æ€</h6>
          <div class="grid grid-cols-2 gap-3">
            <div v-for="nodeInfo in window.ecStatus.cross_ec.nodes" :key="nodeInfo.nodeId"
                 class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border">
              <span class="w-3 h-3 rounded-full" :class="nodeInfo.online !== false ? 'bg-green-500' : 'bg-red-500'"></span>
              <div class="flex-1">
                <div class="font-semibold">{{ nodeInfo.nodeName || nodeInfo.nodeId }}</div>
                <div class="text-xs text-gray-500">{{ nodeInfo.disks?.length || 0 }} ä¸ªç£ç›˜</div>
              </div>
              <span class="text-xs px-2 py-1 rounded" :class="nodeInfo.online !== false ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'">
                {{ nodeInfo.online !== false ? 'åœ¨çº¿' : 'ç¦»çº¿' }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <div v-else class="text-center py-8 text-gray-500">
        <div class="text-4xl mb-2">ğŸ“­</div>
        <p>æœªé…ç½®è·¨èŠ‚ç‚¹EC</p>
        <button @click="window.ecTab = 'cross-node'" class="mt-2 text-green-600 hover:underline text-sm">
          å»é…ç½® â†’
        </button>
      </div>
    </div>

    <!-- å•èŠ‚ç‚¹ECçŠ¶æ€ -->
    <div class="bg-white rounded-lg shadow border p-6">
      <h5 class="font-semibold text-lg mb-4 flex items-center gap-2">
        <span class="text-2xl">ğŸ’¾</span> å•èŠ‚ç‚¹ECçŠ¶æ€
      </h5>

      <div v-if="window.ecStatus?.single_ec_nodes?.length > 0" class="space-y-3">
        <div v-for="node in window.ecStatus.single_ec_nodes" :key="node.node_id"
             class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg border hover:bg-gray-100">
          <div class="w-12 h-12 bg-white rounded-lg shadow flex items-center justify-center text-2xl">ğŸ–¥ï¸</div>
          <div class="flex-1">
            <div class="font-semibold">{{ node.node_name }}</div>
            <div class="text-xs text-gray-500">{{ node.ip }}</div>
          </div>
          <div class="text-center px-4">
            <div class="text-xs text-gray-500">K / M</div>
            <div class="font-bold text-blue-600">{{ node.config.k }} / {{ node.config.m }}</div>
          </div>
          <div class="text-center px-4">
            <div class="text-xs text-gray-500">ç£ç›˜æ•°</div>
            <div class="font-bold text-purple-600">{{ node.config.disks?.length || 0 }}</div>
          </div>
          <div class="flex items-center gap-2">
            <span class="w-3 h-3 rounded-full" :class="node.online ? 'bg-green-500 animate-pulse' : 'bg-red-500'"></span>
            <span class="text-sm" :class="node.online ? 'text-green-600' : 'text-red-600'">
              {{ node.online ? 'å¥åº·' : 'å¼‚å¸¸' }}
            </span>
          </div>
        </div>
      </div>

      <div v-else class="text-center py-8 text-gray-500">
        <div class="text-4xl mb-2">ğŸ“­</div>
        <p>æš‚æ— å•èŠ‚ç‚¹ECé…ç½®</p>
        <button @click="window.ecTab = 'single-node'" class="mt-2 text-green-600 hover:underline text-sm">
          å»é…ç½® â†’
        </button>
      </div>
    </div>
  </div>
</div>
    <!-- ========== ä¸Šä¼ æ–‡ä»¶ ========== -->
<div v-else-if="window.ecTab === 'upload'">
  <div class="bg-white rounded-lg shadow border p-6 mb-6">
    <h4 class="font-bold text-lg mb-4">ğŸ“¤ ä¸Šä¼ æ–‡ä»¶åˆ°ECæ± </h4>

    <!-- é€‰æ‹©ç›®æ ‡EC -->
    <div class="mb-6">
      <label class="block text-sm font-semibold mb-2">é€‰æ‹©ç›®æ ‡ECæ± </label>
      <select v-model="window.uploadTargetEc" @change="loadEcFiles(window)" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">
        <option value="">-- è¯·é€‰æ‹© --</option>
        <option value="cross" v-if="window.crossEcConfig">ğŸŒ è·¨èŠ‚ç‚¹ECæ±  (K={{ window.crossEcConfig.k }}, M={{ window.crossEcConfig.m }})</option>
        <option v-for="node in (window.allNodes || []).filter(n => n.ecConfigured)" :key="node.id" :value="node.id">
          ğŸ’¾ {{ node.name }} (å•èŠ‚ç‚¹EC)
        </option>
      </select>
      <p v-if="!window.crossEcConfig && !(window.allNodes || []).some(n => n.ecConfigured)"
         class="text-sm text-red-500 mt-2">
        âš ï¸ æš‚æ— å¯ç”¨çš„ECæ± ï¼Œè¯·å…ˆé…ç½®EC
      </p>
    </div>

    <!-- æ‹–æ‹½ä¸Šä¼ åŒºåŸŸ -->
    <div class="border-2 border-dashed rounded-lg p-12 text-center transition-all"
         :class="window.dragOver ? 'border-green-500 bg-green-50' : 'border-gray-300 hover:border-green-400'"
         @dragover.prevent="window.dragOver = true"
         @dragleave.prevent="window.dragOver = false"
         @drop.prevent="handleEcFileDrop($event, window); window.dragOver = false">
      <div class="text-6xl mb-4">{{ window.dragOver ? 'ğŸ“¥' : 'ğŸ“¤' }}</div>
      <p class="text-gray-600 mb-4">æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
      <input type="file" :id="'ecFileInput' + window.id" multiple class="hidden" @change="handleEcFileSelect($event, window)">
<button @click="triggerEcFileInput(window)"
              class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
        é€‰æ‹©æ–‡ä»¶
      </button>
    </div>

    <!-- å¾…ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ -->
    <div v-if="window.ecUploadFiles && window.ecUploadFiles.length > 0" class="mt-6">
      <div class="flex justify-between items-center mb-3">
        <h5 class="font-semibold">å¾…ä¸Šä¼ æ–‡ä»¶ ({{ window.ecUploadFiles.length }})</h5>
        <button @click="window.ecUploadFiles = []" class="text-sm text-red-500 hover:text-red-700">
          æ¸…ç©ºåˆ—è¡¨
        </button>
      </div>
      <div class="max-h-60 overflow-auto border rounded-lg">
        <div v-for="(file, index) in window.ecUploadFiles" :key="index"
             class="flex items-center gap-3 p-3 border-b last:border-b-0 hover:bg-gray-50">
          <span class="text-2xl">{{ getFileIcon(file.name) }}</span>
          <div class="flex-1 min-w-0">
            <div class="font-medium truncate">{{ file.name }}</div>
            <div class="text-xs text-gray-500">{{ formatFileSize(file.size) }}</div>
          </div>
          <div v-if="file.progress !== undefined" class="w-24">
            <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
              <div class="h-full bg-green-500 transition-all" :style="{width: file.progress + '%'}"></div>
            </div>
            <div class="text-xs text-center text-gray-500 mt-1">{{ file.progress }}%</div>
          </div>
          <span v-if="file.status === 'success'" class="text-green-500">âœ“</span>
          <span v-else-if="file.status === 'error'" class="text-red-500">âœ—</span>
          <button v-else @click="window.ecUploadFiles.splice(index, 1)"
                  class="text-gray-400 hover:text-red-500 text-xl">&times;</button>
        </div>
      </div>

      <!-- ä¸Šä¼ è¿›åº¦ç»Ÿè®¡ -->
      <div v-if="window.uploadingEc" class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
        <div class="flex items-center gap-3">
          <div class="loading"></div>
          <div>
            <div class="font-semibold text-blue-800">æ­£åœ¨ä¸Šä¼ ...</div>
            <div class="text-sm text-blue-600">
              å·²å®Œæˆ {{ window.uploadedCount || 0 }} / {{ window.ecUploadFiles.length }}
            </div>
          </div>
        </div>
      </div>

      <div class="mt-4 flex justify-end gap-3">
        <button @click="window.ecUploadFiles = []"
                :disabled="window.uploadingEc"
                class="px-4 py-2 border rounded-lg hover:bg-gray-100 disabled:opacity-50">
          å–æ¶ˆ
        </button>
        <button @click="startEcUpload(window)"
                :disabled="!window.uploadTargetEc || window.uploadingEc"
                :class="!window.uploadTargetEc || window.uploadingEc ? 'bg-gray-300 cursor-not-allowed' : 'bg-green-500 hover:bg-green-600'"
                class="px-8 py-2 text-white rounded-lg font-semibold">
          {{ window.uploadingEc ? 'ä¸Šä¼ ä¸­...' : 'ğŸš€ å¼€å§‹ä¸Šä¼ ' }}
        </button>
      </div>
    </div>
  </div>

  <!-- å·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ -->
  <div class="bg-white rounded-lg shadow border p-6">
    <div class="flex justify-between items-center mb-4">
      <h4 class="font-bold text-lg">ğŸ“ ECæ± æ–‡ä»¶åˆ—è¡¨</h4>
      <button @click="loadEcFiles(window)" class="px-3 py-1 text-sm bg-gray-100 rounded hover:bg-gray-200">
        ğŸ”„ åˆ·æ–°
      </button>
    </div>

    <div v-if="window.ecFilesLoading" class="text-center py-8">
      <div class="loading"></div>
    </div>

    <div v-else-if="window.ecFiles && window.ecFiles.length > 0" class="space-y-2">
      <div v-for="file in window.ecFiles" :key="file.id"
           class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100">
        <span class="text-2xl">{{ getFileIcon(file.name) }}</span>
        <div class="flex-1 min-w-0">
          <div class="font-medium truncate">{{ file.name }}</div>
          <div class="text-xs text-gray-500">
            {{ formatFileSize(file.size) }} Â· {{ file.created_at }}
          </div>
        </div>
        <span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded">
          {{ file.ec_type === 'cross' ? 'è·¨èŠ‚ç‚¹' : 'å•èŠ‚ç‚¹' }}
        </span>
      </div>
    </div>

    <div v-else class="text-center py-8 text-gray-500">
      <div class="text-4xl mb-2">ğŸ“­</div>
      <p>æš‚æ— æ–‡ä»¶</p>
    </div>
  </div>
</div>

  </div>
</div>

          <!-- ç³»ç»Ÿç›‘æ§çª—å£ -->
<div v-if="window.type === 'system-monitor'" class="h-full flex flex-col">
  <div v-if="window.monitorView === 'overview'" class="h-full flex flex-col">
  <div class="px-6 py-5 border-b bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900">
    <h3 class="text-2xl font-bold flex items-center gap-3 text-white">
      <span class="w-10 h-10 bg-gradient-to-br from-emerald-400 to-cyan-500 rounded-xl flex items-center justify-center shadow-lg">ğŸ“Š</span>
      ç³»ç»Ÿç›‘æ§æ€»è§ˆ
    </h3>
    <p class="text-sm text-slate-400 mt-2 ml-13">é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹æŸ¥çœ‹è¯¦ç»†ç¡¬ä»¶ä¿¡æ¯</p>
  </div>
  <div class="flex-1 overflow-auto p-6 bg-gradient-to-br from-slate-100 to-slate-200">
    <div v-if="window.loading" class="flex justify-center items-center h-full">
      <div class="loading"></div> <span class="ml-2 text-gray-600">æ­£åœ¨åŠ è½½èŠ‚ç‚¹...</span>
    </div>
    <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div v-for="node in window.nodes" :key="node.id"
           @click="selectNodeForMonitor(window, node)"
           class="group relative bg-white rounded-2xl shadow-md border border-slate-200 overflow-hidden cursor-pointer hover:shadow-2xl hover:border-emerald-400 hover:-translate-y-1 transition-all duration-300">
        <div class="h-1.5 w-full bg-gradient-to-r from-emerald-400 via-cyan-500 to-blue-500"></div>
        <div class="p-6">
          <div class="flex justify-between items-center mb-5">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-slate-700 to-slate-900 flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300">
                <span class="text-2xl">ğŸ–¥ï¸</span>
              </div>
              <div>
                <h4 class="font-bold text-lg text-slate-800">{{ node.name }}</h4>
                <span class="inline-flex items-center gap-1 text-xs text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-full">
                  <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse"></span>
                  åœ¨çº¿
                </span>
              </div>
            </div>
            <div class="text-slate-400 group-hover:text-emerald-500 transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </div>
          </div>
          <div class="mb-5">
            <div class="flex justify-between items-center mb-2">
              <span class="text-xs font-medium text-slate-500 flex items-center gap-1">
                <span>ğŸ’¾</span> ç£ç›˜å®¹é‡
              </span>
              <span class="text-xs font-bold" :class="node.disk_usage > 80 ? 'text-red-500' : 'text-slate-700'">
                {{ node.disk_usage.toFixed(1) }}%
              </span>
            </div>
            <div class="w-full bg-slate-100 rounded-full h-2.5 overflow-hidden">
              <div class="h-2.5 rounded-full transition-all duration-500"
                   :class="node.disk_usage > 80 ? 'bg-gradient-to-r from-red-400 to-red-500' : 'bg-gradient-to-r from-emerald-400 to-cyan-500'"
                   :style="{ width: node.disk_usage + '%' }">
              </div>
            </div>
            <div class="text-xs text-slate-400 mt-1.5 text-right">
              {{ node.used_storage.toFixed(1) }} / {{ node.total_storage.toFixed(1) }} GB
            </div>
          </div>
          <div class="flex items-center justify-between p-3 bg-gradient-to-r from-slate-50 to-slate-100 rounded-xl">
            <span class="text-xs font-medium text-slate-500 flex items-center gap-1">
              <span>ğŸŒ¡ï¸</span> CPU æ¸©åº¦
            </span>
            <div class="flex items-center gap-1">
              <span class="text-2xl font-bold"
                    :class="node.cpu_temp > 75 ? 'text-red-500' : node.cpu_temp > 60 ? 'text-orange-500' : 'text-emerald-500'">
                {{ node.cpu_temp.toFixed(1) }}
              </span>
              <span class="text-sm text-slate-400">Â°C</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <div v-else-if="window.monitorView === 'detail'" class="h-full flex flex-col">
  <div class="px-6 py-4 border-b bg-gradient-to-r from-green-50 to-teal-50 flex justify-between items-center">
    <div>
      <h3 class="text-xl font-bold flex items-center gap-2">
        <span class="text-3xl">ğŸ–¥ï¸</span>
        {{ window.title }}
      </h3>
      <p class="text-sm text-gray-600 mt-1">å®æ—¶ç›‘æ§ç³»ç»Ÿç¡¬ä»¶çŠ¶æ€</p>
    </div>
    <button @click="returnToMonitorOverview(window)" class="px-4 py-2 bg-white border rounded-lg hover:bg-gray-50 transition">
      &lt; è¿”å›æ€»è§ˆ
    </button>
  </div>
  <div v-if="window.loading" class="flex-1 flex justify-center items-center">
      <div class="loading"></div> <span class="ml-2 text-gray-600">æ­£åœ¨åŠ è½½è¯¦ç»†æ•°æ®...</span>
  </div>
  <div v-else-if="window.selectedNodeStats" class="flex-1 overflow-auto p-6 bg-gray-50">
   <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
  <!-- CPUä¿¡æ¯ -->
  <div class="bg-white rounded-lg shadow border p-4">
    <h4 class="font-semibold mb-4 text-lg flex items-center gap-2">
      <span class="text-2xl">ğŸ’»</span> CPU
    </h4>
    <div class="space-y-2 text-sm">
      <div class="flex justify-between">
        <span class="text-gray-700">æ¸©åº¦</span>
        <span class="font-bold">{{ window.selectedNodeStats.cpu_temp_celsius || '--' }}Â°C</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-700">é¢‘ç‡</span>
        <span class="font-bold">{{ window.selectedNodeStats.cpu_freq || '--' }} GHz</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-700">åŠŸè€—</span>
        <span class="font-bold">{{ window.selectedNodeStats.cpu_power || '--' }} W</span>
      </div>
    </div>
  </div>

  <!-- é£æ‰‡è½¬é€Ÿ -->
  <div class="bg-white rounded-lg shadow border p-4">
    <h4 class="font-semibold mb-4 text-lg flex items-center gap-2">
      <span class="text-2xl">ğŸ’¨</span> é£æ‰‡è½¬é€Ÿ
    </h4>
    <div class="space-y-2 text-sm">
  <div class="flex justify-between">
    <span class="text-gray-700">è½¬é€Ÿ</span>
    <span class="font-bold text-blue-600">{{ (window.selectedNodeStats.fans && window.selectedNodeStats.fans[0]) ? window.selectedNodeStats.fans[0].value : '--' }} RPM</span>
  </div>
</div>
  </div>

  <!-- å†…å­˜å’Œç½‘ç»œå¸¦å®½ - åˆå¹¶ä¸ºä¸€ä¸ªå¡ç‰‡ -->
<div class="bg-white rounded-lg shadow border p-4">
  <div class="space-y-3">
    <!-- å†…å­˜ - ç¬¬ä¸€è¡Œ -->
    <div class="flex items-center justify-between">
      <h4 class="font-semibold text-sm flex items-center gap-2">
        <span class="text-xl">ğŸ§ </span> å†…å­˜
      </h4>
      <span class="font-bold text-sm">{{ window.selectedNodeStats.memory_percent ?? '--' }}%</span>
    </div>

    <!-- åˆ†å‰²çº¿ -->
    <div class="border-t"></div>

    <!-- ç½‘ç»œå¸¦å®½ - ç¬¬äºŒè¡Œ -->
    <div>
      <h4 class="font-semibold text-sm flex items-center gap-2 mb-2">
        <span class="text-xl">ğŸŒ</span> ç½‘ç»œå¸¦å®½
      </h4>
      <div class="grid grid-cols-2 gap-4 text-sm">
        <div class="flex justify-between">
          <span class="text-gray-700">ä¸‹è½½</span>
          <span class="font-bold text-green-600">{{ window.selectedNodeStats.network_download !== undefined && window.selectedNodeStats.network_download !== null ? window.selectedNodeStats.network_download : '--' }} MB/s</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-700">ä¸Šä¼ </span>
          <span class="font-bold text-blue-600">{{ window.selectedNodeStats.network_upload !== undefined && window.selectedNodeStats.network_upload !== null ? window.selectedNodeStats.network_upload : '--' }} MB/s</span>
        </div>
      </div>
    </div>
  </div>
</div>

 <!-- ç¡¬ç›˜ -->
<div class="bg-white rounded-lg shadow border p-4">
  <h4 class="font-semibold mb-4 text-lg flex items-center gap-2">
    <span class="text-2xl">ğŸ’¾</span> ç¡¬ç›˜
  </h4>
  <div class="space-y-2 text-sm">
    <!-- æ¸©åº¦ä¿¡æ¯ - ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ -->
    <div class="flex justify-between">
      <span class="text-gray-700">æ¸©åº¦</span>
      <span class="font-bold">
        {{ (window.selectedNodeStats.disks_temp?.[0]?.value || window.selectedNodeStats.temperatures?.find(t => t.name === 'Temperature')?.value || '--') }}Â°C
      </span>
    </div>

    <!-- ç¡¬ç›˜åˆ—è¡¨ -->
    <div v-if="window.selectedNodeDisks && window.selectedNodeDisks.length > 0" class="border-t pt-2 space-y-2">
      <div v-for="disk in window.selectedNodeDisks" :key="disk.mount" class="text-xs">
        <div class="flex justify-between text-gray-600">
          <span>{{ disk.mount }}</span>
          <span>{{ disk.total_gb ? ((disk.used_gb / disk.total_gb) * 100).toFixed(1) : 0 }}%</span>
        </div>
        <div class="flex justify-between text-gray-500">
          <span>{{ disk.used_gb }} GB / {{ disk.total_gb }} GB</span>
        </div>
      </div>
    </div>
  </div>
</div>

</div>
  </div>
</div>
</div>

        </div>
      </div>

     <div class="taskbar">
  <div class="taskbar-item" @click.stop="toggleStartMenu">
    <span class="text-xl">ğŸš€</span>
    <span class="ml-2 font-semibold">NAS Center</span>
  </div>

  <div v-for="window in windows.filter(w => !w.minimized)"
        :key="window.id"
        @click="focusWindow(window.id)"
        :class="['taskbar-item', { active: window.zIndex === maxZIndex }]">
    <span>{{ window.icon }}</span>
    <span class="ml-2">{{ window.title }}</span>
  </div>

  <div class="ml-auto flex items-center gap-4 text-white text-sm">

    <span>â° {{ currentTime }}</span>

    <div v-if="showStartMenu" class="start-menu">
      <div class="start-menu-header">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-xl font-bold">NAS Center</div>
            <div class="text-sm opacity-90 mt-1">ä¸»æ§ç®¡ç†ä¸­å¿ƒ</div>
          </div>
          <div class="text-3xl">ğŸš€</div>
        </div>
      </div>



      <div class="h-px bg-white/10 my-2"></div>
      <div class="start-menu-section">
        <div class="start-menu-section-title">
          {{ currentUser?.username || 'ç”¨æˆ·' }} {{ currentUser?.role === 'admin' ? '(ç®¡ç†å‘˜)' : '' }}
        </div>

        <div class="start-menu-item" @click="openUserProfile(); showStartMenu = false">
          <span class="text-xl">ğŸ‘¤</span>
          <div class="flex-1">
            <div class="font-semibold">ä¸ªäººä¿¡æ¯</div>
            <div class="text-xs opacity-70">{{ currentUser?.email || 'æ— é‚®ç®±' }}</div>
          </div>
        </div>

        <div class="start-menu-item" @click="openChangePassword(); showStartMenu = false">
          <span class="text-xl">ğŸ”‘</span>
          <div class="flex-1">
            <div class="font-semibold">ä¿®æ”¹å¯†ç </div>
          </div>
        </div>

        <div v-if="currentUser?.role === 'admin'" class="start-menu-item" @click="openUserManagement(); showStartMenu = false">
          <span class="text-xl">ğŸ‘¥</span>
          <div class="flex-1">
            <div class="font-semibold">ç”¨æˆ·ç®¡ç†</div>
          </div>
        </div>

        <div v-if="currentUser?.role === 'admin'" class="start-menu-item" @click="openSecretDialog(); showStartMenu = false">
          <span class="text-xl">ğŸ›¡ï¸</span>
          <div class="flex-1">
            <div class="font-semibold">é€šä¿¡å¯†é’¥è®¾ç½®</div>
            <div class="text-xs opacity-70">NAS_SHARED_SECRET</div>
          </div>
        </div>

        <div class="start-menu-item" @click="logout(); showStartMenu = false">
          <span class="text-xl">ğŸšª</span>
          <div class="flex-1">
            <div class="font-semibold" style="color: #f87171;">é€€å‡ºç™»å½•</div>
          </div>
        </div>
      </div>
      <div class="h-px bg-white/10 my-2"></div>

      <div class="start-menu-section">
        <div class="start-menu-item" @click="openBackgroundDialog()">
          <span class="text-xl">ğŸ–¼ï¸</span>
          <span>æ›´æ¢å£çº¸</span>
        </div>
        <div class="start-menu-item" @click="openAboutDialog()">
          <span class="text-xl">â„¹ï¸</span>
          <span>å…³äºç³»ç»Ÿ</span>
        </div>
        <div class="start-menu-item" @click="openHelpDialog()">
          <span class="text-xl">â“</span>
          <span>å¸®åŠ©æ–‡æ¡£</span>
        </div>
      </div>
    </div>
     </div>

  </div>

   <!-- èŠ‚ç‚¹åˆ†ç»„å¯¹è¯æ¡† -->
   <div v-if="showGroupDialog"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[2000]"
        @click.self="closeGroupDialog()">
     <div class="bg-white rounded-lg shadow-xl w-[600px] max-h-[80vh] flex flex-col">
       <!-- å¯¹è¯æ¡†æ ‡é¢˜ -->
       <div class="flex justify-between items-center p-6 border-b">
         <h3 class="text-xl font-bold">
           {{ groupDialogMode === 'create' ? 'åˆ›å»ºèŠ‚ç‚¹åˆ†ç»„' : 'ç¼–è¾‘èŠ‚ç‚¹åˆ†ç»„' }}
         </h3>
         <button @click="closeGroupDialog()" class="text-gray-500 hover:text-gray-700 text-2xl">
           Ã—
         </button>
       </div>

       <!-- å¯¹è¯æ¡†å†…å®¹ -->
       <div class="flex-1 overflow-auto p-6">
         <!-- åˆ†ç»„å›¾æ ‡ -->
         <div class="mb-4">
           <label class="block text-sm font-semibold mb-2">å›¾æ ‡</label>
           <div class="flex gap-2">
             <button v-for="icon in ['ğŸ“', 'ğŸ“‚', 'ğŸ—‚ï¸', 'ğŸ“¦', 'ğŸ¢', 'ğŸ ', 'ğŸŒ', 'â˜ï¸', 'ğŸ’¾', 'ğŸ–¥ï¸']"
                     :key="icon"
                     @click="groupForm.icon = icon"
                     :class="groupForm.icon === icon ? 'bg-blue-500 text-white' : 'bg-gray-100 hover:bg-gray-200'"
                     class="w-12 h-12 rounded-lg text-2xl flex items-center justify-center transition">
               {{ icon }}
             </button>
           </div>
         </div>

         <!-- åˆ†ç»„åç§° -->
         <div class="mb-4">
           <label class="block text-sm font-semibold mb-2">åˆ†ç»„åç§° *</label>
           <input v-model="groupForm.name"
                  type="text"
                  placeholder="ä¾‹å¦‚: ç”Ÿäº§ç¯å¢ƒèŠ‚ç‚¹"
                  class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
         </div>

         <!-- åˆ†ç»„æè¿° -->
         <div class="mb-4">
           <label class="block text-sm font-semibold mb-2">æè¿° (å¯é€‰)</label>
           <textarea v-model="groupForm.description"
                     placeholder="ç®€è¦æè¿°è¿™ä¸ªåˆ†ç»„çš„ç”¨é€”..."
                     rows="3"
                     class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
         </div>

         <!-- é€‰æ‹©èŠ‚ç‚¹ -->
         <div class="mb-4">
           <label class="block text-sm font-semibold mb-2">åŒ…å«çš„èŠ‚ç‚¹</label>
           <div class="space-y-2 max-h-60 overflow-auto border rounded-lg p-3">
  <label v-for="node in (availableNodes || []).filter(n => n && n.id)" :key="node.id"
         class="flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer">
               <input type="checkbox"
                      :value="node.id"
                      v-model="groupForm.nodes"
                      class="w-4 h-4">
               <span class="text-2xl">ğŸ–¥ï¸</span>
               <div class="flex-1">
                 <div class="font-semibold text-sm">{{ node.name }}</div>
                 <div class="text-xs text-gray-600">{{ node.ip }}:{{ node.port }}</div>
               </div>
             </label>
           </div>
           <div class="text-xs text-gray-600 mt-2">
             å·²é€‰æ‹© {{ groupForm.nodes.length }} ä¸ªèŠ‚ç‚¹
           </div>
         </div>
       </div>

       <!-- å¯¹è¯æ¡†æŒ‰é’® -->
       <div class="flex justify-end gap-3 p-6 border-t">
         <button @click="closeGroupDialog()"
                 class="px-4 py-2 border rounded-lg hover:bg-gray-100">
           å–æ¶ˆ
         </button>
         <button @click="saveNodeGroup()"
                 class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
           {{ groupDialogMode === 'create' ? 'åˆ›å»º' : 'ä¿å­˜' }}
         </button>
       </div>
     </div>
   </div>

   <!-- ç”¨æˆ·èŠ‚ç‚¹è®¿é—®æƒé™è¯¦ç»†ç¼–è¾‘å¯¹è¯æ¡† -->
<div v-if="showUserAccessDialog"
     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[2000]"
     @click.self="closeUserAccessDialog()">
  <div class="bg-white rounded-lg shadow-xl w-[700px] max-h-[80vh] flex flex-col">
    <!-- å¯¹è¯æ¡†æ ‡é¢˜ -->
    <div class="flex justify-between items-center p-6 border-b">
      <h3 class="text-xl font-bold">
        ç¼–è¾‘èŠ‚ç‚¹è®¿é—®æƒé™ - {{ currentEditUser?.username }}
      </h3>
      <button @click="closeUserAccessDialog()" class="text-gray-500 hover:text-gray-700 text-2xl">
        Ã—
      </button>
    </div>

    <!-- å¯¹è¯æ¡†å†…å®¹ -->
    <div class="flex-1 overflow-auto p-6">
      <!-- è®¿é—®ç±»å‹é€‰æ‹© -->
      <div class="mb-6">
        <label class="block text-sm font-semibold mb-3">è®¿é—®ç±»å‹</label>
        <div class="space-y-2">
          <label class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50"
                 :class="userAccessForm.type === 'all' ? 'border-blue-500 bg-blue-50' : ''">
            <input type="radio"
                   v-model="userAccessForm.type"
                   value="all"
                   class="w-4 h-4">
            <div class="flex-1">
              <div class="font-semibold">âœ“ æ‰€æœ‰èŠ‚ç‚¹</div>
              <div class="text-xs text-gray-600">ç”¨æˆ·å¯ä»¥è®¿é—®æ‰€æœ‰èŠ‚ç‚¹</div>
            </div>
          </label>

          <label class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50"
                 :class="userAccessForm.type === 'groups' ? 'border-blue-500 bg-blue-50' : ''">
            <input type="radio"
                   v-model="userAccessForm.type"
                   value="groups"
                   class="w-4 h-4">
            <div class="flex-1">
              <div class="font-semibold">ğŸ“ æŒ‰åˆ†ç»„è®¿é—®</div>
              <div class="text-xs text-gray-600">ç”¨æˆ·åªèƒ½è®¿é—®æŒ‡å®šåˆ†ç»„ä¸­çš„èŠ‚ç‚¹</div>
            </div>
          </label>

          <label class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50"
                 :class="userAccessForm.type === 'custom' ? 'border-blue-500 bg-blue-50' : ''">
            <input type="radio"
                   v-model="userAccessForm.type"
                   value="custom"
                   class="w-4 h-4">
            <div class="flex-1">
              <div class="font-semibold">ğŸ¯ è‡ªå®šä¹‰èŠ‚ç‚¹</div>
              <div class="text-xs text-gray-600">æ‰‹åŠ¨é€‰æ‹©ç”¨æˆ·å¯ä»¥è®¿é—®çš„èŠ‚ç‚¹</div>
            </div>
          </label>
        </div>
      </div>

      <!-- æŒ‰åˆ†ç»„è®¿é—® - é€‰æ‹©åˆ†ç»„ -->
      <div v-if="userAccessForm.type === 'groups'" class="mb-6">
        <label class="block text-sm font-semibold mb-3">å…è®¸è®¿é—®çš„åˆ†ç»„</label>
        <div v-if="(windows.find(w => w.type === 'permissions')?.groups || []).length > 0" class="space-y-2 max-h-60 overflow-auto border rounded-lg p-3">
          <label v-for="group in windows.find(w => w.type === 'permissions')?.groups || []"
                 :key="group.id"
                 class="flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer">
            <input type="checkbox"
                   :value="group.id"
                   v-model="userAccessForm.allowed_groups"
                   class="w-4 h-4">
            <span class="text-2xl">{{ group.icon }}</span>
            <div class="flex-1">
              <div class="font-semibold text-sm">{{ group.name }}</div>
              <div class="text-xs text-gray-600">
                åŒ…å« {{ group.nodes.length }} ä¸ªèŠ‚ç‚¹
              </div>
            </div>
          </label>
        </div>
        <div v-else class="text-sm text-gray-500 text-center py-4 border rounded-lg">
          è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•åˆ†ç»„,è¯·å…ˆåœ¨"èŠ‚ç‚¹åˆ†ç»„"æ ‡ç­¾é¡µåˆ›å»ºåˆ†ç»„
        </div>
        <div class="text-xs text-gray-600 mt-2">
         å·²é€‰æ‹© {{ (userAccessForm.allowed_groups || []).length }} ä¸ªåˆ†ç»„
        </div>
      </div>

      <!-- è‡ªå®šä¹‰èŠ‚ç‚¹ - é€‰æ‹©èŠ‚ç‚¹ -->
      <div v-if="userAccessForm.type === 'custom'" class="mb-6">
        <label class="block text-sm font-semibold mb-3">å…è®¸è®¿é—®çš„èŠ‚ç‚¹</label>
        <div class="space-y-2 max-h-60 overflow-auto border rounded-lg p-3">
         <label v-for="node in (availableNodes || []).filter(n => n && n.id)" :key="node.id"
         class="flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer">
            <input type="checkbox"
                   :value="node.id"
                   v-model="userAccessForm.allowed_nodes"
                   class="w-4 h-4">
            <span class="text-2xl">ğŸ–¥ï¸</span>
            <div class="flex-1">
              <div class="font-semibold text-sm">{{ node.name }}</div>
              <div class="text-xs text-gray-600">{{ node.ip }}:{{ node.port }}</div>
            </div>
          </label>
        </div>
        <div class="text-xs text-gray-600 mt-2">
         å·²é€‰æ‹© {{ (userAccessForm.allowed_nodes || []).length }} ä¸ªèŠ‚ç‚¹
        </div>
      </div>

      <!-- æ‹’ç»è®¿é—®çš„èŠ‚ç‚¹(å¯é€‰) -->
      <div v-if="userAccessForm.type !== 'custom'" class="mb-6">
        <label class="block text-sm font-semibold mb-3">
          æ˜ç¡®æ‹’ç»è®¿é—®çš„èŠ‚ç‚¹ (å¯é€‰)
        </label>
        <details class="border rounded-lg">
          <summary class="px-3 py-2 cursor-pointer hover:bg-gray-50 text-sm font-medium">
            ç‚¹å‡»å±•å¼€é»‘åå•è®¾ç½®
          </summary>
          <div class="space-y-2 max-h-60 overflow-auto border rounded-lg p-3">
  <label v-for="node in (availableNodes || []).filter(n => n && n.id)" :key="node.id"
         class="flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer">
              <input type="checkbox"
                     :value="node.id"
                     v-model="userAccessForm.denied_nodes"
                     class="w-4 h-4">
              <span class="text-2xl">ğŸ–¥ï¸</span>
              <div class="flex-1">
                <div class="font-semibold text-sm">{{ node.name }}</div>
                <div class="text-xs text-gray-600">{{ node.ip }}:{{ node.port }}</div>
              </div>
            </label>
          </div>
        </details>
      </div>
    </div>

    <!-- å¯¹è¯æ¡†æŒ‰é’® -->
    <div class="flex justify-end gap-3 p-6 border-t">
      <button @click="closeUserAccessDialog()"
              class="px-4 py-2 border rounded-lg hover:bg-gray-100">
        å–æ¶ˆ
      </button>
      <button @click="saveUserNodeAccess()"
              class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
        ä¿å­˜
      </button>
    </div>
  </div>
</div>

    <!-- èƒŒæ™¯å›¾ç‰‡è®¾ç½®å¯¹è¯æ¡† -->
<!-- èƒŒæ™¯å›¾ç‰‡è®¾ç½®å¯¹è¯æ¡† -->
<div v-if="showBackgroundDialog"
     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[2000]"
     @click.self="showBackgroundDialog = false">
  <div class="bg-white rounded-xl shadow-2xl w-[500px] overflow-hidden">
    <div class="bg-gray-100 px-4 py-3 flex justify-between items-center border-b">
      <span class="font-semibold">ğŸ–¼ï¸ æ›´æ¢æ¡Œé¢èƒŒæ™¯</span>
      <button @click="showBackgroundDialog = false" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
    </div>
    <div class="p-4">
      <div class="mb-4">
        <div class="text-sm text-gray-600 mb-2">é¢„è®¾èƒŒæ™¯</div>
        <div class="grid grid-cols-4 gap-2">
          <div v-for="preset in bgPresets" :key="preset.name"
               @click="desktopBackground = preset.value; localStorage.setItem('desktopBackground', preset.value); showBackgroundDialog = false"
               class="h-16 rounded-lg cursor-pointer border-2 hover:border-blue-500 transition-all"
               :class="desktopBackground === preset.value ? 'border-blue-500' : 'border-gray-200'"
               :style="{ background: preset.value }">
          </div>
        </div>
        <div class="grid grid-cols-4 gap-2 mt-2">
          <div v-for="preset in bgPresets" :key="preset.name + '-label'" class="text-xs text-center text-gray-500">
            {{ preset.name }}
          </div>
        </div>
      </div>
      <div class="border-t pt-4">
        <div class="text-sm text-gray-600 mb-2">ä¸Šä¼ è‡ªå®šä¹‰å›¾ç‰‡</div>
        <div class="flex gap-2">
          <label class="flex-1 px-4 py-2 bg-gray-100 border border-dashed border-gray-300 rounded-lg text-sm text-center cursor-pointer hover:bg-gray-200">
            <span>ğŸ“· é€‰æ‹©å›¾ç‰‡æ–‡ä»¶</span>
            <input type="file" accept="image/*" @change="handleBackgroundFile" class="hidden">
          </label>
          <button @click="resetBackground()"
                  class="px-4 py-2 bg-gray-500 text-white rounded-lg text-sm hover:bg-gray-600">
            æ¢å¤é»˜è®¤
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

    <!-- å…³äºç³»ç»Ÿå¯¹è¯æ¡† -->
<div v-if="showAboutDialog"
     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[2000]"
     @click.self="showAboutDialog = false">
  <div class="bg-white rounded-lg shadow-xl w-[450px]">
    <div class="flex justify-between items-center p-6 border-b">
      <h3 class="text-xl font-bold">â„¹ï¸ å…³äºç³»ç»Ÿ</h3>
      <button @click="showAboutDialog = false" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
    </div>
    <div class="p-6 text-center">
      <div class="text-6xl mb-4">ğŸ–¥ï¸</div>
      <h2 class="text-2xl font-bold mb-2">NAS Center ç®¡ç†ç³»ç»Ÿ</h2>
      <p class="text-gray-500 mb-4">ç‰ˆæœ¬ 1.0.0</p>
      <div class="text-left bg-gray-50 rounded-lg p-4 text-sm text-gray-600 space-y-2">
        <p><strong>åŠŸèƒ½ç‰¹æ€§ï¼š</strong></p>
        <ul class="list-disc list-inside space-y-1 ml-2">
          <li>å¤šèŠ‚ç‚¹é›†ä¸­ç®¡ç†</li>
          <li>å®æ—¶çŠ¶æ€ç›‘æ§</li>
          <li>ç£ç›˜åŠ å¯†ç®¡ç†</li>
          <li>ç”¨æˆ·æƒé™æ§åˆ¶</li>
          <li>èŠ‚ç‚¹åˆ†ç»„ç®¡ç†</li>
        </ul>
      </div>
      <p class="text-xs text-gray-400 mt-4">Â© 2024 NAS Center. All rights reserved.</p>
    </div>
    <div class="flex justify-end p-6 border-t">
      <button @click="showAboutDialog = false" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">ç¡®å®š</button>
    </div>
  </div>
</div>

<!-- å¸®åŠ©æ–‡æ¡£å¯¹è¯æ¡† - è¯´æ˜ä¹¦é£æ ¼ -->
<div v-if="showHelpDialog"
     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[2000]"
     @click.self="showHelpDialog = false">
  <div class="bg-white rounded-lg shadow-xl w-[900px] h-[80vh] flex flex-col">

    <!-- æ ‡é¢˜æ  -->
    <div class="flex justify-between items-center p-4 border-b bg-gray-50">
      <h3 class="text-xl font-bold">ğŸ“˜ NAS Center ä½¿ç”¨æ‰‹å†Œ</h3>
      <button @click="showHelpDialog = false" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
    </div>

    <!-- ä¸»ä½“ï¼šå·¦ä¾§ç›®å½• + å³ä¾§å†…å®¹ -->
    <div class="flex flex-1 overflow-hidden">

      <!-- å·¦ä¾§ç›®å½• -->
      <div class="w-48 border-r bg-gray-50 overflow-y-auto">
        <div v-for="chapter in helpContent.chapters" :key="chapter.id"
             @click="currentHelpChapter = chapter.id"
             class="px-4 py-3 cursor-pointer hover:bg-gray-200 border-b border-gray-100"
             :class="currentHelpChapter === chapter.id ? 'bg-blue-100 text-blue-700 font-medium' : ''">
          {{ chapter.icon }} {{ chapter.title }}
        </div>
      </div>

      <!-- å³ä¾§å†…å®¹ -->
      <div class="flex-1 overflow-y-auto p-6">
        <div v-if="helpContent.sections[currentHelpChapter]">
          <h2 class="text-2xl font-bold mb-6 pb-2 border-b">
            {{ helpContent.sections[currentHelpChapter].title }}
          </h2>

          <!-- æ¸²æŸ“å„ç§å†…å®¹å— -->
          <template v-for="(block, idx) in helpContent.sections[currentHelpChapter].blocks" :key="idx">

            <!-- æ–‡å­—æ®µè½ -->
            <p v-if="block.type === 'text'" class="text-gray-700 mb-4 leading-relaxed">
              {{ block.content }}
            </p>

            <!-- å°æ ‡é¢˜ -->
            <h3 v-if="block.type === 'heading'" class="text-lg font-bold mt-6 mb-3 text-gray-800">
              {{ block.content }}
            </h3>

            <!-- å›¾ç‰‡ -->
            <figure v-if="block.type === 'image'" class="my-4">
              <img :src="block.src" :alt="block.caption"
                   class="rounded-lg border shadow-sm max-w-full">
              <figcaption class="text-center text-sm text-gray-500 mt-2">
                {{ block.caption }}
              </figcaption>
            </figure>

            <!-- æç¤ºæ¡† -->
            <div v-if="block.type === 'tip'"
                 class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 rounded-r">
              <span class="font-medium text-blue-700">ğŸ’¡ æç¤ºï¼š</span>
              <span class="text-blue-600">{{ block.content }}</span>
            </div>

            <!-- è­¦å‘Šæ¡† -->
            <div v-if="block.type === 'warning'"
                 class="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-4 rounded-r">
              <span class="font-medium text-yellow-700">âš ï¸ æ³¨æ„ï¼š</span>
              <span class="text-yellow-600">{{ block.content }}</span>
            </div>

            <!-- æ­¥éª¤è¯´æ˜ -->
            <div v-if="block.type === 'steps'" class="space-y-6 my-4">
              <div v-for="(step, i) in block.items" :key="i"
                   class="flex gap-4 bg-gray-50 rounded-lg p-4">
                <div class="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold flex-shrink-0">
                  {{ i + 1 }}
                </div>
                <div class="flex-1">
                  <h4 class="font-bold mb-1">{{ step.title }}</h4>
                  <p class="text-gray-600 text-sm mb-2">{{ step.text }}</p>
                  <img v-if="step.image" :src="step.image" class="rounded border max-w-md">
                </div>
              </div>
            </div>

            <!-- åˆ—è¡¨è¯´æ˜ -->
            <div v-if="block.type === 'list'" class="bg-gray-50 rounded-lg p-4 mb-4">
              <div v-for="item in block.items" :key="item.label" class="py-2 border-b last:border-0">
                <span class="font-medium text-blue-600">{{ item.label }}ï¼š</span>
                <span class="text-gray-600">{{ item.desc }}</span>
              </div>
            </div>

          </template>
        </div>
      </div>
    </div>

    <!-- åº•éƒ¨ -->
    <div class="flex justify-between items-center p-4 border-t bg-gray-50">
      <span class="text-sm text-gray-500">NAS Center v1.0.0</span>
      <button @click="showHelpDialog = false"
              class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
        å…³é—­
      </button>
    </div>
  </div>
</div>

    <div v-if="showSecretDialog"
     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[2000]"
     @click.self="showSecretDialog = false">
  <div class="bg-white rounded-lg shadow-xl w-[500px]">
    <div class="flex justify-between items-center p-6 border-b">
      <h3 class="text-xl font-bold text-red-600 flex items-center gap-2">
        <span>ğŸ›¡ï¸</span> ä¿®æ”¹é€šä¿¡å¯†é’¥
      </h3>
      <button @click="showSecretDialog = false" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
    </div>

    <div class="p-6">
      <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-6">
        <div class="flex items-start gap-3">
          <span class="text-2xl">âš ï¸</span>
          <div>
            <p class="font-bold text-yellow-800">é«˜é£é™©æ“ä½œ</p>
            <p class="text-sm text-yellow-700 mt-1">
              ä¿®æ”¹ä¸»æ§ç«¯çš„é€šä¿¡å¯†é’¥åï¼Œ<strong>æ‰€æœ‰å·²è¿æ¥çš„ NAS èŠ‚ç‚¹å°†ç«‹å³ç¦»çº¿</strong>ï¼Œç›´åˆ°æ‚¨æ‰‹åŠ¨æ›´æ–°æ¯ä¸ªèŠ‚ç‚¹çš„å¯†é’¥é…ç½®ä»¥åŒ¹é…æ­¤æ–°å¯†é’¥ã€‚
            </p>
          </div>
        </div>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2">æ–°çš„å…±äº«å¯†é’¥ (NAS_SHARED_SECRET)</label>
        <div class="relative">
          <input v-model="newSecretValue"
                 :type="showSecretPlain ? 'text' : 'password'"
                 placeholder="è¯·è¾“å…¥æ–°çš„é€šä¿¡å¯†é’¥"
                 class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 pr-10">
          <button @click="showSecretPlain = !showSecretPlain"
                  class="absolute right-3 top-2.5 text-gray-500 hover:text-gray-700">
            {{ showSecretPlain ? 'ğŸ‘ï¸â€ğŸ—¨ï¸' : 'ğŸ‘ï¸' }}
          </button>
        </div>
      </div>

      <div class="text-xs text-gray-500">
        å»ºè®®ä½¿ç”¨å¤æ‚çš„éšæœºå­—ç¬¦ä¸²ä»¥ç¡®ä¿å®‰å…¨ã€‚
      </div>
    </div>

    <div class="flex justify-end gap-3 p-6 border-t bg-gray-50 rounded-b-lg">
      <button @click="showSecretDialog = false" class="px-4 py-2 border rounded-lg hover:bg-gray-100">
        å–æ¶ˆ
      </button>
      <button @click="saveSecret"
              class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 shadow-md transition flex items-center gap-2">
        <span>ğŸ’¾</span> ç¡®è®¤ä¿®æ”¹
      </button>
    </div>
  </div>
</div>

    <!-- ä¸ªäººä¿¡æ¯å¯¹è¯æ¡† -->
<div v-if="showProfileDialog"
     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[2000]"
     @click.self="showProfileDialog = false">
  <div class="bg-white rounded-lg shadow-xl w-[500px]">
    <div class="flex justify-between items-center p-6 border-b">
      <h3 class="text-xl font-bold">ğŸ‘¤ ä¸ªäººä¿¡æ¯</h3>
      <button @click="showProfileDialog = false" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
    </div>

    <div class="p-6">
      <!-- å¤´åƒ -->
      <div class="flex flex-col items-center mb-6">
        <div class="relative">
          <div class="w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden border-4 border-blue-500">
            <img v-if="profileForm.avatar" :src="profileForm.avatar" class="w-full h-full object-cover">
            <span v-else class="text-4xl">ğŸ‘¤</span>
          </div>
          <label class="absolute bottom-0 right-0 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center cursor-pointer hover:bg-blue-600 transition">
            <span class="text-white text-sm">ğŸ“·</span>
            <input type="file" accept="image/*" @change="handleAvatarUpload" class="hidden">
          </label>
        </div>
        <div class="text-sm text-gray-500 mt-2">ç‚¹å‡»ç›¸æœºå›¾æ ‡æ›´æ¢å¤´åƒ</div>
      </div>

      <!-- ç”¨æˆ·å(ä¸å¯ç¼–è¾‘) -->
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2">ç”¨æˆ·å</label>
        <input v-model="profileForm.username" type="text" disabled
               class="w-full px-4 py-2 border rounded-lg bg-gray-100 text-gray-600">
      </div>

      <!-- é‚®ç®± -->
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2">é‚®ç®±</label>
        <input v-model="profileForm.email" type="email" placeholder="è¯·è¾“å…¥é‚®ç®±"
               class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>

      <!-- è§’è‰² -->
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2">è§’è‰²</label>
        <input :value="profileForm.role === 'admin' ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'" type="text" disabled
               class="w-full px-4 py-2 border rounded-lg bg-gray-100 text-gray-600">
      </div>

      <!-- æ³¨å†Œæ—¶é—´ -->
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2">æ³¨å†Œæ—¶é—´</label>
        <input :value="profileForm.created_at" type="text" disabled
               class="w-full px-4 py-2 border rounded-lg bg-gray-100 text-gray-600">
      </div>
    </div>

    <div class="flex justify-end gap-3 p-6 border-t">
      <button @click="showProfileDialog = false" class="px-4 py-2 border rounded-lg hover:bg-gray-100">å–æ¶ˆ</button>
      <button @click="saveProfile" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">ä¿å­˜</button>
    </div>
  </div>
</div>

      </div></div>


<script src="helpContent.js"></script>
  <script src="app.js"></script>

</body>
</html>
```