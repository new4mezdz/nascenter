<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NAS Center ç®¡ç†ç³»ç»Ÿ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    /* æ¡Œé¢èƒŒæ™¯ */
    .desktop {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      position: relative;
      user-select: none;
    }

    /* æ¡Œé¢å›¾æ ‡ */
    .desktop-icon {
      width: 90px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      padding: 8px;
    }

    .desktop-icon:hover {
      transform: translateY(-2px);
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
    }

    /* çª—å£ç³»ç»Ÿ */
    .window {
      position: absolute;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
      min-width: 400px;
      min-height: 300px;
      display: flex;
      flex-direction: column;
    }

    .window.maximized {
      top: 0 !important;
      left: 0 !important;
      width: 100% !important;
      height: calc(100vh - 50px) !important;
      border-radius: 0;
    }

    .window-header {
      background: linear-gradient(180deg, #f7f7f7 0%, #e8e8e8 100%);
      padding: 12px 16px;
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #ddd;
    }

    .window-controls button {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: none;
      margin-left: 8px;
      cursor: pointer;
    }

    .window-controls .close { background: #ff5f57; }
    .window-controls .minimize { background: #ffbd2e; }
    .window-controls .maximize { background: #28ca42; }

    .window-content {
      flex: 1;
      overflow: auto;
    }

    /* ä»»åŠ¡æ  */
    .taskbar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 50px;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      padding: 0 20px;
      z-index: 1000;
    }

    .taskbar-item {
      height: 40px;
      padding: 0 16px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      margin-right: 8px;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: all 0.2s;
      color: white;
    }

    .taskbar-item:hover {
      background: rgba(255,255,255,0.2);
    }

    .taskbar-item.active {
      background: rgba(255,255,255,0.3);
    }

    /* åŠ è½½çŠ¶æ€ */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #3b82f6;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* åŠ¨ç”» */
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    .window {
      animation: fadeIn 0.2s ease-out;
    }

    /* ç½‘æ ¼è§†å›¾ */
    .icon-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, 90px);
      gap: 20px;
      padding: 20px;
    }

    /* æ»šåŠ¨æ¡ç¾åŒ– */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
  </style>
</head>
<body>

  <div id="app">
    <!-- æ¡Œé¢ç¯å¢ƒ -->
    <div class="desktop fixed inset-0" @click="closeAllMenus">

      <!-- æ¡Œé¢å›¾æ ‡åŒºåŸŸ -->
      <div class="icon-grid p-8">
        <!-- èŠ‚ç‚¹ç®¡ç† -->
        <div class="desktop-icon" @dblclick="openNodeManagement">
          <div class="w-16 h-16 mx-auto mb-2 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-4xl">
            ğŸ–¥ï¸
          </div>
          <div class="text-white text-xs font-semibold drop-shadow-lg">èŠ‚ç‚¹ç®¡ç†</div>
        </div>

        <!-- å†…ç½‘ç©¿é€ -->
        <div class="desktop-icon" @dblclick="openIntranetAccess">
          <div class="w-16 h-16 mx-auto mb-2 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-4xl">
            ğŸŒ
          </div>
          <div class="text-white text-xs font-semibold drop-shadow-lg">å†…ç½‘ç©¿é€</div>
        </div>

        <!-- ç”¨æˆ·æƒé™è®¾ç½® -->
        <div class="desktop-icon" @dblclick="openPermissionSettings">
          <div class="w-16 h-16 mx-auto mb-2 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-4xl">
            ğŸ”
          </div>
          <div class="text-white text-xs font-semibold drop-shadow-lg">æƒé™è®¾ç½®</div>
        </div>

        <!-- çº åˆ ç é…ç½® -->
        <div class="desktop-icon" @dblclick="openECConfig">
          <div class="w-16 h-16 mx-auto mb-2 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-4xl">
            ğŸ›¡ï¸
          </div>
          <div class="text-white text-xs font-semibold drop-shadow-lg">çº åˆ ç é…ç½®</div>
        </div>

        <!-- ç³»ç»Ÿç›‘æ§ -->
        <div class="desktop-icon" @dblclick="openSystemMonitor">
          <div class="w-16 h-16 mx-auto mb-2 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-4xl">
            ğŸ“Š
          </div>
          <div class="text-white text-xs font-semibold drop-shadow-lg">ç³»ç»Ÿç›‘æ§</div>
        </div>
      </div>

      <!-- çª—å£å®¹å™¨ -->
      <div v-for="window in windows" :key="window.id"
           :class="['window', { maximized: window.maximized }]"
           :style="window.maximized ? {} : {
             top: window.y + 'px',
             left: window.x + 'px',
             width: window.width + 'px',
             height: window.height + 'px',
             zIndex: window.zIndex,
             display: window.minimized ? 'none' : 'flex'
           }"
           @mousedown="focusWindow(window.id)">

        <!-- çª—å£æ ‡é¢˜æ  -->
        <div class="window-header" @mousedown="startDrag($event, window)">
          <div class="flex items-center gap-2">
            <span class="text-2xl">{{ window.icon }}</span>
            <span class="font-semibold text-sm">{{ window.title }}</span>
          </div>
          <div class="window-controls flex">
            <button class="minimize" @click.stop="minimizeWindow(window.id)"></button>
            <button class="maximize" @click.stop="toggleMaximize(window.id)"></button>
            <button class="close" @click.stop="closeWindow(window.id)"></button>
          </div>
        </div>

        <!-- çª—å£å†…å®¹ -->
        <div class="window-content" style="padding: 0; overflow: hidden;">

          <!-- èŠ‚ç‚¹ç®¡ç†çª—å£ -->
          <div v-if="window.type === 'nodes'" class="h-full flex flex-col">
            <!-- æ ‡é¢˜æ  -->
            <div class="px-6 py-4 border-b bg-gradient-to-r from-blue-50 to-purple-50">
              <div class="flex justify-between items-center">
                <div>
                  <h3 class="text-xl font-bold flex items-center gap-2">
                    <span class="text-3xl">ğŸ–¥ï¸</span>
                    èŠ‚ç‚¹ç®¡ç†
                  </h3>
                  <p class="text-sm text-gray-600 mt-1">ç®¡ç†å’Œç›‘æ§æ‰€æœ‰ NAS èŠ‚ç‚¹</p>
                </div>
                <button @click="refreshNodes(window)"
                        class="px-4 py-2 bg-white border rounded-lg hover:bg-gray-50 transition flex items-center gap-2">
                  <span v-if="window.loading" class="loading"></span>
                  <span v-else>ğŸ”„</span>
                  åˆ·æ–°
                </button>
              </div>
            </div>

            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div v-if="window.stats" class="grid grid-cols-4 gap-4 p-6 bg-gray-50">
              <div class="bg-white rounded-lg shadow p-4 border">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-xs text-gray-600 mb-1">æ€»èŠ‚ç‚¹</div>
                    <div class="text-2xl font-bold text-blue-600">{{ window.stats.total }}</div>
                  </div>
                  <div class="text-4xl">ğŸ–¥ï¸</div>
                </div>
              </div>
              <div class="bg-white rounded-lg shadow p-4 border">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-xs text-gray-600 mb-1">åœ¨çº¿</div>
                    <div class="text-2xl font-bold text-green-600">{{ window.stats.online }}</div>
                  </div>
                  <div class="text-4xl">âœ…</div>
                </div>
              </div>
              <div class="bg-white rounded-lg shadow p-4 border">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-xs text-gray-600 mb-1">ç¦»çº¿</div>
                    <div class="text-2xl font-bold text-red-600">{{ window.stats.offline }}</div>
                  </div>
                  <div class="text-4xl">âŒ</div>
                </div>
              </div>
              <div class="bg-white rounded-lg shadow p-4 border">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-xs text-gray-600 mb-1">è­¦å‘Š</div>
                    <div class="text-2xl font-bold text-yellow-600">{{ window.stats.warning }}</div>
                  </div>
                  <div class="text-4xl">âš ï¸</div>
                </div>
              </div>
            </div>

            <!-- èŠ‚ç‚¹åˆ—è¡¨ -->
            <div class="flex-1 overflow-auto p-6 bg-gray-50">
              <div class="bg-white rounded-lg shadow border">
                <table class="w-full">
                  <thead class="bg-gray-50 border-b">
                    <tr>
                      <th class="text-left p-4 font-semibold text-gray-700">èŠ‚ç‚¹åç§°</th>
                      <th class="text-left p-4 font-semibold text-gray-700">åœ°å€</th>
                      <th class="text-left p-4 font-semibold text-gray-700">çŠ¶æ€</th>
                      <th class="text-left p-4 font-semibold text-gray-700">CPU</th>
                      <th class="text-left p-4 font-semibold text-gray-700">å†…å­˜</th>
                      <th class="text-left p-4 font-semibold text-gray-700">ç£ç›˜</th>
                      <th class="text-left p-4 font-semibold text-gray-700">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="node in window.nodes" :key="node.id"
                        class="border-b hover:bg-gray-50">
                      <td class="p-4">
                        <div class="font-semibold text-gray-800">{{ node.name }}</div>
                        <div class="text-xs text-gray-500">{{ node.id }}</div>
                      </td>
                      <td class="p-4 text-sm">{{ node.ip }}:{{ node.port }}</td>
                      <td class="p-4">
                        <span class="px-3 py-1 rounded-full text-xs font-semibold"
                              :class="getStatusClass(node.status)">
                          {{ getStatusText(node.status) }}
                        </span>
                      </td>
                      <td class="p-4">
                        <span v-if="node.status !== 'offline'" class="text-sm font-semibold"
                              :class="node.cpu_usage > 80 ? 'text-red-600' : 'text-gray-700'">
                          {{ node.cpu_usage.toFixed(1) }}%
                        </span>
                        <span v-else class="text-sm text-gray-400">-</span>
                      </td>
                      <td class="p-4">
                        <span v-if="node.status !== 'offline'" class="text-sm font-semibold"
                              :class="node.memory_usage > 80 ? 'text-red-600' : 'text-gray-700'">
                          {{ node.memory_usage.toFixed(1) }}%
                        </span>
                        <span v-else class="text-sm text-gray-400">-</span>
                      </td>
                      <td class="p-4">
                        <span v-if="node.status !== 'offline'" class="text-sm font-semibold"
                              :class="node.disk_usage > 80 ? 'text-red-600' : 'text-gray-700'">
                          {{ node.disk_usage.toFixed(1) }}%
                        </span>
                        <span v-else class="text-sm text-gray-400">-</span>
                      </td>
                      <td class="p-4">
                        <div class="flex gap-2">
                          <button @click="viewNodeDisks(window, node)"
                                  class="px-3 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600">
                            ğŸ’¾ ç£ç›˜
                          </button>
                          <button @click="viewNodeDetail(window, node)"
                                  class="px-3 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600">
                            ğŸ“Š è¯¦æƒ…
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- èŠ‚ç‚¹ç£ç›˜è¯¦æƒ…å¼¹çª— -->
            <div v-if="window.selectedNodeDisks"
                 @click="window.selectedNodeDisks = null"
                 class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
              <div @click.stop class="bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden">
                <div class="px-6 py-4 border-b bg-gradient-to-r from-blue-500 to-purple-600 text-white">
                  <h3 class="text-xl font-bold">{{ window.selectedNodeDisks.name }} - ç£ç›˜ä¿¡æ¯</h3>
                </div>
                <div class="p-6 overflow-y-auto max-h-[60vh]">
                  <div class="space-y-4">
                    <div v-for="(disk, index) in window.selectedNodeDisks.disks" :key="index"
                         class="border rounded-lg p-4 bg-gray-50">
                      <div class="flex justify-between items-start mb-3">
                        <div>
                          <div class="font-bold text-lg">{{ disk.mount }}</div>
                          <div class="text-sm text-gray-600">å®¹é‡: {{ disk.total }} GB</div>
                        </div>
                        <span v-if="disk.ec_scheme" class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-semibold">
                          ğŸ›¡ï¸ {{ disk.ec_scheme }}
                        </span>
                      </div>
                      <div class="w-full bg-gray-200 rounded-full h-4">
                        <div class="h-4 rounded-full flex items-center justify-center text-xs text-white font-semibold"
                             :class="disk.usage > 90 ? 'bg-red-500' : disk.usage > 70 ? 'bg-yellow-500' : 'bg-green-500'"
                             :style="{ width: disk.usage + '%' }">
                          {{ disk.usage }}%
                        </div>
                      </div>
                      <div class="flex justify-between text-xs text-gray-600 mt-2">
                        <span>å·²ç”¨: {{ disk.used }} GB</span>
                        <span>å¯ç”¨: {{ disk.free }} GB</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="px-6 py-4 border-t bg-gray-50 flex justify-end">
                  <button @click="window.selectedNodeDisks = null"
                          class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">
                    å…³é—­
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- å†…ç½‘ç©¿é€çª—å£ -->
          <div v-else-if="window.type === 'intranet'" class="h-full flex flex-col overflow-hidden">
            <div class="px-6 py-4 border-b bg-gradient-to-r from-green-50 to-blue-50">
              <h3 class="text-xl font-bold flex items-center gap-2">
                <span class="text-3xl">ğŸŒ</span>
                å†…ç½‘ç©¿é€
              </h3>
              <p class="text-sm text-gray-600 mt-1">é€šè¿‡ç©¿é€æœåŠ¡è¿œç¨‹è®¿é—®å†…ç½‘èŠ‚ç‚¹</p>
            </div>

            <div class="flex-1 overflow-auto p-6">
              <!-- ç©¿é€çŠ¶æ€ -->
              <div class="bg-white rounded-lg shadow border p-6 mb-6">
                <h4 class="font-semibold text-lg mb-4">ç©¿é€æœåŠ¡çŠ¶æ€</h4>
                <div class="grid grid-cols-3 gap-4">
                  <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                    <div class="text-sm text-gray-600 mb-1">æœåŠ¡çŠ¶æ€</div>
                    <div class="text-xl font-bold text-green-600 flex items-center gap-2">
                      <span class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></span>
                      è¿è¡Œä¸­
                    </div>
                  </div>
                  <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <div class="text-sm text-gray-600 mb-1">æ´»è·ƒè¿æ¥</div>
                    <div class="text-xl font-bold text-blue-600">{{ window.activeConnections || 3 }}</div>
                  </div>
                  <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                    <div class="text-sm text-gray-600 mb-1">ä»Šæ—¥æµé‡</div>
                    <div class="text-xl font-bold text-purple-600">2.3 GB</div>
                  </div>
                </div>
              </div>

              <!-- èŠ‚ç‚¹è®¿é—®åˆ—è¡¨ -->
              <div class="bg-white rounded-lg shadow border">
                <div class="px-6 py-4 border-b">
                  <h4 class="font-semibold">èŠ‚ç‚¹è®¿é—®åˆ—è¡¨</h4>
                </div>
                <table class="w-full">
                  <thead class="bg-gray-50 border-b">
                    <tr>
                      <th class="text-left p-4 font-semibold text-gray-700">èŠ‚ç‚¹åç§°</th>
                      <th class="text-left p-4 font-semibold text-gray-700">å†…ç½‘åœ°å€</th>
                      <th class="text-left p-4 font-semibold text-gray-700">å¤–ç½‘åœ°å€</th>
                      <th class="text-left p-4 font-semibold text-gray-700">çŠ¶æ€</th>
                      <th class="text-left p-4 font-semibold text-gray-700">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="tunnel in window.tunnels" :key="tunnel.id" class="border-b hover:bg-gray-50">
                      <td class="p-4">
                        <div class="font-semibold">{{ tunnel.name }}</div>
                      </td>
                      <td class="p-4 text-sm font-mono">{{ tunnel.localAddr }}</td>
                      <td class="p-4 text-sm font-mono text-blue-600">{{ tunnel.publicAddr }}</td>
                      <td class="p-4">
                        <span :class="tunnel.active ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'"
                              class="px-3 py-1 rounded-full text-xs font-semibold">
                          {{ tunnel.active ? 'ğŸŸ¢ å·²è¿æ¥' : 'âšª æœªè¿æ¥' }}
                        </span>
                      </td>
                      <td class="p-4">
                        <button @click="openTunnel(tunnel)"
                                class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">
                          ğŸ”— è®¿é—®
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- æƒé™è®¾ç½®çª—å£ -->
          <div v-else-if="window.type === 'permission'" class="h-full flex flex-col overflow-hidden">
            <div class="px-6 py-4 border-b bg-gradient-to-r from-purple-50 to-pink-50">
              <h3 class="text-xl font-bold flex items-center gap-2">
                <span class="text-3xl">ğŸ”</span>
                ç”¨æˆ·æƒé™è®¾ç½®
              </h3>
              <p class="text-sm text-gray-600 mt-1">é…ç½®ç”¨æˆ·å¯¹èŠ‚ç‚¹å’Œç£ç›˜çš„è®¿é—®æƒé™</p>
            </div>

            <div class="flex-1 overflow-auto p-6">
              <!-- èŠ‚ç‚¹æƒé™ -->
              <div class="bg-white rounded-lg shadow border mb-6">
                <div class="px-6 py-4 border-b">
                  <h4 class="font-semibold">èŠ‚ç‚¹è®¿é—®æƒé™</h4>
                </div>
                <div class="p-6">
                  <table class="w-full">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="text-left p-3 font-semibold text-gray-700">èŠ‚ç‚¹</th>
                        <th class="text-center p-3 font-semibold text-gray-700">å¯è§</th>
                        <th class="text-center p-3 font-semibold text-gray-700">åªè¯»</th>
                        <th class="text-center p-3 font-semibold text-gray-700">è¯»å†™</th>
                        <th class="text-center p-3 font-semibold text-gray-700">ç®¡ç†</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr v-for="node in window.permissionNodes" :key="node.id" class="border-b">
                        <td class="p-3">
                          <div class="font-semibold">{{ node.name }}</div>
                          <div class="text-xs text-gray-500">{{ node.ip }}</div>
                        </td>
                        <td class="p-3 text-center">
                          <input type="checkbox" v-model="node.permissions.visible" class="w-4 h-4">
                        </td>
                        <td class="p-3 text-center">
                          <input type="radio" :name="'perm-' + node.id" v-model="node.permissions.level" value="readonly" class="w-4 h-4">
                        </td>
                        <td class="p-3 text-center">
                          <input type="radio" :name="'perm-' + node.id" v-model="node.permissions.level" value="readwrite" class="w-4 h-4">
                        </td>
                        <td class="p-3 text-center">
                          <input type="radio" :name="'perm-' + node.id" v-model="node.permissions.level" value="admin" class="w-4 h-4">
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- ç£ç›˜éšè—è®¾ç½® -->
              <div class="bg-white rounded-lg shadow border">
                <div class="px-6 py-4 border-b">
                  <h4 class="font-semibold">ç£ç›˜å¯è§æ€§è®¾ç½®</h4>
                </div>
                <div class="p-6">
                  <div class="space-y-4">
                    <div v-for="disk in window.diskVisibility" :key="disk.id"
                         class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border">
                      <div>
                        <div class="font-semibold">{{ disk.node }} - {{ disk.mount }}</div>
                        <div class="text-sm text-gray-600">{{ disk.size }} GB</div>
                      </div>
                      <label class="flex items-center gap-2 cursor-pointer">
                        <span class="text-sm">{{ disk.visible ? 'ğŸŸ¢ å¯è§' : 'ğŸ”´ éšè—' }}</span>
                        <input type="checkbox" v-model="disk.visible" class="w-5 h-5">
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ä¿å­˜æŒ‰é’® -->
              <div class="mt-6 flex justify-end">
                <button @click="savePermissions(window)"
                        class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                  ğŸ’¾ ä¿å­˜è®¾ç½®
                </button>
              </div>
            </div>
          </div>

          <!-- çº åˆ ç é…ç½®çª—å£ -->
          <div v-else-if="window.type === 'ec'" class="h-full flex flex-col overflow-hidden">
            <div class="px-6 py-4 border-b bg-gradient-to-r from-orange-50 to-red-50">
              <h3 class="text-xl font-bold flex items-center gap-2">
                <span class="text-3xl">ğŸ›¡ï¸</span>
                çº åˆ ç é…ç½®
              </h3>
              <p class="text-sm text-gray-600 mt-1">é…ç½®æ•°æ®ä¿æŠ¤å’Œå†—ä½™ç­–ç•¥</p>
            </div>

            <div class="flex-1 overflow-auto p-6">
              <!-- å½“å‰çŠ¶æ€ -->
              <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-6">
                <div class="flex items-start gap-3">
                  <span class="text-2xl">â„¹ï¸</span>
                  <div>
                    <h4 class="font-semibold text-blue-900 mb-1">ä»€ä¹ˆæ˜¯çº åˆ ç ?</h4>
                    <p class="text-sm text-blue-800">çº åˆ ç (Erasure Coding)æ˜¯ä¸€ç§æ•°æ®ä¿æŠ¤æŠ€æœ¯,å¯ä»¥åœ¨éƒ¨åˆ†ç¡¬ç›˜æŸåæ—¶æ¢å¤æ•°æ®ã€‚é…ç½®å,æ•°æ®ä¼šè¢«åˆ†æ•£å­˜å‚¨åœ¨å¤šä¸ªç¡¬ç›˜ä¸Šã€‚</p>
                  </div>
                </div>
              </div>

              <!-- é…ç½®çŠ¶æ€ -->
              <div class="bg-white rounded-lg shadow border p-6 mb-6">
                <h4 class="font-semibold text-lg mb-4">å½“å‰é…ç½®çŠ¶æ€</h4>
                <div v-if="window.ecConfig.isConfigured">
                  <div class="grid grid-cols-3 gap-4 mb-4">
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                      <div class="text-sm text-gray-600 mb-1">é…ç½®æ–¹æ¡ˆ</div>
                      <div class="text-lg font-bold text-green-700">
                        Reed-Solomon ({{ window.ecConfig.k }}+{{ window.ecConfig.m }})
                      </div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                      <div class="text-sm text-gray-600 mb-1">å‚ä¸ç£ç›˜</div>
                      <div class="text-lg font-bold text-blue-700">{{ window.ecConfig.diskCount }} ä¸ª</div>
                    </div>
                    <div :class="window.ecConfig.healthy ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'"
                         class="p-4 rounded-lg border">
                      <div class="text-sm text-gray-600 mb-1">ç³»ç»ŸçŠ¶æ€</div>
                      <div class="text-lg font-bold" :class="window.ecConfig.healthy ? 'text-green-700' : 'text-red-700'">
                        {{ window.ecConfig.healthy ? 'âœ… å¥åº·' : 'âš ï¸ å¼‚å¸¸' }}
                      </div>
                    </div>
                  </div>
                  <button @click="reconfigureEC(window)"
                          class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600">
                    âš™ï¸ é‡æ–°é…ç½®
                  </button>
                </div>
                <div v-else class="text-center py-8">
                  <p class="text-gray-500 mb-4">å°šæœªé…ç½®çº åˆ ç </p>
                  <button @click="startECConfig(window)"
                          class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                    ğŸš€ å¼€å§‹é…ç½®
                  </button>
                </div>
              </div>

              <!-- é…ç½®å‘å¯¼ -->
              <div v-if="window.showConfigWizard" class="bg-white rounded-lg shadow border p-6">
                <h4 class="font-semibold text-lg mb-4">çº åˆ ç é…ç½®å‘å¯¼</h4>

                <!-- æ­¥éª¤1: é€‰æ‹©æ–¹æ¡ˆ -->
                <div class="mb-6">
                  <label class="block text-sm font-medium text-gray-700 mb-2">é€‰æ‹©çº åˆ ç æ–¹æ¡ˆ</label>
                  <div class="grid grid-cols-3 gap-4">
                    <div v-for="scheme in window.ecSchemes" :key="scheme.name"
                         @click="window.selectedScheme = scheme"
                         :class="window.selectedScheme?.name === scheme.name ? 'border-blue-500 bg-blue-50' : 'border-gray-200'"
                         class="border-2 rounded-lg p-4 cursor-pointer hover:border-blue-400 transition">
                      <div class="font-bold text-lg mb-2">{{ scheme.name }}</div>
                      <div class="text-sm text-gray-600 mb-2">{{ scheme.description }}</div>
                      <div class="text-xs text-gray-500">
                        æœ€å¤šå®¹å¿ {{ scheme.m }} ä¸ªç£ç›˜æ•…éšœ
                      </div>
                    </div>
                  </div>
                </div>

                <!-- æ­¥éª¤2: é€‰æ‹©ç£ç›˜ -->
                <div class="mb-6">
                  <label class="block text-sm font-medium text-gray-700 mb-2">é€‰æ‹©å‚ä¸çš„ç£ç›˜</label>
                  <div class="space-y-2">
                    <div v-for="disk in window.availableDisks" :key="disk.id"
                         class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border">
                      <input type="checkbox" v-model="disk.selected" class="w-5 h-5">
                      <div class="flex-1">
                        <div class="font-semibold">{{ disk.node }} - {{ disk.mount }}</div>
                        <div class="text-sm text-gray-600">{{ disk.size }} GB å¯ç”¨</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- æ“ä½œæŒ‰é’® -->
                <div class="flex justify-end gap-3">
                  <button @click="window.showConfigWizard = false"
                          class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">
                    å–æ¶ˆ
                  </button>
                  <button @click="applyECConfig(window)"
                          class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                    åº”ç”¨é…ç½®
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- ç³»ç»Ÿç›‘æ§çª—å£ -->
          <div v-else-if="window.type === 'monitor'" class="h-full flex flex-col overflow-hidden">
            <div class="px-6 py-4 border-b bg-gradient-to-r from-indigo-50 to-blue-50">
              <h3 class="text-xl font-bold flex items-center gap-2">
                <span class="text-3xl">ğŸ“Š</span>
                ç³»ç»Ÿç›‘æ§
              </h3>
              <p class="text-sm text-gray-600 mt-1">å®æ—¶ç›‘æ§æ•´ä½“ç³»ç»Ÿè¿è¡ŒçŠ¶æ€</p>
            </div>

            <div class="flex-1 overflow-auto p-6 bg-gray-50">
              <!-- æ€»è§ˆç»Ÿè®¡ -->
              <div class="grid grid-cols-4 gap-4 mb-6">
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-5 rounded-lg shadow">
                  <div class="text-sm opacity-90 mb-1">æ€»å­˜å‚¨å®¹é‡</div>
                  <div class="text-3xl font-bold">{{ window.totalStorage }} TB</div>
                </div>
                <div class="bg-gradient-to-br from-green-500 to-green-600 text-white p-5 rounded-lg shadow">
                  <div class="text-sm opacity-90 mb-1">å·²ç”¨å®¹é‡</div>
                  <div class="text-3xl font-bold">{{ window.usedStorage }} TB</div>
                </div>
                <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white p-5 rounded-lg shadow">
                  <div class="text-sm opacity-90 mb-1">å¹³å‡CPU</div>
                  <div class="text-3xl font-bold">{{ window.avgCpu }}%</div>
                </div>
                <div class="bg-gradient-to-br from-orange-500 to-orange-600 text-white p-5 rounded-lg shadow">
                  <div class="text-sm opacity-90 mb-1">ç½‘ç»œæµé‡</div>
                  <div class="text-3xl font-bold">{{ window.networkTraffic }} MB/s</div>
                </div>
              </div>

              <!-- å®æ—¶å›¾è¡¨ -->
              <div class="bg-white rounded-lg shadow border p-6">
                <h4 class="font-semibold mb-4">æ€§èƒ½è¶‹åŠ¿</h4>
                <div class="h-64 flex items-center justify-center border-2 border-dashed rounded-lg">
                  <div class="text-center text-gray-400">
                    <div class="text-4xl mb-2">ğŸ“ˆ</div>
                    <p>å›¾è¡¨åŒºåŸŸ (å¯æ¥å…¥çœŸå®ç›‘æ§æ•°æ®)</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- ä»»åŠ¡æ  -->
      <div class="taskbar">
        <!-- å¼€å§‹æŒ‰é’® -->
        <div class="taskbar-item">
          <span class="text-xl">ğŸš€</span>
          <span class="ml-2 font-semibold">NAS Center</span>
        </div>

        <!-- çª—å£åˆ—è¡¨ -->
        <div v-for="window in windows.filter(w => !w.minimized)"
             :key="window.id"
             @click="focusWindow(window.id)"
             :class="['taskbar-item', { active: window.zIndex === maxZIndex }]">
          <span>{{ window.icon }}</span>
          <span class="ml-2">{{ window.title }}</span>
        </div>

        <!-- å³ä¾§ä¿¡æ¯ -->
        <div class="ml-auto flex items-center gap-4 text-white text-sm">
          <span>â° {{ currentTime }}</span>
        </div>
      </div>

    </div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          windows: [],
          nextWindowId: 1,
          maxZIndex: 100,
          currentTime: '',
          dragWindow: null,
          dragOffset: { x: 0, y: 0 },
          apiBaseUrl: 'http://localhost:8080'
        };
      },
      mounted() {
        this.updateTime();
        setInterval(() => this.updateTime(), 1000);

        // è‡ªåŠ¨æ‰“å¼€èŠ‚ç‚¹ç®¡ç†
        this.openNodeManagement();
      },
      methods: {
        updateTime() {
          const now = new Date();
          this.currentTime = now.toLocaleTimeString('zh-CN');
        },

        createWindow(config) {
          const win = {
            id: this.nextWindowId++,
            x: 100 + (this.windows.length * 30),
            y: 50 + (this.windows.length * 30),
            width: config.width || 900,
            height: config.height || 600,
            zIndex: this.maxZIndex++,
            maximized: false,
            minimized: false,
            ...config
          };
          this.windows.push(win);
          return win;
        },

        closeWindow(id) {
          const index = this.windows.findIndex(w => w.id === id);
          if (index !== -1) {
            this.windows.splice(index, 1);
          }
        },

        minimizeWindow(id) {
          const win = this.windows.find(w => w.id === id);
          if (win) win.minimized = true;
        },

        toggleMaximize(id) {
          const win = this.windows.find(w => w.id === id);
          if (win) win.maximized = !win.maximized;
        },

        focusWindow(id) {
          const win = this.windows.find(w => w.id === id);
          if (win) {
            win.minimized = false;
            win.zIndex = this.maxZIndex++;
          }
        },

        startDrag(event, window) {
          if (window.maximized) return;
          this.dragWindow = window;
          this.dragOffset.x = event.clientX - window.x;
          this.dragOffset.y = event.clientY - window.y;

          document.addEventListener('mousemove', this.onDrag);
          document.addEventListener('mouseup', this.stopDrag);
        },

        onDrag(event) {
          if (!this.dragWindow) return;
          this.dragWindow.x = event.clientX - this.dragOffset.x;
          this.dragWindow.y = event.clientY - this.dragOffset.y;
        },

        stopDrag() {
          this.dragWindow = null;
          document.removeEventListener('mousemove', this.onDrag);
          document.removeEventListener('mouseup', this.stopDrag);
        },

        closeAllMenus() {
          // å…³é—­æ‰€æœ‰å¼¹å‡ºèœå•
        },

        // ============ èŠ‚ç‚¹ç®¡ç† ============
        openNodeManagement() {
          const win = this.createWindow({
            type: 'nodes',
            title: 'èŠ‚ç‚¹ç®¡ç†',
            icon: 'ğŸ–¥ï¸',
            width: 1200,
            height: 700,
            nodes: [],
            stats: null,
            loading: false,
            selectedNodeDisks: null
          });
          this.loadNodesData(win);
        },

        async loadNodesData(window) {
          window.loading = true;
          try {
            const nodesRes = await axios.get(`${this.apiBaseUrl}/api/nodes`);
            window.nodes = nodesRes.data;

            const statsRes = await axios.get(`${this.apiBaseUrl}/api/stats`);
            window.stats = {
              total: statsRes.data.total_nodes,
              online: statsRes.data.online_nodes,
              offline: statsRes.data.offline_nodes,
              warning: statsRes.data.warning_nodes
            };
          } catch (error) {
            console.error('åŠ è½½å¤±è´¥,ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
            this.loadMockNodesData(window);
          } finally {
            window.loading = false;
          }
        },

        loadMockNodesData(window) {
          window.nodes = [
            { id: "node-1", name: "NAS-ä¸»èŠ‚ç‚¹", ip: "192.168.1.100", port: 8000, status: "online",
              cpu_usage: 45.5, memory_usage: 62.3, disk_usage: 78.9, total_storage: 2000,
              used_storage: 1578, network_speed: 125.6 },
            { id: "node-2", name: "NAS-å¤‡ä»½èŠ‚ç‚¹", ip: "192.168.1.101", port: 8000, status: "online",
              cpu_usage: 23.8, memory_usage: 45.2, disk_usage: 56.4, total_storage: 4000,
              used_storage: 2256, network_speed: 89.3 },
            { id: "node-3", name: "NAS-æµ‹è¯•èŠ‚ç‚¹", ip: "192.168.1.102", port: 8000, status: "warning",
              cpu_usage: 87.2, memory_usage: 91.5, disk_usage: 45.3, total_storage: 1000,
              used_storage: 453, network_speed: 45.7 },
            { id: "node-4", name: "NAS-ç¦»çº¿èŠ‚ç‚¹", ip: "192.168.1.103", port: 8000, status: "offline",
              cpu_usage: 0, memory_usage: 0, disk_usage: 0, total_storage: 2000,
              used_storage: 0, network_speed: 0 }
          ];

          window.stats = {
            total: 4,
            online: 2,
            offline: 1,
            warning: 1
          };
        },

        refreshNodes(window) {
          this.loadNodesData(window);
        },

        viewNodeDisks(window, node) {
          // æ¨¡æ‹Ÿç£ç›˜æ•°æ®
          window.selectedNodeDisks = {
            name: node.name,
            disks: [
              { mount: '/mnt/disk1', total: 1000, used: 789, free: 211, usage: 78.9, ec_scheme: 'RS(4+2)' },
              { mount: '/mnt/disk2', total: 1000, used: 450, free: 550, usage: 45.0, ec_scheme: null },
              { mount: '/mnt/ec_volume', total: 4000, used: 2340, free: 1660, usage: 58.5, ec_scheme: 'RS(8+4)' }
            ]
          };
        },

        viewNodeDetail(window, node) {
          alert('æŸ¥çœ‹èŠ‚ç‚¹è¯¦æƒ…: ' + node.name);
        },

        getStatusClass(status) {
          const classes = {
            online: 'bg-green-100 text-green-700 border border-green-300',
            offline: 'bg-gray-100 text-gray-700 border border-gray-300',
            warning: 'bg-yellow-100 text-yellow-700 border border-yellow-300'
          };
          return classes[status] || classes.offline;
        },

        getStatusText(status) {
          const texts = { online: 'åœ¨çº¿', offline: 'ç¦»çº¿', warning: 'è­¦å‘Š' };
          return texts[status] || 'æœªçŸ¥';
        },

        // ============ å†…ç½‘ç©¿é€ ============
        openIntranetAccess() {
          this.createWindow({
            type: 'intranet',
            title: 'å†…ç½‘ç©¿é€',
            icon: 'ğŸŒ',
            width: 1000,
            height: 600,
            activeConnections: 3,
            tunnels: [
              { id: 1, name: 'NAS-ä¸»èŠ‚ç‚¹', localAddr: '192.168.1.100:8000',
                publicAddr: 'nas1.example.com:443', active: true },
              { id: 2, name: 'NAS-å¤‡ä»½èŠ‚ç‚¹', localAddr: '192.168.1.101:8000',
                publicAddr: 'nas2.example.com:443', active: true },
              { id: 3, name: 'NAS-æµ‹è¯•èŠ‚ç‚¹', localAddr: '192.168.1.102:8000',
                publicAddr: 'nas3.example.com:443', active: false }
            ]
          });
        },

        openTunnel(tunnel) {
          window.open('http://' + tunnel.publicAddr, '_blank');
        },

        // ============ æƒé™è®¾ç½® ============
        openPermissionSettings() {
          this.createWindow({
            type: 'permission',
            title: 'æƒé™è®¾ç½®',
            icon: 'ğŸ”',
            width: 1000,
            height: 700,
            permissionNodes: [
              { id: 'node-1', name: 'NAS-ä¸»èŠ‚ç‚¹', ip: '192.168.1.100',
                permissions: { visible: true, level: 'readwrite' } },
              { id: 'node-2', name: 'NAS-å¤‡ä»½èŠ‚ç‚¹', ip: '192.168.1.101',
                permissions: { visible: true, level: 'readonly' } },
              { id: 'node-3', name: 'NAS-æµ‹è¯•èŠ‚ç‚¹', ip: '192.168.1.102',
                permissions: { visible: false, level: 'readonly' } }
            ],
            diskVisibility: [
              { id: 1, node: 'NAS-ä¸»èŠ‚ç‚¹', mount: '/mnt/disk1', size: 1000, visible: true },
              { id: 2, node: 'NAS-ä¸»èŠ‚ç‚¹', mount: '/mnt/disk2', size: 1000, visible: true },
              { id: 3, node: 'NAS-å¤‡ä»½èŠ‚ç‚¹', mount: '/mnt/backup', size: 2000, visible: false }
            ]
          });
        },

        savePermissions(window) {
          alert('æƒé™è®¾ç½®å·²ä¿å­˜!');
        },

        // ============ çº åˆ ç é…ç½® ============
        openECConfig() {
          this.createWindow({
            type: 'ec',
            title: 'çº åˆ ç é…ç½®',
            icon: 'ğŸ›¡ï¸',
            width: 1000,
            height: 700,
            ecConfig: {
              isConfigured: true,
              k: 8,
              m: 4,
              diskCount: 12,
              healthy: true
            },
            showConfigWizard: false,
            selectedScheme: null,
            ecSchemes: [
              { name: 'RS(4+2)', description: '4ä¸ªæ•°æ®å— + 2ä¸ªæ ¡éªŒå—', k: 4, m: 2 },
              { name: 'RS(8+4)', description: '8ä¸ªæ•°æ®å— + 4ä¸ªæ ¡éªŒå—', k: 8, m: 4 },
              { name: 'RS(12+4)', description: '12ä¸ªæ•°æ®å— + 4ä¸ªæ ¡éªŒå—', k: 12, m: 4 }
            ],
            availableDisks: [
              { id: 1, node: 'NAS-ä¸»èŠ‚ç‚¹', mount: '/mnt/disk1', size: 1000, selected: false },
              { id: 2, node: 'NAS-ä¸»èŠ‚ç‚¹', mount: '/mnt/disk2', size: 1000, selected: false },
              { id: 3, node: 'NAS-å¤‡ä»½èŠ‚ç‚¹', mount: '/mnt/disk1', size: 2000, selected: false }
            ]
          });
        },

        startECConfig(window) {
          window.showConfigWizard = true;
        },

        reconfigureEC(window) {
          window.showConfigWizard = true;
        },

        applyECConfig(window) {
          alert('çº åˆ ç é…ç½®å·²åº”ç”¨!');
          window.showConfigWizard = false;
          window.ecConfig.isConfigured = true;
        },

        // ============ ç³»ç»Ÿç›‘æ§ ============
        openSystemMonitor() {
          this.createWindow({
            type: 'monitor',
            title: 'ç³»ç»Ÿç›‘æ§',
            icon: 'ğŸ“Š',
            width: 1200,
            height: 700,
            totalStorage: 12.5,
            usedStorage: 8.3,
            avgCpu: 45.2,
            networkTraffic: 156.8
          });
        }
      }
    }).mount('#app');
  </script>
</body>
</html>